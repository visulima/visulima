<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vite Overlay History Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #ff4628;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e03e24;
        }
        .error-demo {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #ff4628;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Vite Overlay History Test</h1>
        <p>This page tests the new error history functionality with Mac Time Machine-like scrolling.</p>
        
        <div class="error-demo">
            <h3>Test Error Generation</h3>
            <p>Click the buttons below to generate different types of errors and test the history feature:</p>
            
            <button onclick="generateClientError()">Generate Client Error</button>
            <button onclick="generateServerError()">Generate Server Error</button>
            <button onclick="generateSyntaxError()">Generate Syntax Error</button>
            <button onclick="generateAsyncError()">Generate Async Error</button>
            <button onclick="clearHistory()">Clear History</button>
        </div>

        <div class="error-demo">
            <h3>Instructions</h3>
            <ol>
                <li>Click any of the error generation buttons above</li>
                <li>When the error overlay appears, look for the history button (clock icon) in the navigation</li>
                <li>Click the history button to open the Mac Time Machine-like timeline</li>
                <li>Scroll through the error history and click on any historical error to navigate to it</li>
                <li>Use keyboard navigation: Arrow Up/Down, Home/End, Enter/Space</li>
                <li>Press Escape to close the history panel or overlay</li>
            </ol>
        </div>
    </div>

    <script>
        // Mock the Vite overlay functionality for testing
        let errorCount = 0;
        
        function generateClientError() {
            errorCount++;
            const error = new Error(`Client Error #${errorCount}: This is a test client-side error`);
            error.name = 'ClientError';
            error.stack = `ClientError: Client Error #${errorCount}: This is a test client-side error
    at generateClientError (test-history.html:${Math.floor(Math.random() * 50) + 50}:15)
    at HTMLButtonElement.onclick (test-history.html:${Math.floor(Math.random() * 50) + 50}:15)`;
            
            // Simulate the Vite overlay error payload
            const payload = {
                errors: [{
                    name: error.name,
                    message: error.message,
                    stack: error.stack,
                    originalFilePath: '/src/components/TestComponent.jsx',
                    originalFileLine: Math.floor(Math.random() * 50) + 10,
                    originalFileColumn: Math.floor(Math.random() * 20) + 1,
                    originalCodeFrameContent: `<div class="code-frame">
                        <pre><code>function TestComponent() {
  const [state, setState] = useState(null);
  
  // This line causes the error
  <span style="background: #ffebee; color: #c62828;">setState(undefined.property);</span>
  
  return <div>Test Component</div>;
}</code></pre>
                    </div>`,
                    compiledCodeFrameContent: `<div class="code-frame">
                        <pre><code>function TestComponent() {
  var _useState = React.useState(null);
  var state = _useState[0];
  var setState = _useState[1];
  
  <span style="background: #ffebee; color: #c62828;">setState(undefined.property);</span>
  
  return React.createElement("div", null, "Test Component");
}</code></pre>
                    </div>`
                }],
                errorType: 'client',
                rootPath: '/workspace/test-project'
            };
            
            showErrorOverlay(payload);
        }
        
        function generateServerError() {
            errorCount++;
            const error = new Error(`Server Error #${errorCount}: Database connection failed`);
            error.name = 'DatabaseError';
            error.stack = `DatabaseError: Server Error #${errorCount}: Database connection failed
    at Database.connect (server.js:${Math.floor(Math.random() * 30) + 20}:15)
    at async initializeApp (server.js:${Math.floor(Math.random() * 30) + 20}:8)`;
            
            const payload = {
                errors: [{
                    name: error.name,
                    message: error.message,
                    stack: error.stack,
                    originalFilePath: '/server/database.js',
                    originalFileLine: Math.floor(Math.random() * 30) + 20,
                    originalFileColumn: Math.floor(Math.random() * 20) + 1,
                    originalCodeFrameContent: `<div class="code-frame">
                        <pre><code>async function connect() {
  try {
    const connection = await pool.connect();
    <span style="background: #ffebee; color: #c62828;">await connection.query('SELECT * FROM users');</span>
    return connection;
  } catch (error) {
    throw new DatabaseError('Connection failed');
  }
}</code></pre>
                    </div>`
                }],
                errorType: 'server',
                rootPath: '/workspace/test-project'
            };
            
            showErrorOverlay(payload);
        }
        
        function generateSyntaxError() {
            errorCount++;
            const error = new Error(`Syntax Error #${errorCount}: Unexpected token '}'`);
            error.name = 'SyntaxError';
            error.stack = `SyntaxError: Server Error #${errorCount}: Unexpected token '}'
    at Object.parse (parser.js:${Math.floor(Math.random() * 20) + 10}:15)
    at parseFile (compiler.js:${Math.floor(Math.random() * 20) + 10}:8)`;
            
            const payload = {
                errors: [{
                    name: error.name,
                    message: error.message,
                    stack: error.stack,
                    originalFilePath: '/src/utils/parser.js',
                    originalFileLine: Math.floor(Math.random() * 20) + 10,
                    originalFileColumn: Math.floor(Math.random() * 20) + 1,
                    originalCodeFrameContent: `<div class="code-frame">
                        <pre><code>function parseConfig(config) {
  const parsed = JSON.parse(config);
  <span style="background: #ffebee; color: #c62828;">return parsed;</span>
  } // <-- Missing closing brace
}</code></pre>
                    </div>`
                }],
                errorType: 'client',
                rootPath: '/workspace/test-project'
            };
            
            showErrorOverlay(payload);
        }
        
        function generateAsyncError() {
            errorCount++;
            const error = new Error(`Async Error #${errorCount}: Promise rejection in async function`);
            error.name = 'AsyncError';
            error.stack = `AsyncError: Async Error #${errorCount}: Promise rejection in async function
    at async fetchData (api.js:${Math.floor(Math.random() * 30) + 15}:8)
    at async processData (api.js:${Math.floor(Math.random() * 30) + 15}:12)`;
            
            const payload = {
                errors: [{
                    name: error.name,
                    message: error.message,
                    stack: error.stack,
                    originalFilePath: '/src/api/data.js',
                    originalFileLine: Math.floor(Math.random() * 30) + 15,
                    originalFileColumn: Math.floor(Math.random() * 20) + 1,
                    originalCodeFrameContent: `<div class="code-frame">
                        <pre><code>async function fetchData() {
  try {
    const response = await fetch('/api/data');
    <span style="background: #ffebee; color: #c62828;">const data = await response.json();</span>
    return data;
  } catch (error) {
    throw new AsyncError('Failed to fetch data');
  }
}</code></pre>
                    </div>`
                }],
                errorType: 'client',
                rootPath: '/workspace/test-project'
            };
            
            showErrorOverlay(payload);
        }
        
        function clearHistory() {
            localStorage.removeItem('v-o-error-history');
            alert('Error history cleared!');
        }
        
        function showErrorOverlay(payload) {
            // Create a mock error overlay element
            const overlay = document.createElement('div');
            overlay.id = '__v_o__root';
            overlay.className = 'fixed inset-0 z-[2147483647] flex flex-col items-center pt-[10vh] px-[15px]';
            overlay.style.background = 'rgba(0,0,0,0.6)';
            overlay.style.backdropFilter = 'blur(4px)';
            
            // This would normally be handled by the Vite overlay
            // For testing, we'll just show an alert
            alert(`Error Overlay would show here with payload:\n\nError Type: ${payload.errorType}\nError Name: ${payload.errors[0].name}\nMessage: ${payload.errors[0].message}\n\nCheck the browser console for the full payload.`);
            
            console.log('Error Overlay Payload:', payload);
            
            // In a real implementation, this would create the actual overlay
            // For now, we'll just log the payload and show a simple alert
        }
        
        // Add some initial instructions
        console.log('Vite Overlay History Test Page Loaded');
        console.log('Click the buttons to generate test errors and see the history functionality');
    </script>
</body>
</html>