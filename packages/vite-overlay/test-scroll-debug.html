<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vite Overlay Scroll Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #ff4628;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e03e24;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .test-area {
            background: #e8f5e8;
            border: 2px dashed #4caf50;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Vite Overlay Scroll Debug Test</h1>
        <p>This page helps debug the scroll navigation functionality.</p>
        
        <div class="test-area">
            <h3>üñ±Ô∏è Scroll Test Area</h3>
            <p>Try scrolling in this area to test if wheel events are being captured:</p>
            <div id="scroll-test" style="height: 200px; background: #f0f0f0; border: 1px solid #ccc; margin: 10px 0; padding: 20px; overflow-y: auto;">
                <p>Scroll here to test wheel events...</p>
                <p>Line 2</p>
                <p>Line 3</p>
                <p>Line 4</p>
                <p>Line 5</p>
                <p>Line 6</p>
                <p>Line 7</p>
                <p>Line 8</p>
                <p>Line 9</p>
                <p>Line 10</p>
                <p>Line 11</p>
                <p>Line 12</p>
                <p>Line 13</p>
                <p>Line 14</p>
                <p>Line 15</p>
                <p>Line 16</p>
                <p>Line 17</p>
                <p>Line 18</p>
                <p>Line 19</p>
                <p>Line 20</p>
            </div>
        </div>

        <div class="debug-info">
            <h4>Debug Information:</h4>
            <div id="debug-log">Waiting for scroll events...</div>
        </div>

        <button onclick="generateTestError()">Generate Test Error</button>
        <button onclick="clearDebugLog()">Clear Debug Log</button>
        <button onclick="testScrollEvents()">Test Scroll Events</button>
    </div>

    <script>
        let errorCount = 0;
        let debugLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            updateDebugDisplay();
            console.log(`[DEBUG] ${message}`);
        }

        function updateDebugDisplay() {
            const debugDiv = document.getElementById('debug-log');
            debugDiv.innerHTML = debugLog.slice(-10).join('<br>');
        }

        function clearDebugLog() {
            debugLog = [];
            updateDebugDisplay();
        }

        function testScrollEvents() {
            log('Setting up scroll event listeners...');
            
            // Test on the scroll test area
            const scrollTest = document.getElementById('scroll-test');
            scrollTest.addEventListener('wheel', (event) => {
                log(`Wheel event on scroll-test: deltaY=${event.deltaY}, target=${event.target.tagName}`);
            }, { passive: false });

            // Test on the body
            document.body.addEventListener('wheel', (event) => {
                log(`Wheel event on body: deltaY=${event.deltaY}, target=${event.target.tagName}`);
            }, { passive: false });

            // Test on the window
            window.addEventListener('wheel', (event) => {
                log(`Wheel event on window: deltaY=${event.deltaY}, target=${event.target.tagName}`);
            }, { passive: false });

            log('Scroll event listeners added. Try scrolling anywhere on the page.');
        }

        function generateTestError() {
            errorCount++;
            log(`Generating test error #${errorCount}`);
            
            // Simulate the Vite overlay error payload
            const payload = {
                errors: [{
                    name: 'TestError',
                    message: `Test Error #${errorCount}: This is a test error for scroll debugging`,
                    stack: `TestError: Test Error #${errorCount}
    at generateTestError (test-scroll-debug.html:${Math.floor(Math.random() * 50) + 50}:15)
    at HTMLButtonElement.onclick (test-scroll-debug.html:${Math.floor(Math.random() * 50) + 50}:15)`,
                    originalFilePath: '/src/test.js',
                    originalFileLine: Math.floor(Math.random() * 50) + 10,
                    originalFileColumn: Math.floor(Math.random() * 20) + 1,
                    originalCodeFrameContent: `<div class="code-frame">
                        <pre><code>function testFunction() {
  const value = null;
  <span style="background: #ffebee; color: #c62828;">console.log(value.property);</span>
  // This line causes the error
}</code></pre>
                    </div>`
                }],
                errorType: 'client',
                rootPath: '/workspace/test-project'
            };
            
            showErrorOverlay(payload);
        }

        function showErrorOverlay(payload) {
            log('Creating mock error overlay...');
            
            // Create a mock error overlay element
            const overlay = document.createElement('div');
            overlay.id = '__v_o__root';
            overlay.className = 'fixed inset-0 z-[2147483647] flex flex-col items-center pt-[10vh] px-[15px]';
            overlay.style.background = 'rgba(0,0,0,0.6)';
            overlay.style.backdropFilter = 'blur(4px)';
            overlay.style.pointerEvents = 'auto';
            
            // Add scroll event listener to the overlay
            overlay.addEventListener('wheel', (event) => {
                log(`Wheel event on overlay: deltaY=${event.deltaY}, historyEnabled=false`);
                event.preventDefault();
                event.stopPropagation();
            }, { passive: false });
            
            overlay.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 100%;">
                    <h3>Test Error Overlay</h3>
                    <p><strong>Error:</strong> ${payload.errors[0].name}</p>
                    <p><strong>Message:</strong> ${payload.errors[0].message}</p>
                    <p><strong>Type:</strong> ${payload.errorType}</p>
                    <div style="margin: 20px 0;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()">Close Overlay</button>
                        <button onclick="toggleHistoryMode()">Toggle History Mode</button>
                    </div>
                    <div id="history-indicator" style="display: none; background: #f0f0f0; padding: 10px; border-radius: 4px; margin: 10px 0;">
                        <strong>History Mode:</strong> <span id="history-status">Disabled</span><br>
                        <small>Scroll to navigate through errors</small>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            log('Mock error overlay created and added to DOM');
            
            // Add history toggle functionality
            window.toggleHistoryMode = function() {
                const indicator = document.getElementById('history-indicator');
                const status = document.getElementById('history-status');
                
                if (indicator.style.display === 'none') {
                    indicator.style.display = 'block';
                    status.textContent = 'Enabled';
                    log('History mode enabled - scroll events should now work');
                    
                    // Update the scroll event listener to handle history navigation
                    overlay.removeEventListener('wheel', arguments.callee);
                    overlay.addEventListener('wheel', (event) => {
                        log(`Wheel event on overlay (history enabled): deltaY=${event.deltaY}`);
                        event.preventDefault();
                        event.stopPropagation();
                        
                        // Simulate history navigation
                        const direction = event.deltaY > 0 ? 'forward' : 'backward';
                        log(`History navigation: ${direction}`);
                    }, { passive: false });
                } else {
                    indicator.style.display = 'none';
                    status.textContent = 'Disabled';
                    log('History mode disabled');
                }
            };
        }

        // Initialize
        log('Scroll debug test page loaded');
        log('Click "Test Scroll Events" to set up event listeners');
        log('Click "Generate Test Error" to create a mock overlay');
        log('Click "Toggle History Mode" in the overlay to enable scroll navigation');
    </script>
</body>
</html>