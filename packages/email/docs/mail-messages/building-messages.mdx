---
title: Building Messages
description: Learn how to build email messages using the fluent API
---

# Building Messages

The `MailMessage` class provides a fluent, chainable API for building email messages. This guide covers all available methods.

## Basic Message

```typescript
import { createMail } from "@visulima/email";
import { resendProvider } from "@visulima/email/providers/resend";

const mail = createMail(resendProvider({ apiKey: "re_xxx" }));

const result = await mail.message().to("user@example.com").from("sender@example.com").subject("Hello").html("<h1>Hello World</h1>").send();
```

## Setting Recipients

### To Addresses

```typescript
// Single recipient (string)
.message().to("user@example.com")

// Single recipient (object)
.message().to({ email: "user@example.com", name: "John Doe" })

// Multiple recipients (array)
.message().to(["user1@example.com", "user2@example.com"])

// Multiple recipients (array of objects)
.message().to([
  { email: "user1@example.com", name: "User 1" },
  { email: "user2@example.com", name: "User 2" },
])
```

### CC and BCC

```typescript
.message()
  .to("user@example.com")
  .cc("cc@example.com")
  .bcc("bcc@example.com")
```

### Reply-To

```typescript
.message()
  .to("user@example.com")
  .from("sender@example.com")
  .replyTo("reply@example.com")
```

## Setting Content

### Subject

```typescript
.message().subject("Welcome to our service!")
```

### HTML Content

```typescript
.message().html("<h1>Hello</h1><p>This is HTML content.</p>")
```

### Plain Text Content

```typescript
.message().text("Hello\n\nThis is plain text content.")
```

### Both HTML and Text

```typescript
.message()
  .html("<h1>Hello</h1><p>This is HTML.</p>")
  .text("Hello\n\nThis is plain text.")
```

## Custom Headers

```typescript
.message()
  .header("X-Custom-Header", "value")
  .header("X-Priority", "1")
```

Or set multiple headers at once:

```typescript
.message().setHeaders({
  "X-Custom-Header": "value",
  "X-Priority": "1",
  "X-Mailer": "MyApp",
})
```

## Attachments

### Attach File from Path

```typescript
await message.attachFromPath("/path/to/file.pdf");
```

With options:

```typescript
await message.attachFromPath("/path/to/file.pdf", {
    filename: "custom-name.pdf",
    contentType: "application/pdf",
});
```

### Attach Data

```typescript
message.attachData(Buffer.from("file content"), {
    filename: "document.txt",
    contentType: "text/plain",
});
```

## Inline Attachments

### Embed Image from Path

```typescript
const cid = await message.embedFromPath("/path/to/image.png");
// Use cid in HTML: <img src="cid:${cid}" />
```

### Embed Image Data

```typescript
const cid = message.embedData(Buffer.from("image data"), {
    filename: "logo.png",
    contentType: "image/png",
});
// Use cid in HTML: <img src="cid:${cid}" />
```

## Using Templates

### Handlebars Template

```typescript
import { renderHandlebars } from "@visulima/email/template/handlebars";

await message.view(renderHandlebars, "<h1>Hello {{name}}!</h1>", { name: "John" });
```

### MJML Template

```typescript
import { renderMjml } from "@visulima/email/template/mjml";

const mjmlTemplate = `
<mjml>
  <mj-body>
    <mj-section>
      <mj-column>
        <mj-text>Hello World</mj-text>
      </mj-column>
    </mj-section>
  </mj-body>
</mjml>
`;

await message.view(renderMjml, mjmlTemplate);
```

### React Email

```typescript
import { renderReactEmail } from "@visulima/email/template/react-email";
import { WelcomeEmail } from "./emails/WelcomeEmail";

await message.view(renderReactEmail, <WelcomeEmail name="John" />);
```

## Auto-Generate Text from HTML

When using templates, text can be automatically generated from HTML:

```typescript
import { renderHandlebars } from "@visulima/email/template/handlebars";

await message.view(
    renderHandlebars,
    "<h1>Hello {{name}}!</h1><p>Welcome to our service.</p>",
    { name: "John" },
    { autoText: true }, // Default: true
);
```

## Setting Provider Per Message

Override the default provider for a specific message:

```typescript
import { smtpProvider } from "@visulima/email/providers/smtp";

const smtp = smtpProvider({
    host: "smtp.example.com",
    port: 587,
    user: "user@example.com",
    password: "password",
});

await message.mailer(smtp).send();
```

## Building Without Sending

You can build the email options without sending:

```typescript
const emailOptions = await message.build();
// Use emailOptions with another provider or for testing
```

## Complete Example

```typescript
import { createMail } from "@visulima/email";
import { resendProvider } from "@visulima/email/providers/resend";
import { renderHandlebars } from "@visulima/email/template/handlebars";

const mail = createMail(resendProvider({ apiKey: "re_xxx" }));

const result = await mail
    .message()
    .to({ email: "user@example.com", name: "John Doe" })
    .cc("cc@example.com")
    .from({ email: "sender@example.com", name: "My App" })
    .replyTo("support@example.com")
    .subject("Welcome!")
    .view(renderHandlebars, "<h1>Hello {{name}}!</h1>", { name: "John" })
    .attachFromPath("/path/to/welcome.pdf")
    .header("X-Priority", "1")
    .send();
```

## Next Steps

- [Mailable Classes](/docs/package/email/mail-messages/mailable-classes) - Create reusable email templates
- [Attachments](/docs/package/email/mail-messages/attachments) - Learn more about attachments
- [Template Engines](/docs/package/email/templates/introduction) - Use template engines
