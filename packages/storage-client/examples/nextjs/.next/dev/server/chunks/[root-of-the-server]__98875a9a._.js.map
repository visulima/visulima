{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/_commonjsHelpers-B85MJLTf.js"],"sourcesContent":["function getDefaultExportFromCjs (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nexport { getDefaultExportFromCjs as g };\n"],"names":[],"mappings":";;;;AAAA,SAAS,wBAAyB,CAAC;IAClC,OAAO,KAAK,EAAE,UAAU,IAAI,OAAO,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,aAAa,CAAC,CAAC,UAAU,GAAG;AACjG"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/headers-C9CQX79R.js"],"sourcesContent":["import { g as getDefaultExportFromCjs } from './_commonjsHelpers-B85MJLTf.js';\nimport require$$0 from 'path';\n\nvar httpErrors = {exports: {}};\n\nvar depd_1;\nvar hasRequiredDepd;\n\nfunction requireDepd () {\n\tif (hasRequiredDepd) return depd_1;\n\thasRequiredDepd = 1;\n\t/*!\n\t * depd\n\t * Copyright(c) 2014-2018 Douglas Christopher Wilson\n\t * MIT Licensed\n\t */\n\tvar relative = require$$0.relative;\n\tdepd_1 = depd;\n\tvar basePath = process.cwd();\n\tfunction containsNamespace(str, namespace) {\n\t  var vals = str.split(/[ ,]+/);\n\t  var ns = String(namespace).toLowerCase();\n\t  for (var i = 0; i < vals.length; i++) {\n\t    var val = vals[i];\n\t    if (val && (val === \"*\" || val.toLowerCase() === ns)) {\n\t      return true;\n\t    }\n\t  }\n\t  return false;\n\t}\n\tfunction convertDataDescriptorToAccessor(obj, prop, message) {\n\t  var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n\t  var value = descriptor.value;\n\t  descriptor.get = function getter() {\n\t    return value;\n\t  };\n\t  if (descriptor.writable) {\n\t    descriptor.set = function setter(val) {\n\t      return value = val;\n\t    };\n\t  }\n\t  delete descriptor.value;\n\t  delete descriptor.writable;\n\t  Object.defineProperty(obj, prop, descriptor);\n\t  return descriptor;\n\t}\n\tfunction createArgumentsString(arity) {\n\t  var str = \"\";\n\t  for (var i = 0; i < arity; i++) {\n\t    str += \", arg\" + i;\n\t  }\n\t  return str.substr(2);\n\t}\n\tfunction createStackString(stack) {\n\t  var str = this.name + \": \" + this.namespace;\n\t  if (this.message) {\n\t    str += \" deprecated \" + this.message;\n\t  }\n\t  for (var i = 0; i < stack.length; i++) {\n\t    str += \"\\n    at \" + stack[i].toString();\n\t  }\n\t  return str;\n\t}\n\tfunction depd(namespace) {\n\t  if (!namespace) {\n\t    throw new TypeError(\"argument namespace is required\");\n\t  }\n\t  var stack = getStack();\n\t  var site = callSiteLocation(stack[1]);\n\t  var file = site[0];\n\t  function deprecate(message) {\n\t    log.call(deprecate, message);\n\t  }\n\t  deprecate._file = file;\n\t  deprecate._ignored = isignored(namespace);\n\t  deprecate._namespace = namespace;\n\t  deprecate._traced = istraced(namespace);\n\t  deprecate._warned = /* @__PURE__ */ Object.create(null);\n\t  deprecate.function = wrapfunction;\n\t  deprecate.property = wrapproperty;\n\t  return deprecate;\n\t}\n\tfunction eehaslisteners(emitter, type) {\n\t  var count = typeof emitter.listenerCount !== \"function\" ? emitter.listeners(type).length : emitter.listenerCount(type);\n\t  return count > 0;\n\t}\n\tfunction isignored(namespace) {\n\t  if (process.noDeprecation) {\n\t    return true;\n\t  }\n\t  var str = process.env.NO_DEPRECATION || \"\";\n\t  return containsNamespace(str, namespace);\n\t}\n\tfunction istraced(namespace) {\n\t  if (process.traceDeprecation) {\n\t    return true;\n\t  }\n\t  var str = process.env.TRACE_DEPRECATION || \"\";\n\t  return containsNamespace(str, namespace);\n\t}\n\tfunction log(message, site) {\n\t  var haslisteners = eehaslisteners(process, \"deprecation\");\n\t  if (!haslisteners && this._ignored) {\n\t    return;\n\t  }\n\t  var caller;\n\t  var callFile;\n\t  var callSite;\n\t  var depSite;\n\t  var i = 0;\n\t  var seen = false;\n\t  var stack = getStack();\n\t  var file = this._file;\n\t  if (site) {\n\t    depSite = site;\n\t    callSite = callSiteLocation(stack[1]);\n\t    callSite.name = depSite.name;\n\t    file = callSite[0];\n\t  } else {\n\t    i = 2;\n\t    depSite = callSiteLocation(stack[i]);\n\t    callSite = depSite;\n\t  }\n\t  for (; i < stack.length; i++) {\n\t    caller = callSiteLocation(stack[i]);\n\t    callFile = caller[0];\n\t    if (callFile === file) {\n\t      seen = true;\n\t    } else if (callFile === this._file) {\n\t      file = this._file;\n\t    } else if (seen) {\n\t      break;\n\t    }\n\t  }\n\t  var key = caller ? depSite.join(\":\") + \"__\" + caller.join(\":\") : void 0;\n\t  if (key !== void 0 && key in this._warned) {\n\t    return;\n\t  }\n\t  this._warned[key] = true;\n\t  var msg = message;\n\t  if (!msg) {\n\t    msg = callSite === depSite || !callSite.name ? defaultMessage(depSite) : defaultMessage(callSite);\n\t  }\n\t  if (haslisteners) {\n\t    var err = DeprecationError(this._namespace, msg, stack.slice(i));\n\t    process.emit(\"deprecation\", err);\n\t    return;\n\t  }\n\t  var format = process.stderr.isTTY ? formatColor : formatPlain;\n\t  var output = format.call(this, msg, caller, stack.slice(i));\n\t  process.stderr.write(output + \"\\n\", \"utf8\");\n\t}\n\tfunction callSiteLocation(callSite) {\n\t  var file = callSite.getFileName() || \"<anonymous>\";\n\t  var line = callSite.getLineNumber();\n\t  var colm = callSite.getColumnNumber();\n\t  if (callSite.isEval()) {\n\t    file = callSite.getEvalOrigin() + \", \" + file;\n\t  }\n\t  var site = [file, line, colm];\n\t  site.callSite = callSite;\n\t  site.name = callSite.getFunctionName();\n\t  return site;\n\t}\n\tfunction defaultMessage(site) {\n\t  var callSite = site.callSite;\n\t  var funcName = site.name;\n\t  if (!funcName) {\n\t    funcName = \"<anonymous@\" + formatLocation(site) + \">\";\n\t  }\n\t  var context = callSite.getThis();\n\t  var typeName = context && callSite.getTypeName();\n\t  if (typeName === \"Object\") {\n\t    typeName = void 0;\n\t  }\n\t  if (typeName === \"Function\") {\n\t    typeName = context.name || typeName;\n\t  }\n\t  return typeName && callSite.getMethodName() ? typeName + \".\" + funcName : funcName;\n\t}\n\tfunction formatPlain(msg, caller, stack) {\n\t  var timestamp = (/* @__PURE__ */ new Date()).toUTCString();\n\t  var formatted = timestamp + \" \" + this._namespace + \" deprecated \" + msg;\n\t  if (this._traced) {\n\t    for (var i = 0; i < stack.length; i++) {\n\t      formatted += \"\\n    at \" + stack[i].toString();\n\t    }\n\t    return formatted;\n\t  }\n\t  if (caller) {\n\t    formatted += \" at \" + formatLocation(caller);\n\t  }\n\t  return formatted;\n\t}\n\tfunction formatColor(msg, caller, stack) {\n\t  var formatted = \"\\x1B[36;1m\" + this._namespace + \"\\x1B[22;39m \\x1B[33;1mdeprecated\\x1B[22;39m \\x1B[0m\" + msg + \"\\x1B[39m\";\n\t  if (this._traced) {\n\t    for (var i = 0; i < stack.length; i++) {\n\t      formatted += \"\\n    \\x1B[36mat \" + stack[i].toString() + \"\\x1B[39m\";\n\t    }\n\t    return formatted;\n\t  }\n\t  if (caller) {\n\t    formatted += \" \\x1B[36m\" + formatLocation(caller) + \"\\x1B[39m\";\n\t  }\n\t  return formatted;\n\t}\n\tfunction formatLocation(callSite) {\n\t  return relative(basePath, callSite[0]) + \":\" + callSite[1] + \":\" + callSite[2];\n\t}\n\tfunction getStack() {\n\t  var limit = Error.stackTraceLimit;\n\t  var obj = {};\n\t  var prep = Error.prepareStackTrace;\n\t  Error.prepareStackTrace = prepareObjectStackTrace;\n\t  Error.stackTraceLimit = Math.max(10, limit);\n\t  Error.captureStackTrace(obj);\n\t  var stack = obj.stack.slice(1);\n\t  Error.prepareStackTrace = prep;\n\t  Error.stackTraceLimit = limit;\n\t  return stack;\n\t}\n\tfunction prepareObjectStackTrace(obj, stack) {\n\t  return stack;\n\t}\n\tfunction wrapfunction(fn, message) {\n\t  if (typeof fn !== \"function\") {\n\t    throw new TypeError(\"argument fn must be a function\");\n\t  }\n\t  var args = createArgumentsString(fn.length);\n\t  var stack = getStack();\n\t  var site = callSiteLocation(stack[1]);\n\t  site.name = fn.name;\n\t  var deprecatedfn = new Function(\n\t    \"fn\",\n\t    \"log\",\n\t    \"deprecate\",\n\t    \"message\",\n\t    \"site\",\n\t    '\"use strict\"\\nreturn function (' + args + \") {log.call(deprecate, message, site)\\nreturn fn.apply(this, arguments)\\n}\"\n\t  )(fn, log, this, message, site);\n\t  return deprecatedfn;\n\t}\n\tfunction wrapproperty(obj, prop, message) {\n\t  if (!obj || typeof obj !== \"object\" && typeof obj !== \"function\") {\n\t    throw new TypeError(\"argument obj must be object\");\n\t  }\n\t  var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n\t  if (!descriptor) {\n\t    throw new TypeError(\"must call property on owner object\");\n\t  }\n\t  if (!descriptor.configurable) {\n\t    throw new TypeError(\"property must be configurable\");\n\t  }\n\t  var deprecate = this;\n\t  var stack = getStack();\n\t  var site = callSiteLocation(stack[1]);\n\t  site.name = prop;\n\t  if (\"value\" in descriptor) {\n\t    descriptor = convertDataDescriptorToAccessor(obj, prop);\n\t  }\n\t  var get = descriptor.get;\n\t  var set = descriptor.set;\n\t  if (typeof get === \"function\") {\n\t    descriptor.get = function getter() {\n\t      log.call(deprecate, message, site);\n\t      return get.apply(this, arguments);\n\t    };\n\t  }\n\t  if (typeof set === \"function\") {\n\t    descriptor.set = function setter() {\n\t      log.call(deprecate, message, site);\n\t      return set.apply(this, arguments);\n\t    };\n\t  }\n\t  Object.defineProperty(obj, prop, descriptor);\n\t}\n\tfunction DeprecationError(namespace, message, stack) {\n\t  var error = new Error();\n\t  var stackString;\n\t  Object.defineProperty(error, \"constructor\", {\n\t    value: DeprecationError\n\t  });\n\t  Object.defineProperty(error, \"message\", {\n\t    configurable: true,\n\t    enumerable: false,\n\t    value: message,\n\t    writable: true\n\t  });\n\t  Object.defineProperty(error, \"name\", {\n\t    enumerable: false,\n\t    configurable: true,\n\t    value: \"DeprecationError\",\n\t    writable: true\n\t  });\n\t  Object.defineProperty(error, \"namespace\", {\n\t    configurable: true,\n\t    enumerable: false,\n\t    value: namespace,\n\t    writable: true\n\t  });\n\t  Object.defineProperty(error, \"stack\", {\n\t    configurable: true,\n\t    enumerable: false,\n\t    get: function() {\n\t      if (stackString !== void 0) {\n\t        return stackString;\n\t      }\n\t      return stackString = createStackString.call(this, stack);\n\t    },\n\t    set: function setter(val) {\n\t      stackString = val;\n\t    }\n\t  });\n\t  return error;\n\t}\n\treturn depd_1;\n}\n\nvar setprototypeof;\nvar hasRequiredSetprototypeof;\n\nfunction requireSetprototypeof () {\n\tif (hasRequiredSetprototypeof) return setprototypeof;\n\thasRequiredSetprototypeof = 1;\n\tsetprototypeof = Object.setPrototypeOf || ({ __proto__: [] } instanceof Array ? setProtoOf : mixinProperties);\n\tfunction setProtoOf(obj, proto) {\n\t  obj.__proto__ = proto;\n\t  return obj;\n\t}\n\tfunction mixinProperties(obj, proto) {\n\t  for (var prop in proto) {\n\t    if (!Object.prototype.hasOwnProperty.call(obj, prop)) {\n\t      obj[prop] = proto[prop];\n\t    }\n\t  }\n\t  return obj;\n\t}\n\treturn setprototypeof;\n}\n\nvar codes;\nvar hasRequiredCodes;\n\nfunction requireCodes () {\n\tif (hasRequiredCodes) return codes;\n\thasRequiredCodes = 1;\n\tcodes = {\n\t\t\"100\": \"Continue\",\n\t\t\"101\": \"Switching Protocols\",\n\t\t\"102\": \"Processing\",\n\t\t\"103\": \"Early Hints\",\n\t\t\"200\": \"OK\",\n\t\t\"201\": \"Created\",\n\t\t\"202\": \"Accepted\",\n\t\t\"203\": \"Non-Authoritative Information\",\n\t\t\"204\": \"No Content\",\n\t\t\"205\": \"Reset Content\",\n\t\t\"206\": \"Partial Content\",\n\t\t\"207\": \"Multi-Status\",\n\t\t\"208\": \"Already Reported\",\n\t\t\"226\": \"IM Used\",\n\t\t\"300\": \"Multiple Choices\",\n\t\t\"301\": \"Moved Permanently\",\n\t\t\"302\": \"Found\",\n\t\t\"303\": \"See Other\",\n\t\t\"304\": \"Not Modified\",\n\t\t\"305\": \"Use Proxy\",\n\t\t\"307\": \"Temporary Redirect\",\n\t\t\"308\": \"Permanent Redirect\",\n\t\t\"400\": \"Bad Request\",\n\t\t\"401\": \"Unauthorized\",\n\t\t\"402\": \"Payment Required\",\n\t\t\"403\": \"Forbidden\",\n\t\t\"404\": \"Not Found\",\n\t\t\"405\": \"Method Not Allowed\",\n\t\t\"406\": \"Not Acceptable\",\n\t\t\"407\": \"Proxy Authentication Required\",\n\t\t\"408\": \"Request Timeout\",\n\t\t\"409\": \"Conflict\",\n\t\t\"410\": \"Gone\",\n\t\t\"411\": \"Length Required\",\n\t\t\"412\": \"Precondition Failed\",\n\t\t\"413\": \"Payload Too Large\",\n\t\t\"414\": \"URI Too Long\",\n\t\t\"415\": \"Unsupported Media Type\",\n\t\t\"416\": \"Range Not Satisfiable\",\n\t\t\"417\": \"Expectation Failed\",\n\t\t\"418\": \"I'm a Teapot\",\n\t\t\"421\": \"Misdirected Request\",\n\t\t\"422\": \"Unprocessable Entity\",\n\t\t\"423\": \"Locked\",\n\t\t\"424\": \"Failed Dependency\",\n\t\t\"425\": \"Too Early\",\n\t\t\"426\": \"Upgrade Required\",\n\t\t\"428\": \"Precondition Required\",\n\t\t\"429\": \"Too Many Requests\",\n\t\t\"431\": \"Request Header Fields Too Large\",\n\t\t\"451\": \"Unavailable For Legal Reasons\",\n\t\t\"500\": \"Internal Server Error\",\n\t\t\"501\": \"Not Implemented\",\n\t\t\"502\": \"Bad Gateway\",\n\t\t\"503\": \"Service Unavailable\",\n\t\t\"504\": \"Gateway Timeout\",\n\t\t\"505\": \"HTTP Version Not Supported\",\n\t\t\"506\": \"Variant Also Negotiates\",\n\t\t\"507\": \"Insufficient Storage\",\n\t\t\"508\": \"Loop Detected\",\n\t\t\"509\": \"Bandwidth Limit Exceeded\",\n\t\t\"510\": \"Not Extended\",\n\t\t\"511\": \"Network Authentication Required\"\n\t};\n\treturn codes;\n}\n\nvar statuses;\nvar hasRequiredStatuses;\n\nfunction requireStatuses () {\n\tif (hasRequiredStatuses) return statuses;\n\thasRequiredStatuses = 1;\n\t/*!\n\t * statuses\n\t * Copyright(c) 2014 Jonathan Ong\n\t * Copyright(c) 2016 Douglas Christopher Wilson\n\t * MIT Licensed\n\t */\n\tvar codes = requireCodes();\n\tstatuses = status;\n\tstatus.message = codes;\n\tstatus.code = createMessageToStatusCodeMap(codes);\n\tstatus.codes = createStatusCodeList(codes);\n\tstatus.redirect = {\n\t  300: true,\n\t  301: true,\n\t  302: true,\n\t  303: true,\n\t  305: true,\n\t  307: true,\n\t  308: true\n\t};\n\tstatus.empty = {\n\t  204: true,\n\t  205: true,\n\t  304: true\n\t};\n\tstatus.retry = {\n\t  502: true,\n\t  503: true,\n\t  504: true\n\t};\n\tfunction createMessageToStatusCodeMap(codes2) {\n\t  var map = {};\n\t  Object.keys(codes2).forEach(function forEachCode(code) {\n\t    var message = codes2[code];\n\t    var status2 = Number(code);\n\t    map[message.toLowerCase()] = status2;\n\t  });\n\t  return map;\n\t}\n\tfunction createStatusCodeList(codes2) {\n\t  return Object.keys(codes2).map(function mapCode(code) {\n\t    return Number(code);\n\t  });\n\t}\n\tfunction getStatusCode(message) {\n\t  var msg = message.toLowerCase();\n\t  if (!Object.prototype.hasOwnProperty.call(status.code, msg)) {\n\t    throw new Error('invalid status message: \"' + message + '\"');\n\t  }\n\t  return status.code[msg];\n\t}\n\tfunction getStatusMessage(code) {\n\t  if (!Object.prototype.hasOwnProperty.call(status.message, code)) {\n\t    throw new Error(\"invalid status code: \" + code);\n\t  }\n\t  return status.message[code];\n\t}\n\tfunction status(code) {\n\t  if (typeof code === \"number\") {\n\t    return getStatusMessage(code);\n\t  }\n\t  if (typeof code !== \"string\") {\n\t    throw new TypeError(\"code must be a number or string\");\n\t  }\n\t  var n = parseInt(code, 10);\n\t  if (!isNaN(n)) {\n\t    return getStatusMessage(n);\n\t  }\n\t  return getStatusCode(code);\n\t}\n\treturn statuses;\n}\n\nvar inherits = {exports: {}};\n\nvar inherits_browser = {exports: {}};\n\nvar hasRequiredInherits_browser;\n\nfunction requireInherits_browser () {\n\tif (hasRequiredInherits_browser) return inherits_browser.exports;\n\thasRequiredInherits_browser = 1;\n\tif (typeof Object.create === \"function\") {\n\t  inherits_browser.exports = function inherits(ctor, superCtor) {\n\t    if (superCtor) {\n\t      ctor.super_ = superCtor;\n\t      ctor.prototype = Object.create(superCtor.prototype, {\n\t        constructor: {\n\t          value: ctor,\n\t          enumerable: false,\n\t          writable: true,\n\t          configurable: true\n\t        }\n\t      });\n\t    }\n\t  };\n\t} else {\n\t  inherits_browser.exports = function inherits(ctor, superCtor) {\n\t    if (superCtor) {\n\t      ctor.super_ = superCtor;\n\t      var TempCtor = function() {\n\t      };\n\t      TempCtor.prototype = superCtor.prototype;\n\t      ctor.prototype = new TempCtor();\n\t      ctor.prototype.constructor = ctor;\n\t    }\n\t  };\n\t}\n\treturn inherits_browser.exports;\n}\n\nvar hasRequiredInherits;\n\nfunction requireInherits () {\n\tif (hasRequiredInherits) return inherits.exports;\n\thasRequiredInherits = 1;\n\ttry {\n\t  var util = require(\"util\");\n\t  if (typeof util.inherits !== \"function\") throw \"\";\n\t  inherits.exports = util.inherits;\n\t} catch (e) {\n\t  inherits.exports = requireInherits_browser();\n\t}\n\treturn inherits.exports;\n}\n\nvar toidentifier;\nvar hasRequiredToidentifier;\n\nfunction requireToidentifier () {\n\tif (hasRequiredToidentifier) return toidentifier;\n\thasRequiredToidentifier = 1;\n\t/*!\n\t * toidentifier\n\t * Copyright(c) 2016 Douglas Christopher Wilson\n\t * MIT Licensed\n\t */\n\ttoidentifier = toIdentifier;\n\tfunction toIdentifier(str) {\n\t  return str.split(\" \").map(function(token) {\n\t    return token.slice(0, 1).toUpperCase() + token.slice(1);\n\t  }).join(\"\").replace(/[^ _0-9a-z]/gi, \"\");\n\t}\n\treturn toidentifier;\n}\n\nvar hasRequiredHttpErrors;\n\nfunction requireHttpErrors () {\n\tif (hasRequiredHttpErrors) return httpErrors.exports;\n\thasRequiredHttpErrors = 1;\n\t(function (module) {\n\t\t/*!\n\t\t * http-errors\n\t\t * Copyright(c) 2014 Jonathan Ong\n\t\t * Copyright(c) 2016 Douglas Christopher Wilson\n\t\t * MIT Licensed\n\t\t */\n\t\tvar deprecate = requireDepd()(\"http-errors\");\n\t\tvar setPrototypeOf = requireSetprototypeof();\n\t\tvar statuses = requireStatuses();\n\t\tvar inherits = requireInherits();\n\t\tvar toIdentifier = requireToidentifier();\n\t\tmodule.exports = createError;\n\t\tmodule.exports.HttpError = createHttpErrorConstructor();\n\t\tmodule.exports.isHttpError = createIsHttpErrorFunction(module.exports.HttpError);\n\t\tpopulateConstructorExports(module.exports, statuses.codes, module.exports.HttpError);\n\t\tfunction codeClass(status) {\n\t\t  return Number(String(status).charAt(0) + \"00\");\n\t\t}\n\t\tfunction createError() {\n\t\t  var err;\n\t\t  var msg;\n\t\t  var status = 500;\n\t\t  var props = {};\n\t\t  for (var i = 0; i < arguments.length; i++) {\n\t\t    var arg = arguments[i];\n\t\t    var type = typeof arg;\n\t\t    if (type === \"object\" && arg instanceof Error) {\n\t\t      err = arg;\n\t\t      status = err.status || err.statusCode || status;\n\t\t    } else if (type === \"number\" && i === 0) {\n\t\t      status = arg;\n\t\t    } else if (type === \"string\") {\n\t\t      msg = arg;\n\t\t    } else if (type === \"object\") {\n\t\t      props = arg;\n\t\t    } else {\n\t\t      throw new TypeError(\"argument #\" + (i + 1) + \" unsupported type \" + type);\n\t\t    }\n\t\t  }\n\t\t  if (typeof status === \"number\" && (status < 400 || status >= 600)) {\n\t\t    deprecate(\"non-error status code; use only 4xx or 5xx status codes\");\n\t\t  }\n\t\t  if (typeof status !== \"number\" || !statuses.message[status] && (status < 400 || status >= 600)) {\n\t\t    status = 500;\n\t\t  }\n\t\t  var HttpError = createError[status] || createError[codeClass(status)];\n\t\t  if (!err) {\n\t\t    err = HttpError ? new HttpError(msg) : new Error(msg || statuses.message[status]);\n\t\t    Error.captureStackTrace(err, createError);\n\t\t  }\n\t\t  if (!HttpError || !(err instanceof HttpError) || err.status !== status) {\n\t\t    err.expose = status < 500;\n\t\t    err.status = err.statusCode = status;\n\t\t  }\n\t\t  for (var key in props) {\n\t\t    if (key !== \"status\" && key !== \"statusCode\") {\n\t\t      err[key] = props[key];\n\t\t    }\n\t\t  }\n\t\t  return err;\n\t\t}\n\t\tfunction createHttpErrorConstructor() {\n\t\t  function HttpError() {\n\t\t    throw new TypeError(\"cannot construct abstract class\");\n\t\t  }\n\t\t  inherits(HttpError, Error);\n\t\t  return HttpError;\n\t\t}\n\t\tfunction createClientErrorConstructor(HttpError, name, code) {\n\t\t  var className = toClassName(name);\n\t\t  function ClientError(message) {\n\t\t    var msg = message != null ? message : statuses.message[code];\n\t\t    var err = new Error(msg);\n\t\t    Error.captureStackTrace(err, ClientError);\n\t\t    setPrototypeOf(err, ClientError.prototype);\n\t\t    Object.defineProperty(err, \"message\", {\n\t\t      enumerable: true,\n\t\t      configurable: true,\n\t\t      value: msg,\n\t\t      writable: true\n\t\t    });\n\t\t    Object.defineProperty(err, \"name\", {\n\t\t      enumerable: false,\n\t\t      configurable: true,\n\t\t      value: className,\n\t\t      writable: true\n\t\t    });\n\t\t    return err;\n\t\t  }\n\t\t  inherits(ClientError, HttpError);\n\t\t  nameFunc(ClientError, className);\n\t\t  ClientError.prototype.status = code;\n\t\t  ClientError.prototype.statusCode = code;\n\t\t  ClientError.prototype.expose = true;\n\t\t  return ClientError;\n\t\t}\n\t\tfunction createIsHttpErrorFunction(HttpError) {\n\t\t  return function isHttpError(val) {\n\t\t    if (!val || typeof val !== \"object\") {\n\t\t      return false;\n\t\t    }\n\t\t    if (val instanceof HttpError) {\n\t\t      return true;\n\t\t    }\n\t\t    return val instanceof Error && typeof val.expose === \"boolean\" && typeof val.statusCode === \"number\" && val.status === val.statusCode;\n\t\t  };\n\t\t}\n\t\tfunction createServerErrorConstructor(HttpError, name, code) {\n\t\t  var className = toClassName(name);\n\t\t  function ServerError(message) {\n\t\t    var msg = message != null ? message : statuses.message[code];\n\t\t    var err = new Error(msg);\n\t\t    Error.captureStackTrace(err, ServerError);\n\t\t    setPrototypeOf(err, ServerError.prototype);\n\t\t    Object.defineProperty(err, \"message\", {\n\t\t      enumerable: true,\n\t\t      configurable: true,\n\t\t      value: msg,\n\t\t      writable: true\n\t\t    });\n\t\t    Object.defineProperty(err, \"name\", {\n\t\t      enumerable: false,\n\t\t      configurable: true,\n\t\t      value: className,\n\t\t      writable: true\n\t\t    });\n\t\t    return err;\n\t\t  }\n\t\t  inherits(ServerError, HttpError);\n\t\t  nameFunc(ServerError, className);\n\t\t  ServerError.prototype.status = code;\n\t\t  ServerError.prototype.statusCode = code;\n\t\t  ServerError.prototype.expose = false;\n\t\t  return ServerError;\n\t\t}\n\t\tfunction nameFunc(func, name) {\n\t\t  var desc = Object.getOwnPropertyDescriptor(func, \"name\");\n\t\t  if (desc && desc.configurable) {\n\t\t    desc.value = name;\n\t\t    Object.defineProperty(func, \"name\", desc);\n\t\t  }\n\t\t}\n\t\tfunction populateConstructorExports(exports$1, codes, HttpError) {\n\t\t  codes.forEach(function forEachCode(code) {\n\t\t    var CodeError;\n\t\t    var name = toIdentifier(statuses.message[code]);\n\t\t    switch (codeClass(code)) {\n\t\t      case 400:\n\t\t        CodeError = createClientErrorConstructor(HttpError, name, code);\n\t\t        break;\n\t\t      case 500:\n\t\t        CodeError = createServerErrorConstructor(HttpError, name, code);\n\t\t        break;\n\t\t    }\n\t\t    if (CodeError) {\n\t\t      exports$1[code] = CodeError;\n\t\t      exports$1[name] = CodeError;\n\t\t    }\n\t\t  });\n\t\t}\n\t\tfunction toClassName(name) {\n\t\t  return name.substr(-5) !== \"Error\" ? name + \"Error\" : name;\n\t\t} \n\t} (httpErrors));\n\treturn httpErrors.exports;\n}\n\nvar httpErrorsExports = requireHttpErrors();\nconst createHttpError = /*@__PURE__*/getDefaultExportFromCjs(httpErrorsExports);\n\nfunction parseParams(input, delimiter = \";\") {\n  let parser = delimiter === \";\" ? /(?:^|;)\\s*([^=;\\s]+)(\\s*=\\s*(?:\"((?:[^\"\\\\]|\\\\.)*)\"|((?:[^;]|\\\\\\;)+))?)?/g : /(?:^|,)\\s*([^=,\\s]+)(\\s*=\\s*(?:\"((?:[^\"\\\\]|\\\\.)*)\"|((?:[^,]|\\\\\\,)+))?)?/g;\n  let params = [];\n  let match;\n  while ((match = parser.exec(input)) !== null) {\n    let key = match[1].trim();\n    let value;\n    if (match[2]) {\n      value = (match[3] || match[4] || \"\").replace(/\\\\(.)/g, \"$1\").trim();\n    }\n    params.push([key, value]);\n  }\n  return params;\n}\nfunction quote(value) {\n  if (value.includes('\"') || value.includes(\";\") || value.includes(\" \")) {\n    return `\"${value.replace(/\"/g, '\\\\\"')}\"`;\n  }\n  return value;\n}\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\nfunction isIterable(value) {\n  return value != null && typeof value[Symbol.iterator] === \"function\";\n}\nfunction isValidDate(date) {\n  return date instanceof Date && !isNaN(date.getTime());\n}\nfunction quoteEtag(tag) {\n  return tag === \"*\" ? tag : /^(W\\/)?\".*\"$/.test(tag) ? tag : `\"${tag}\"`;\n}\nfunction removeMilliseconds(time) {\n  let timestamp = time instanceof Date ? time.getTime() : time;\n  return Math.floor(timestamp / 1e3);\n}\nconst imfFixdatePattern = /^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\\d{4}) (\\d{2}):(\\d{2}):(\\d{2}) GMT$/;\nfunction parseHttpDate(dateString) {\n  if (!imfFixdatePattern.test(dateString)) {\n    return null;\n  }\n  let timestamp = Date.parse(dateString);\n  if (isNaN(timestamp)) {\n    return null;\n  }\n  return timestamp;\n}\n\nclass Accept {\n  #map;\n  constructor(init) {\n    this.#map = /* @__PURE__ */ new Map();\n    if (init) {\n      if (typeof init === \"string\") {\n        for (let piece of init.split(/\\s*,\\s*/)) {\n          let params = parseParams(piece);\n          if (params.length < 1)\n            continue;\n          let mediaType = params[0][0];\n          let weight = 1;\n          for (let i = 1; i < params.length; i++) {\n            let [key, value] = params[i];\n            if (key === \"q\") {\n              weight = Number(value);\n              break;\n            }\n          }\n          this.#map.set(mediaType.toLowerCase(), weight);\n        }\n      } else if (isIterable(init)) {\n        for (let mediaType of init) {\n          if (Array.isArray(mediaType)) {\n            this.#map.set(mediaType[0].toLowerCase(), mediaType[1]);\n          } else {\n            this.#map.set(mediaType.toLowerCase(), 1);\n          }\n        }\n      } else {\n        for (let mediaType of Object.getOwnPropertyNames(init)) {\n          this.#map.set(mediaType.toLowerCase(), init[mediaType]);\n        }\n      }\n      this.#sort();\n    }\n  }\n  #sort() {\n    this.#map = new Map([...this.#map].sort((a, b) => b[1] - a[1]));\n  }\n  /**\n   * An array of all media types in the header.\n   */\n  get mediaTypes() {\n    return Array.from(this.#map.keys());\n  }\n  /**\n   * An array of all weights (q values) in the header.\n   */\n  get weights() {\n    return Array.from(this.#map.values());\n  }\n  /**\n   * The number of media types in the `Accept` header.\n   */\n  get size() {\n    return this.#map.size;\n  }\n  /**\n   * Returns `true` if the header matches the given media type (i.e. it is \"acceptable\").\n   * @param mediaType The media type to check.\n   * @returns `true` if the media type is acceptable, `false` otherwise.\n   */\n  accepts(mediaType) {\n    return this.getWeight(mediaType) > 0;\n  }\n  /**\n   * Gets the weight of a given media type. Also supports wildcards, so e.g. `text/*` will match `text/html`.\n   * @param mediaType The media type to get the weight of.\n   * @returns The weight of the media type.\n   */\n  getWeight(mediaType) {\n    let [type, subtype] = mediaType.toLowerCase().split(\"/\");\n    for (let [key, value] of this) {\n      let [t, s] = key.split(\"/\");\n      if ((t === type || t === \"*\" || type === \"*\") && (s === subtype || s === \"*\" || subtype === \"*\")) {\n        return value;\n      }\n    }\n    return 0;\n  }\n  /**\n   * Returns the most preferred media type from the given list of media types.\n   * @param mediaTypes The list of media types to choose from.\n   * @returns The most preferred media type or `null` if none match.\n   */\n  getPreferred(mediaTypes) {\n    let sorted = mediaTypes.map((mediaType) => [mediaType, this.getWeight(mediaType)]).sort((a, b) => b[1] - a[1]);\n    let first = sorted[0];\n    return first !== void 0 && first[1] > 0 ? first[0] : null;\n  }\n  /**\n   * Returns the weight of a media type. If it is not in the header verbatim, this returns `null`.\n   * @param mediaType The media type to get the weight of.\n   * @returns The weight of the media type, or `null` if it is not in the header.\n   */\n  get(mediaType) {\n    return this.#map.get(mediaType.toLowerCase()) ?? null;\n  }\n  /**\n   * Sets a media type with the given weight.\n   * @param mediaType The media type to set.\n   * @param weight The weight of the media type. Defaults to 1.\n   */\n  set(mediaType, weight = 1) {\n    this.#map.set(mediaType.toLowerCase(), weight);\n    this.#sort();\n  }\n  /**\n   * Removes the given media type from the header.\n   * @param mediaType The media type to remove.\n   */\n  delete(mediaType) {\n    this.#map.delete(mediaType.toLowerCase());\n  }\n  /**\n   * Checks if a media type is in the header.\n   * @param mediaType The media type to check.\n   * @returns `true` if the media type is in the header (verbatim), `false` otherwise.\n   */\n  has(mediaType) {\n    return this.#map.has(mediaType.toLowerCase());\n  }\n  /**\n   * Removes all media types from the header.\n   */\n  clear() {\n    this.#map.clear();\n  }\n  entries() {\n    return this.#map.entries();\n  }\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  forEach(callback, thisArg) {\n    for (let [mediaType, weight] of this) {\n      callback.call(thisArg, mediaType, weight, this);\n    }\n  }\n  toString() {\n    let pairs = [];\n    for (let [mediaType, weight] of this.#map) {\n      pairs.push(`${mediaType}${weight === 1 ? \"\" : `;q=${weight}`}`);\n    }\n    return pairs.join(\",\");\n  }\n}\n\nclass AcceptEncoding {\n  #map;\n  constructor(init) {\n    this.#map = /* @__PURE__ */ new Map();\n    if (init) {\n      if (typeof init === \"string\") {\n        for (let piece of init.split(/\\s*,\\s*/)) {\n          let params = parseParams(piece);\n          if (params.length < 1)\n            continue;\n          let encoding = params[0][0];\n          let weight = 1;\n          for (let i = 1; i < params.length; i++) {\n            let [key, value] = params[i];\n            if (key === \"q\") {\n              weight = Number(value);\n              break;\n            }\n          }\n          this.#map.set(encoding.toLowerCase(), weight);\n        }\n      } else if (isIterable(init)) {\n        for (let value of init) {\n          if (Array.isArray(value)) {\n            this.#map.set(value[0].toLowerCase(), value[1]);\n          } else {\n            this.#map.set(value.toLowerCase(), 1);\n          }\n        }\n      } else {\n        for (let encoding of Object.getOwnPropertyNames(init)) {\n          this.#map.set(encoding.toLowerCase(), init[encoding]);\n        }\n      }\n      this.#sort();\n    }\n  }\n  #sort() {\n    this.#map = new Map([...this.#map].sort((a, b) => b[1] - a[1]));\n  }\n  /**\n   * An array of all encodings in the header.\n   */\n  get encodings() {\n    return Array.from(this.#map.keys());\n  }\n  /**\n   * An array of all weights (q values) in the header.\n   */\n  get weights() {\n    return Array.from(this.#map.values());\n  }\n  /**\n   * The number of encodings in the header.\n   */\n  get size() {\n    return this.#map.size;\n  }\n  /**\n   * Returns `true` if the header matches the given encoding (i.e. it is \"acceptable\").\n   * @param encoding The encoding to check.\n   * @returns `true` if the encoding is acceptable, `false` otherwise.\n   */\n  accepts(encoding) {\n    return encoding.toLowerCase() === \"identity\" || this.getWeight(encoding) > 0;\n  }\n  /**\n   * Gets the weight an encoding. Performs wildcard matching so `*` matches all encodings.\n   * @param encoding The encoding to get.\n   * @returns The weight of the encoding, or `0` if it is not in the header.\n   */\n  getWeight(encoding) {\n    let lower = encoding.toLowerCase();\n    for (let [enc, weight] of this) {\n      if (enc === lower || enc === \"*\" || lower === \"*\") {\n        return weight;\n      }\n    }\n    return 0;\n  }\n  /**\n   * Returns the most preferred encoding from the given list of encodings.\n   * @param encodings The encodings to choose from.\n   * @returns The most preferred encoding or `null` if none match.\n   */\n  getPreferred(encodings) {\n    let sorted = encodings.map((encoding) => [encoding, this.getWeight(encoding)]).sort((a, b) => b[1] - a[1]);\n    let first = sorted[0];\n    return first !== void 0 && first[1] > 0 ? first[0] : null;\n  }\n  /**\n   * Gets the weight of an encoding. If it is not in the header verbatim, this returns `null`.\n   * @param encoding The encoding to get.\n   * @returns The weight of the encoding, or `null` if it is not in the header.\n   */\n  get(encoding) {\n    return this.#map.get(encoding.toLowerCase()) ?? null;\n  }\n  /**\n   * Sets an encoding with the given weight.\n   * @param encoding The encoding to set.\n   * @param weight The weight of the encoding. Defaults to 1.\n   */\n  set(encoding, weight = 1) {\n    this.#map.set(encoding.toLowerCase(), weight);\n    this.#sort();\n  }\n  /**\n   * Removes the given encoding from the header.\n   * @param encoding The encoding to remove.\n   */\n  delete(encoding) {\n    this.#map.delete(encoding.toLowerCase());\n  }\n  /**\n   * Checks if the header contains a given encoding.\n   * @param encoding The encoding to check.\n   * @returns `true` if the encoding is in the header, `false` otherwise.\n   */\n  has(encoding) {\n    return this.#map.has(encoding.toLowerCase());\n  }\n  /**\n   * Removes all encodings from the header.\n   */\n  clear() {\n    this.#map.clear();\n  }\n  entries() {\n    return this.#map.entries();\n  }\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  forEach(callback, thisArg) {\n    for (let [encoding, weight] of this) {\n      callback.call(thisArg, encoding, weight, this);\n    }\n  }\n  toString() {\n    let pairs = [];\n    for (let [encoding, weight] of this.#map) {\n      pairs.push(`${encoding}${weight === 1 ? \"\" : `;q=${weight}`}`);\n    }\n    return pairs.join(\",\");\n  }\n}\n\nclass AcceptLanguage {\n  #map;\n  constructor(init) {\n    this.#map = /* @__PURE__ */ new Map();\n    if (init) {\n      if (typeof init === \"string\") {\n        for (let piece of init.split(/\\s*,\\s*/)) {\n          let params = parseParams(piece);\n          if (params.length < 1)\n            continue;\n          let language = params[0][0];\n          let weight = 1;\n          for (let i = 1; i < params.length; i++) {\n            let [key, value] = params[i];\n            if (key === \"q\") {\n              weight = Number(value);\n              break;\n            }\n          }\n          this.#map.set(language.toLowerCase(), weight);\n        }\n      } else if (isIterable(init)) {\n        for (let value of init) {\n          if (Array.isArray(value)) {\n            this.#map.set(value[0].toLowerCase(), value[1]);\n          } else {\n            this.#map.set(value.toLowerCase(), 1);\n          }\n        }\n      } else {\n        for (let language of Object.getOwnPropertyNames(init)) {\n          this.#map.set(language.toLowerCase(), init[language]);\n        }\n      }\n      this.#sort();\n    }\n  }\n  #sort() {\n    this.#map = new Map([...this.#map].sort((a, b) => b[1] - a[1]));\n  }\n  /**\n   * An array of all languages in the header.\n   */\n  get languages() {\n    return Array.from(this.#map.keys());\n  }\n  /**\n   * An array of all weights (q values) in the header.\n   */\n  get weights() {\n    return Array.from(this.#map.values());\n  }\n  /**\n   * The number of languages in the header.\n   */\n  get size() {\n    return this.#map.size;\n  }\n  /**\n   * Returns `true` if the header matches the given language (i.e. it is \"acceptable\").\n   * @param language The locale identifier of the language to check.\n   * @returns `true` if the language is acceptable, `false` otherwise.\n   */\n  accepts(language) {\n    return this.getWeight(language) > 0;\n  }\n  /**\n   * Gets the weight of a language with the given locale identifier. Performs wildcard and subtype\n   * matching, so `en` matches `en-US` and `en-GB`, and `*` matches all languages.\n   * @param language The locale identifier of the language to get.\n   * @returns The weight of the language, or `0` if it is not in the header.\n   */\n  getWeight(language) {\n    let [base, subtype] = language.toLowerCase().split(\"-\");\n    for (let [key, value] of this) {\n      let [b, s] = key.split(\"-\");\n      if ((b === base || b === \"*\" || base === \"*\") && (s === subtype || s === void 0 || subtype === void 0)) {\n        return value;\n      }\n    }\n    return 0;\n  }\n  /**\n   * Returns the most preferred language from the given list of languages.\n   * @param languages The locale identifiers of the languages to choose from.\n   * @returns The most preferred language or `null` if none match.\n   */\n  getPreferred(languages) {\n    let sorted = languages.map((language) => [language, this.getWeight(language)]).sort((a, b) => b[1] - a[1]);\n    let first = sorted[0];\n    return first !== void 0 && first[1] > 0 ? first[0] : null;\n  }\n  /**\n   * Gets the weight of a language with the given locale identifier. If it is not in the header\n   * verbatim, this returns `null`.\n   * @param language The locale identifier of the language to get.\n   * @returns The weight of the language, or `null` if it is not in the header.\n   */\n  get(language) {\n    return this.#map.get(language.toLowerCase()) ?? null;\n  }\n  /**\n   * Sets a language with the given weight.\n   * @param language The locale identifier of the language to set.\n   * @param weight The weight of the language. Defaults to 1.\n   */\n  set(language, weight = 1) {\n    this.#map.set(language.toLowerCase(), weight);\n    this.#sort();\n  }\n  /**\n   * Removes a language with the given locale identifier.\n   * @param language The locale identifier of the language to remove.\n   */\n  delete(language) {\n    this.#map.delete(language.toLowerCase());\n  }\n  /**\n   * Checks if the header contains a language with the given locale identifier.\n   * @param language The locale identifier of the language to check.\n   * @returns `true` if the language is in the header, `false` otherwise.\n   */\n  has(language) {\n    return this.#map.has(language.toLowerCase());\n  }\n  /**\n   * Removes all languages from the header.\n   */\n  clear() {\n    this.#map.clear();\n  }\n  entries() {\n    return this.#map.entries();\n  }\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  forEach(callback, thisArg) {\n    for (let [language, weight] of this) {\n      callback.call(thisArg, language, weight, this);\n    }\n  }\n  toString() {\n    let pairs = [];\n    for (let [language, weight] of this.#map) {\n      pairs.push(`${language}${weight === 1 ? \"\" : `;q=${weight}`}`);\n    }\n    return pairs.join(\",\");\n  }\n}\n\nclass CacheControl {\n  maxAge;\n  maxStale;\n  minFresh;\n  sMaxage;\n  noCache;\n  noStore;\n  noTransform;\n  onlyIfCached;\n  mustRevalidate;\n  proxyRevalidate;\n  mustUnderstand;\n  private;\n  public;\n  immutable;\n  staleWhileRevalidate;\n  staleIfError;\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        let params = parseParams(init, \",\");\n        if (params.length > 0) {\n          for (let [name, value] of params) {\n            switch (name) {\n              case \"max-age\":\n                this.maxAge = Number(value);\n                break;\n              case \"max-stale\":\n                this.maxStale = Number(value);\n                break;\n              case \"min-fresh\":\n                this.minFresh = Number(value);\n                break;\n              case \"s-maxage\":\n                this.sMaxage = Number(value);\n                break;\n              case \"no-cache\":\n                this.noCache = true;\n                break;\n              case \"no-store\":\n                this.noStore = true;\n                break;\n              case \"no-transform\":\n                this.noTransform = true;\n                break;\n              case \"only-if-cached\":\n                this.onlyIfCached = true;\n                break;\n              case \"must-revalidate\":\n                this.mustRevalidate = true;\n                break;\n              case \"proxy-revalidate\":\n                this.proxyRevalidate = true;\n                break;\n              case \"must-understand\":\n                this.mustUnderstand = true;\n                break;\n              case \"private\":\n                this.private = true;\n                break;\n              case \"public\":\n                this.public = true;\n                break;\n              case \"immutable\":\n                this.immutable = true;\n                break;\n              case \"stale-while-revalidate\":\n                this.staleWhileRevalidate = Number(value);\n                break;\n              case \"stale-if-error\":\n                this.staleIfError = Number(value);\n                break;\n            }\n          }\n        }\n      } else {\n        this.maxAge = init.maxAge;\n        this.maxStale = init.maxStale;\n        this.minFresh = init.minFresh;\n        this.sMaxage = init.sMaxage;\n        this.noCache = init.noCache;\n        this.noStore = init.noStore;\n        this.noTransform = init.noTransform;\n        this.onlyIfCached = init.onlyIfCached;\n        this.mustRevalidate = init.mustRevalidate;\n        this.proxyRevalidate = init.proxyRevalidate;\n        this.mustUnderstand = init.mustUnderstand;\n        this.private = init.private;\n        this.public = init.public;\n        this.immutable = init.immutable;\n        this.staleWhileRevalidate = init.staleWhileRevalidate;\n        this.staleIfError = init.staleIfError;\n      }\n    }\n  }\n  toString() {\n    let parts = [];\n    if (this.public) {\n      parts.push(\"public\");\n    }\n    if (this.private) {\n      parts.push(\"private\");\n    }\n    if (typeof this.maxAge === \"number\") {\n      parts.push(`max-age=${this.maxAge}`);\n    }\n    if (typeof this.sMaxage === \"number\") {\n      parts.push(`s-maxage=${this.sMaxage}`);\n    }\n    if (this.noCache) {\n      parts.push(\"no-cache\");\n    }\n    if (this.noStore) {\n      parts.push(\"no-store\");\n    }\n    if (this.noTransform) {\n      parts.push(\"no-transform\");\n    }\n    if (this.onlyIfCached) {\n      parts.push(\"only-if-cached\");\n    }\n    if (this.mustRevalidate) {\n      parts.push(\"must-revalidate\");\n    }\n    if (this.proxyRevalidate) {\n      parts.push(\"proxy-revalidate\");\n    }\n    if (this.mustUnderstand) {\n      parts.push(\"must-understand\");\n    }\n    if (this.immutable) {\n      parts.push(\"immutable\");\n    }\n    if (typeof this.staleWhileRevalidate === \"number\") {\n      parts.push(`stale-while-revalidate=${this.staleWhileRevalidate}`);\n    }\n    if (typeof this.staleIfError === \"number\") {\n      parts.push(`stale-if-error=${this.staleIfError}`);\n    }\n    if (typeof this.maxStale === \"number\") {\n      parts.push(`max-stale=${this.maxStale}`);\n    }\n    if (typeof this.minFresh === \"number\") {\n      parts.push(`min-fresh=${this.minFresh}`);\n    }\n    return parts.join(\", \");\n  }\n}\n\nclass ContentDisposition {\n  filename;\n  filenameSplat;\n  name;\n  type;\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        let params = parseParams(init);\n        if (params.length > 0) {\n          this.type = params[0][0];\n          for (let [name, value] of params.slice(1)) {\n            if (name === \"filename\") {\n              this.filename = value;\n            } else if (name === \"filename*\") {\n              this.filenameSplat = value;\n            } else if (name === \"name\") {\n              this.name = value;\n            }\n          }\n        }\n      } else {\n        this.filename = init.filename;\n        this.filenameSplat = init.filenameSplat;\n        this.name = init.name;\n        this.type = init.type;\n      }\n    }\n  }\n  /**\n   * The preferred filename for the content, using the `filename*` parameter if present, falling back to the `filename` parameter.\n   *\n   * From [RFC 6266](https://tools.ietf.org/html/rfc6266):\n   *\n   * Many user agent implementations predating this specification do not understand the \"filename*\" parameter.\n   * Therefore, when both \"filename\" and \"filename*\" are present in a single header field value, recipients SHOULD\n   * pick \"filename*\" and ignore \"filename\". This way, senders can avoid special-casing specific user agents by\n   * sending both the more expressive \"filename*\" parameter, and the \"filename\" parameter as fallback for legacy recipients.\n   */\n  get preferredFilename() {\n    let filenameSplat = this.filenameSplat;\n    if (filenameSplat) {\n      let decodedFilename = decodeFilenameSplat(filenameSplat);\n      if (decodedFilename)\n        return decodedFilename;\n    }\n    return this.filename;\n  }\n  toString() {\n    if (!this.type) {\n      return \"\";\n    }\n    let parts = [this.type];\n    if (this.name) {\n      parts.push(`name=${quote(this.name)}`);\n    }\n    if (this.filename) {\n      parts.push(`filename=${quote(this.filename)}`);\n    }\n    if (this.filenameSplat) {\n      parts.push(`filename*=${quote(this.filenameSplat)}`);\n    }\n    return parts.join(\"; \");\n  }\n}\nfunction decodeFilenameSplat(value) {\n  let match = value.match(/^([\\w-]+)'([^']*)'(.+)$/);\n  if (!match)\n    return null;\n  let [, charset, , encodedFilename] = match;\n  let decodedFilename = percentDecode(encodedFilename);\n  try {\n    let decoder = new TextDecoder(charset);\n    let bytes = new Uint8Array(decodedFilename.split(\"\").map((char) => char.charCodeAt(0)));\n    return decoder.decode(bytes);\n  } catch (error) {\n    console.warn(`Failed to decode filename from charset ${charset}:`, error);\n    return decodedFilename;\n  }\n}\nfunction percentDecode(value) {\n  return value.replace(/\\+/g, \" \").replace(/%([0-9A-Fa-f]{2})/g, (_, hex) => {\n    return String.fromCharCode(parseInt(hex, 16));\n  });\n}\n\nclass ContentRange {\n  unit = \"\";\n  start = null;\n  end = null;\n  size;\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        let match = init.match(/^(\\w+)\\s+(?:(\\d+)-(\\d+)|\\*)\\/((?:\\d+|\\*))$/);\n        if (match) {\n          this.unit = match[1];\n          this.start = match[2] ? parseInt(match[2], 10) : null;\n          this.end = match[3] ? parseInt(match[3], 10) : null;\n          this.size = match[4] === \"*\" ? \"*\" : parseInt(match[4], 10);\n        }\n      } else {\n        if (init.unit !== void 0)\n          this.unit = init.unit;\n        if (init.start !== void 0)\n          this.start = init.start;\n        if (init.end !== void 0)\n          this.end = init.end;\n        if (init.size !== void 0)\n          this.size = init.size;\n      }\n    }\n  }\n  toString() {\n    if (!this.unit || this.size === void 0)\n      return \"\";\n    let range = this.start !== null && this.end !== null ? `${this.start}-${this.end}` : \"*\";\n    return `${this.unit} ${range}/${this.size}`;\n  }\n}\n\nclass ContentType {\n  boundary;\n  charset;\n  mediaType;\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        let params = parseParams(init);\n        if (params.length > 0) {\n          this.mediaType = params[0][0];\n          for (let [name, value] of params.slice(1)) {\n            if (name === \"boundary\") {\n              this.boundary = value;\n            } else if (name === \"charset\") {\n              this.charset = value;\n            }\n          }\n        }\n      } else {\n        this.boundary = init.boundary;\n        this.charset = init.charset;\n        this.mediaType = init.mediaType;\n      }\n    }\n  }\n  toString() {\n    if (!this.mediaType) {\n      return \"\";\n    }\n    let parts = [this.mediaType];\n    if (this.charset) {\n      parts.push(`charset=${quote(this.charset)}`);\n    }\n    if (this.boundary) {\n      parts.push(`boundary=${quote(this.boundary)}`);\n    }\n    return parts.join(\"; \");\n  }\n}\n\nclass Cookie {\n  #map;\n  constructor(init) {\n    this.#map = /* @__PURE__ */ new Map();\n    if (init) {\n      if (typeof init === \"string\") {\n        let params = parseParams(init);\n        for (let [name, value] of params) {\n          this.#map.set(name, value ?? \"\");\n        }\n      } else if (isIterable(init)) {\n        for (let [name, value] of init) {\n          this.#map.set(name, value);\n        }\n      } else {\n        for (let name of Object.getOwnPropertyNames(init)) {\n          this.#map.set(name, init[name]);\n        }\n      }\n    }\n  }\n  /**\n   * An array of the names of the cookies in the header.\n   */\n  get names() {\n    return Array.from(this.#map.keys());\n  }\n  /**\n   * An array of the values of the cookies in the header.\n   */\n  get values() {\n    return Array.from(this.#map.values());\n  }\n  /**\n   * The number of cookies in the header.\n   */\n  get size() {\n    return this.#map.size;\n  }\n  /**\n   * Gets the value of a cookie with the given name from the header.\n   * @param name The name of the cookie.\n   * @returns The value of the cookie, or `null` if the cookie does not exist.\n   */\n  get(name) {\n    return this.#map.get(name) ?? null;\n  }\n  /**\n   * Sets a cookie with the given name and value in the header.\n   * @param name The name of the cookie.\n   * @param value The value of the cookie.\n   */\n  set(name, value) {\n    this.#map.set(name, value);\n  }\n  /**\n   * Removes a cookie with the given name from the header.\n   * @param name The name of the cookie.\n   */\n  delete(name) {\n    this.#map.delete(name);\n  }\n  /**\n   * True if a cookie with the given name exists in the header.\n   * @param name The name of the cookie.\n   * @returns True if a cookie with the given name exists in the header.\n   */\n  has(name) {\n    return this.#map.has(name);\n  }\n  /**\n   * Removes all cookies from the header.\n   */\n  clear() {\n    this.#map.clear();\n  }\n  entries() {\n    return this.#map.entries();\n  }\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  forEach(callback, thisArg) {\n    for (let [name, value] of this) {\n      callback.call(thisArg, name, value, this);\n    }\n  }\n  toString() {\n    let pairs = [];\n    for (let [name, value] of this.#map) {\n      pairs.push(`${name}=${quote(value)}`);\n    }\n    return pairs.join(\"; \");\n  }\n}\n\nclass IfMatch {\n  tags = [];\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        this.tags.push(...init.split(/\\s*,\\s*/).map(quoteEtag));\n      } else if (Array.isArray(init)) {\n        this.tags.push(...init.map(quoteEtag));\n      } else {\n        this.tags.push(...init.tags.map(quoteEtag));\n      }\n    }\n  }\n  /**\n   * Checks if the header contains the given entity tag.\n   *\n   * Note: This method checks only for exact matches and does not consider wildcards.\n   *\n   * @param tag The entity tag to check for.\n   * @returns `true` if the tag is present in the header, `false` otherwise.\n   */\n  has(tag) {\n    return this.tags.includes(quoteEtag(tag));\n  }\n  /**\n   * Checks if the precondition passes for the given entity tag.\n   *\n   * This method always returns `true` if the `If-Match` header is not present\n   * since the precondition passes regardless of the entity tag being checked.\n   *\n   * Uses strong comparison as per RFC 9110, meaning weak entity tags (prefixed with `W/`)\n   * will never match.\n   *\n   * @param tag The entity tag to check against.\n   * @returns `true` if the precondition passes, `false` if it fails (should return 412).\n   */\n  matches(tag) {\n    if (this.tags.length === 0) {\n      return true;\n    }\n    if (this.tags.includes(\"*\")) {\n      return true;\n    }\n    let normalizedTag = quoteEtag(tag);\n    if (normalizedTag.startsWith(\"W/\")) {\n      return false;\n    }\n    for (let headerTag of this.tags) {\n      if (!headerTag.startsWith(\"W/\") && headerTag === normalizedTag) {\n        return true;\n      }\n    }\n    return false;\n  }\n  toString() {\n    return this.tags.join(\", \");\n  }\n}\n\nclass IfNoneMatch {\n  tags = [];\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        this.tags.push(...init.split(/\\s*,\\s*/).map(quoteEtag));\n      } else if (Array.isArray(init)) {\n        this.tags.push(...init.map(quoteEtag));\n      } else {\n        this.tags.push(...init.tags.map(quoteEtag));\n      }\n    }\n  }\n  /**\n   * Checks if the header contains the given entity tag.\n   *\n   * Note: This method checks only for exact matches and does not consider wildcards.\n   *\n   * @param tag The entity tag to check for.\n   * @returns `true` if the tag is present in the header, `false` otherwise.\n   */\n  has(tag) {\n    return this.tags.includes(quoteEtag(tag));\n  }\n  /**\n   * Checks if this header matches the given entity tag.\n   *\n   * @param tag The entity tag to check for.\n   * @returns `true` if the tag is present in the header (or the header contains a wildcard), `false` otherwise.\n   */\n  matches(tag) {\n    return this.has(tag) || this.tags.includes(\"*\");\n  }\n  toString() {\n    return this.tags.join(\", \");\n  }\n}\n\nclass IfRange {\n  value = \"\";\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        this.value = init;\n      } else {\n        this.value = init.toUTCString();\n      }\n    }\n  }\n  /**\n   * Checks if the `If-Range` condition is satisfied for the current resource state.\n   *\n   * This method always returns `true` if the `If-Range` header is not present,\n   * meaning the range request should proceed unconditionally.\n   *\n   * The `If-Range` header can contain either:\n   * - An HTTP date (RFC 7231 IMF-fixdate format)\n   * - An entity tag (ETag)\n   *\n   * When comparing ETags, only strong entity tags are matched as per RFC 7233.\n   * Weak entity tags (prefixed with `W/`) are never considered a match.\n   *\n   * @param resource The current resource state to compare against\n   * @returns `true` if the condition is satisfied, `false` otherwise\n   *\n   * @example\n   * ```ts\n   * let ifRange = new IfRange('Wed, 21 Oct 2015 07:28:00 GMT')\n   * ifRange.matches({ lastModified: 1445412480000 }) // true if dates match\n   * ifRange.matches({ lastModified: new Date('2015-10-21T07:28:00Z') }) // true\n   *\n   * let ifRange2 = new IfRange('\"abc123\"')\n   * ifRange2.matches({ etag: '\"abc123\"' }) // true\n   * ifRange2.matches({ etag: 'W/\"abc123\"' }) // false (weak ETag)\n   * ```\n   */\n  matches(resource) {\n    if (!this.value) {\n      return true;\n    }\n    let dateTimestamp = parseHttpDate(this.value);\n    if (dateTimestamp !== null && resource.lastModified != null) {\n      return removeMilliseconds(dateTimestamp) === removeMilliseconds(resource.lastModified);\n    }\n    if (resource.etag != null) {\n      let normalizedTag = quoteEtag(this.value);\n      let normalizedResourceTag = quoteEtag(resource.etag);\n      if (normalizedTag.startsWith(\"W/\") || normalizedResourceTag.startsWith(\"W/\")) {\n        return false;\n      }\n      return normalizedTag === normalizedResourceTag;\n    }\n    return false;\n  }\n  toString() {\n    return this.value;\n  }\n}\n\nclass Range {\n  unit = \"\";\n  ranges = [];\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        let match = init.match(/^(\\w+)=(.+)$/);\n        if (match) {\n          this.unit = match[1];\n          let rangeParts = match[2].split(\",\");\n          let hasInvalidPart = false;\n          for (let part of rangeParts) {\n            let rangeMatch = part.trim().match(/^(\\d*)-(\\d*)$/);\n            if (!rangeMatch) {\n              hasInvalidPart = true;\n              continue;\n            }\n            let [, startStr, endStr] = rangeMatch;\n            if (!startStr && !endStr) {\n              hasInvalidPart = true;\n              continue;\n            }\n            let start = startStr ? parseInt(startStr, 10) : void 0;\n            let end = endStr ? parseInt(endStr, 10) : void 0;\n            if (start !== void 0 && end !== void 0 && start > end) {\n              hasInvalidPart = true;\n              continue;\n            }\n            this.ranges.push({ start, end });\n          }\n          if (hasInvalidPart) {\n            this.ranges = [];\n          }\n        }\n      } else {\n        if (init.unit !== void 0)\n          this.unit = init.unit;\n        if (init.ranges !== void 0)\n          this.ranges = init.ranges;\n      }\n    }\n  }\n  /**\n   * Checks if this range can be satisfied for a resource of the given size.\n   * Returns false if the range is malformed or all ranges are beyond the resource size.\n   */\n  canSatisfy(resourceSize) {\n    if (!this.unit || this.ranges.length === 0)\n      return false;\n    for (let range of this.ranges) {\n      if (range.start === void 0 && range.end === void 0) {\n        return false;\n      }\n      if (range.start !== void 0 && range.end !== void 0 && range.start > range.end) {\n        return false;\n      }\n    }\n    for (let range of this.ranges) {\n      if (range.start === void 0) {\n        return true;\n      }\n      if (range.start < resourceSize) {\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * Normalizes the ranges for a resource of the given size.\n   * Returns an array of ranges with resolved start and end values.\n   * Returns an empty array if the range cannot be satisfied.\n   */\n  normalize(resourceSize) {\n    if (!this.canSatisfy(resourceSize)) {\n      return [];\n    }\n    return this.ranges.map((range) => {\n      if (range.start !== void 0 && range.end !== void 0) {\n        return {\n          start: range.start,\n          end: Math.min(range.end, resourceSize - 1)\n        };\n      } else if (range.start !== void 0) {\n        return {\n          start: range.start,\n          end: resourceSize - 1\n        };\n      } else {\n        let suffix = range.end;\n        return {\n          start: Math.max(0, resourceSize - suffix),\n          end: resourceSize - 1\n        };\n      }\n    });\n  }\n  toString() {\n    if (!this.unit || this.ranges.length === 0)\n      return \"\";\n    let rangeParts = this.ranges.map((range) => {\n      if (range.start !== void 0 && range.end !== void 0) {\n        return `${range.start}-${range.end}`;\n      } else if (range.start !== void 0) {\n        return `${range.start}-`;\n      } else if (range.end !== void 0) {\n        return `-${range.end}`;\n      }\n      return \"\";\n    });\n    return `${this.unit}=${rangeParts.join(\",\")}`;\n  }\n}\n\nclass SetCookie {\n  domain;\n  expires;\n  httpOnly;\n  maxAge;\n  name;\n  partitioned;\n  path;\n  sameSite;\n  secure;\n  value;\n  constructor(init) {\n    if (init) {\n      if (typeof init === \"string\") {\n        let params = parseParams(init);\n        if (params.length > 0) {\n          this.name = params[0][0];\n          this.value = params[0][1];\n          for (let [key, value] of params.slice(1)) {\n            switch (key.toLowerCase()) {\n              case \"domain\":\n                this.domain = value;\n                break;\n              case \"expires\": {\n                if (typeof value === \"string\") {\n                  let date = new Date(value);\n                  if (isValidDate(date)) {\n                    this.expires = date;\n                  }\n                }\n                break;\n              }\n              case \"httponly\":\n                this.httpOnly = true;\n                break;\n              case \"max-age\": {\n                if (typeof value === \"string\") {\n                  let v = parseInt(value, 10);\n                  if (!isNaN(v))\n                    this.maxAge = v;\n                }\n                break;\n              }\n              case \"partitioned\":\n                this.partitioned = true;\n                break;\n              case \"path\":\n                this.path = value;\n                break;\n              case \"samesite\":\n                if (typeof value === \"string\" && /strict|lax|none/i.test(value)) {\n                  this.sameSite = capitalize(value);\n                }\n                break;\n              case \"secure\":\n                this.secure = true;\n                break;\n            }\n          }\n        }\n      } else {\n        this.domain = init.domain;\n        this.expires = init.expires;\n        this.httpOnly = init.httpOnly;\n        this.maxAge = init.maxAge;\n        this.name = init.name;\n        this.partitioned = init.partitioned;\n        this.path = init.path;\n        this.sameSite = init.sameSite;\n        this.secure = init.secure;\n        this.value = init.value;\n      }\n    }\n  }\n  toString() {\n    if (!this.name) {\n      return \"\";\n    }\n    let parts = [`${this.name}=${quote(this.value || \"\")}`];\n    if (this.domain) {\n      parts.push(`Domain=${this.domain}`);\n    }\n    if (this.expires) {\n      parts.push(`Expires=${this.expires.toUTCString()}`);\n    }\n    if (this.httpOnly) {\n      parts.push(\"HttpOnly\");\n    }\n    if (this.maxAge) {\n      parts.push(`Max-Age=${this.maxAge}`);\n    }\n    if (this.partitioned) {\n      parts.push(\"Partitioned\");\n    }\n    if (this.path) {\n      parts.push(`Path=${this.path}`);\n    }\n    if (this.sameSite) {\n      parts.push(`SameSite=${this.sameSite}`);\n    }\n    if (this.secure) {\n      parts.push(\"Secure\");\n    }\n    return parts.join(\"; \");\n  }\n}\n\nconst HeaderWordCasingExceptions = {\n  ct: \"CT\",\n  etag: \"ETag\",\n  te: \"TE\",\n  www: \"WWW\",\n  x: \"X\",\n  xss: \"XSS\"\n};\nfunction canonicalHeaderName(name) {\n  return name.toLowerCase().split(\"-\").map((word) => HeaderWordCasingExceptions[word] || word.charAt(0).toUpperCase() + word.slice(1)).join(\"-\");\n}\n\nconst CRLF = \"\\r\\n\";\nconst AcceptKey = \"accept\";\nconst AcceptEncodingKey = \"accept-encoding\";\nconst AcceptLanguageKey = \"accept-language\";\nconst AcceptRangesKey = \"accept-ranges\";\nconst AgeKey = \"age\";\nconst AllowKey = \"allow\";\nconst CacheControlKey = \"cache-control\";\nconst ConnectionKey = \"connection\";\nconst ContentDispositionKey = \"content-disposition\";\nconst ContentEncodingKey = \"content-encoding\";\nconst ContentLanguageKey = \"content-language\";\nconst ContentLengthKey = \"content-length\";\nconst ContentRangeKey = \"content-range\";\nconst ContentTypeKey = \"content-type\";\nconst CookieKey = \"cookie\";\nconst DateKey = \"date\";\nconst ETagKey = \"etag\";\nconst ExpiresKey = \"expires\";\nconst HostKey = \"host\";\nconst IfMatchKey = \"if-match\";\nconst IfModifiedSinceKey = \"if-modified-since\";\nconst IfNoneMatchKey = \"if-none-match\";\nconst IfRangeKey = \"if-range\";\nconst IfUnmodifiedSinceKey = \"if-unmodified-since\";\nconst LastModifiedKey = \"last-modified\";\nconst LocationKey = \"location\";\nconst RangeKey = \"range\";\nconst RefererKey = \"referer\";\nconst SetCookieKey = \"set-cookie\";\nclass SuperHeaders extends Headers {\n  #map;\n  #setCookies = [];\n  constructor(init) {\n    super();\n    this.#map = /* @__PURE__ */ new Map();\n    if (init) {\n      if (typeof init === \"string\") {\n        let lines = init.split(CRLF);\n        for (let line of lines) {\n          let match = line.match(/^([^:]+):(.*)/);\n          if (match) {\n            this.append(match[1].trim(), match[2].trim());\n          }\n        }\n      } else if (isIterable(init)) {\n        for (let [name, value] of init) {\n          this.append(name, value);\n        }\n      } else if (typeof init === \"object\") {\n        for (let name of Object.getOwnPropertyNames(init)) {\n          let value = init[name];\n          let descriptor = Object.getOwnPropertyDescriptor(SuperHeaders.prototype, name);\n          if (descriptor?.set) {\n            descriptor.set.call(this, value);\n          } else {\n            this.set(name, value.toString());\n          }\n        }\n      }\n    }\n  }\n  /**\n   * Appends a new header value to the existing set of values for a header,\n   * or adds the header if it does not already exist.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/append)\n   */\n  append(name, value) {\n    let key = name.toLowerCase();\n    if (key === SetCookieKey) {\n      this.#setCookies.push(value);\n    } else {\n      let existingValue = this.#map.get(key);\n      this.#map.set(key, existingValue ? `${existingValue}, ${value}` : value);\n    }\n  }\n  /**\n   * Removes a header.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/delete)\n   */\n  delete(name) {\n    let key = name.toLowerCase();\n    if (key === SetCookieKey) {\n      this.#setCookies = [];\n    } else {\n      this.#map.delete(key);\n    }\n  }\n  /**\n   * Returns a string of all the values for a header, or `null` if the header does not exist.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/get)\n   */\n  get(name) {\n    let key = name.toLowerCase();\n    if (key === SetCookieKey) {\n      return this.getSetCookie().join(\", \");\n    } else {\n      let value = this.#map.get(key);\n      if (typeof value === \"string\") {\n        return value;\n      } else if (value != null) {\n        let str = value.toString();\n        return str === \"\" ? null : str;\n      } else {\n        return null;\n      }\n    }\n  }\n  /**\n   * Returns an array of all values associated with the `Set-Cookie` header. This is\n   * useful when building headers for a HTTP response since multiple `Set-Cookie` headers\n   * must be sent on separate lines.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/getSetCookie)\n   */\n  getSetCookie() {\n    return this.#setCookies.map((v) => typeof v === \"string\" ? v : v.toString());\n  }\n  /**\n   * Returns `true` if the header is present in the list of headers.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/has)\n   */\n  has(name) {\n    let key = name.toLowerCase();\n    return key === SetCookieKey ? this.#setCookies.length > 0 : this.get(key) != null;\n  }\n  /**\n   * Sets a new value for the given header. If the header already exists, the new value\n   * will replace the existing value.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/set)\n   */\n  set(name, value) {\n    let key = name.toLowerCase();\n    if (key === SetCookieKey) {\n      this.#setCookies = [value];\n    } else {\n      this.#map.set(key, value);\n    }\n  }\n  /**\n   * Returns an iterator of all header keys (lowercase).\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/keys)\n   */\n  *keys() {\n    for (let [key] of this)\n      yield key;\n  }\n  /**\n   * Returns an iterator of all header values.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/values)\n   */\n  *values() {\n    for (let [, value] of this)\n      yield value;\n  }\n  /**\n   * Returns an iterator of all header key/value pairs.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/entries)\n   */\n  *entries() {\n    for (let [key] of this.#map) {\n      let str = this.get(key);\n      if (str)\n        yield [key, str];\n    }\n    for (let value of this.getSetCookie()) {\n      yield [SetCookieKey, value];\n    }\n  }\n  [Symbol.iterator]() {\n    return this.entries();\n  }\n  /**\n   * Invokes the `callback` for each header key/value pair.\n   *\n   * [MDN Reference](https://developer.mozilla.org/en-US/docs/Web/API/Headers/forEach)\n   */\n  forEach(callback, thisArg) {\n    for (let [key, value] of this) {\n      callback.call(thisArg, value, key, this);\n    }\n  }\n  /**\n   * Returns a string representation of the headers suitable for use in a HTTP message.\n   */\n  toString() {\n    let lines = [];\n    for (let [key, value] of this) {\n      lines.push(`${canonicalHeaderName(key)}: ${value}`);\n    }\n    return lines.join(CRLF);\n  }\n  // Header-specific getters and setters\n  /**\n   * The `Accept` header is used by clients to indicate the media types that are acceptable\n   * in the response.\n   *\n   * [MDN `Accept` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-5.3.2)\n   */\n  get accept() {\n    return this.#getHeaderValue(AcceptKey, Accept);\n  }\n  set accept(value) {\n    this.#setHeaderValue(AcceptKey, Accept, value);\n  }\n  /**\n   * The `Accept-Encoding` header contains information about the content encodings that the client\n   * is willing to accept in the response.\n   *\n   * [MDN `Accept-Encoding` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Encoding)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-5.3.4)\n   */\n  get acceptEncoding() {\n    return this.#getHeaderValue(AcceptEncodingKey, AcceptEncoding);\n  }\n  set acceptEncoding(value) {\n    this.#setHeaderValue(AcceptEncodingKey, AcceptEncoding, value);\n  }\n  /**\n   * The `Accept-Language` header contains information about preferred natural language for the\n   * response.\n   *\n   * [MDN `Accept-Language` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-5.3.5)\n   */\n  get acceptLanguage() {\n    return this.#getHeaderValue(AcceptLanguageKey, AcceptLanguage);\n  }\n  set acceptLanguage(value) {\n    this.#setHeaderValue(AcceptLanguageKey, AcceptLanguage, value);\n  }\n  /**\n   * The `Accept-Ranges` header indicates the server's acceptance of range requests.\n   *\n   * [MDN `Accept-Ranges` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Ranges)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7233#section-2.3)\n   */\n  get acceptRanges() {\n    return this.#getStringValue(AcceptRangesKey);\n  }\n  set acceptRanges(value) {\n    this.#setStringValue(AcceptRangesKey, value);\n  }\n  /**\n   * The `Age` header contains the time in seconds an object was in a proxy cache.\n   *\n   * [MDN `Age` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Age)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7234#section-5.1)\n   */\n  get age() {\n    return this.#getNumberValue(AgeKey);\n  }\n  set age(value) {\n    this.#setNumberValue(AgeKey, value);\n  }\n  /**\n   * The `Allow` header lists the HTTP methods that are supported by the resource.\n   *\n   * [MDN `Allow` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Allow)\n   *\n   * [HTTP/1.1 Specification](https://httpwg.org/specs/rfc9110.html#field.allow)\n   */\n  get allow() {\n    return this.#getStringValue(AllowKey);\n  }\n  set allow(value) {\n    this.#setStringValue(AllowKey, Array.isArray(value) ? value.join(\", \") : value);\n  }\n  /**\n   * The `Cache-Control` header contains directives for caching mechanisms in both requests and responses.\n   *\n   * [MDN `Cache-Control` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7234#section-5.2)\n   */\n  get cacheControl() {\n    return this.#getHeaderValue(CacheControlKey, CacheControl);\n  }\n  set cacheControl(value) {\n    this.#setHeaderValue(CacheControlKey, CacheControl, value);\n  }\n  /**\n   * The `Connection` header controls whether the network connection stays open after the current\n   * transaction finishes.\n   *\n   * [MDN `Connection` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Connection)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7230#section-6.1)\n   */\n  get connection() {\n    return this.#getStringValue(ConnectionKey);\n  }\n  set connection(value) {\n    this.#setStringValue(ConnectionKey, value);\n  }\n  /**\n   * The `Content-Disposition` header is a response-type header that describes how the payload is displayed.\n   *\n   * [MDN `Content-Disposition` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)\n   *\n   * [RFC 6266](https://datatracker.ietf.org/doc/html/rfc6266)\n   */\n  get contentDisposition() {\n    return this.#getHeaderValue(ContentDispositionKey, ContentDisposition);\n  }\n  set contentDisposition(value) {\n    this.#setHeaderValue(ContentDispositionKey, ContentDisposition, value);\n  }\n  /**\n   * The `Content-Encoding` header specifies the encoding of the resource.\n   *\n   * Note: If multiple encodings have been used, this value may be a comma-separated list. However, most often this\n   * header will only contain a single value.\n   *\n   * [MDN `Content-Encoding` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding)\n   *\n   * [HTTP/1.1 Specification](https://httpwg.org/specs/rfc9110.html#field.content-encoding)\n   */\n  get contentEncoding() {\n    return this.#getStringValue(ContentEncodingKey);\n  }\n  set contentEncoding(value) {\n    this.#setStringValue(ContentEncodingKey, Array.isArray(value) ? value.join(\", \") : value);\n  }\n  /**\n   * The `Content-Language` header describes the natural language(s) of the intended audience for the response content.\n   *\n   * Note: If the response content is intended for multiple audiences, this value may be a comma-separated list. However,\n   * most often this header will only contain a single value.\n   *\n   * [MDN `Content-Language` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Language)\n   *\n   * [HTTP/1.1 Specification](https://httpwg.org/specs/rfc9110.html#field.content-language)\n   */\n  get contentLanguage() {\n    return this.#getStringValue(ContentLanguageKey);\n  }\n  set contentLanguage(value) {\n    this.#setStringValue(ContentLanguageKey, Array.isArray(value) ? value.join(\", \") : value);\n  }\n  /**\n   * The `Content-Length` header indicates the size of the entity-body in bytes.\n   *\n   * [MDN `Content-Length` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Length)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7230#section-3.3.2)\n   */\n  get contentLength() {\n    return this.#getNumberValue(ContentLengthKey);\n  }\n  set contentLength(value) {\n    this.#setNumberValue(ContentLengthKey, value);\n  }\n  /**\n   * The `Content-Range` header indicates where the content of a response body\n   * belongs in relation to a complete resource.\n   *\n   * [MDN `Content-Range` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Range)\n   *\n   * [HTTP/1.1 Specification](https://httpwg.org/specs/rfc9110.html#field.content-range)\n   */\n  get contentRange() {\n    return this.#getHeaderValue(ContentRangeKey, ContentRange);\n  }\n  set contentRange(value) {\n    this.#setHeaderValue(ContentRangeKey, ContentRange, value);\n  }\n  /**\n   * The `Content-Type` header indicates the media type of the resource.\n   *\n   * [MDN `Content-Type` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-3.1.1.5)\n   */\n  get contentType() {\n    return this.#getHeaderValue(ContentTypeKey, ContentType);\n  }\n  set contentType(value) {\n    this.#setHeaderValue(ContentTypeKey, ContentType, value);\n  }\n  /**\n   * The `Cookie` request header contains stored HTTP cookies previously sent by the server with\n   * the `Set-Cookie` header.\n   *\n   * [MDN `Cookie` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cookie)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc6265#section-5.4)\n   */\n  get cookie() {\n    return this.#getHeaderValue(CookieKey, Cookie);\n  }\n  set cookie(value) {\n    this.#setHeaderValue(CookieKey, Cookie, value);\n  }\n  /**\n   * The `Date` header contains the date and time at which the message was sent.\n   *\n   * [MDN `Date` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Date)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-7.1.1.2)\n   */\n  get date() {\n    return this.#getDateValue(DateKey);\n  }\n  set date(value) {\n    this.#setDateValue(DateKey, value);\n  }\n  /**\n   * The `ETag` header provides a unique identifier for the current version of the resource.\n   *\n   * [MDN `ETag` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7232#section-2.3)\n   */\n  get etag() {\n    return this.#getStringValue(ETagKey);\n  }\n  set etag(value) {\n    this.#setStringValue(ETagKey, typeof value === \"string\" ? quoteEtag(value) : value);\n  }\n  /**\n   * The `Expires` header contains the date/time after which the response is considered stale.\n   *\n   * [MDN `Expires` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expires)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7234#section-5.3)\n   */\n  get expires() {\n    return this.#getDateValue(ExpiresKey);\n  }\n  set expires(value) {\n    this.#setDateValue(ExpiresKey, value);\n  }\n  /**\n   * The `Host` header specifies the domain name of the server and (optionally) the TCP port number.\n   *\n   * [MDN `Host` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Host)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7230#section-5.4)\n   */\n  get host() {\n    return this.#getStringValue(HostKey);\n  }\n  set host(value) {\n    this.#setStringValue(HostKey, value);\n  }\n  /**\n   * The `If-Modified-Since` header makes a request conditional on the last modification date of the\n   * requested resource.\n   *\n   * [MDN `If-Modified-Since` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Modified-Since)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7232#section-3.3)\n   */\n  get ifModifiedSince() {\n    return this.#getDateValue(IfModifiedSinceKey);\n  }\n  set ifModifiedSince(value) {\n    this.#setDateValue(IfModifiedSinceKey, value);\n  }\n  /**\n   * The `If-Match` header makes a request conditional on the presence of a matching ETag.\n   *\n   * [MDN `If-Match` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Match)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7232#section-3.1)\n   */\n  get ifMatch() {\n    return this.#getHeaderValue(IfMatchKey, IfMatch);\n  }\n  set ifMatch(value) {\n    this.#setHeaderValue(IfMatchKey, IfMatch, value);\n  }\n  /**\n   * The `If-None-Match` header makes a request conditional on the absence of a matching ETag.\n   *\n   * [MDN `If-None-Match` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7232#section-3.2)\n   */\n  get ifNoneMatch() {\n    return this.#getHeaderValue(IfNoneMatchKey, IfNoneMatch);\n  }\n  set ifNoneMatch(value) {\n    this.#setHeaderValue(IfNoneMatchKey, IfNoneMatch, value);\n  }\n  /**\n   * The `If-Range` header makes a range request conditional on the resource state.\n   * Can contain either an entity tag (ETag) or an HTTP date.\n   *\n   * [MDN `If-Range` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Range)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7233#section-3.2)\n   */\n  get ifRange() {\n    return this.#getHeaderValue(IfRangeKey, IfRange);\n  }\n  set ifRange(value) {\n    this.#setHeaderValue(IfRangeKey, IfRange, value);\n  }\n  /**\n   * The `If-Unmodified-Since` header makes a request conditional on the last modification date of the\n   * requested resource.\n   *\n   * [MDN `If-Unmodified-Since` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Unmodified-Since)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7232#section-3.4)\n   */\n  get ifUnmodifiedSince() {\n    return this.#getDateValue(IfUnmodifiedSinceKey);\n  }\n  set ifUnmodifiedSince(value) {\n    this.#setDateValue(IfUnmodifiedSinceKey, value);\n  }\n  /**\n   * The `Last-Modified` header contains the date and time at which the resource was last modified.\n   *\n   * [MDN `Last-Modified` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Last-Modified)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7232#section-2.2)\n   */\n  get lastModified() {\n    return this.#getDateValue(LastModifiedKey);\n  }\n  set lastModified(value) {\n    this.#setDateValue(LastModifiedKey, value);\n  }\n  /**\n   * The `Location` header indicates the URL to redirect to.\n   *\n   * [MDN `Location` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Location)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-7.1.2)\n   */\n  get location() {\n    return this.#getStringValue(LocationKey);\n  }\n  set location(value) {\n    this.#setStringValue(LocationKey, value);\n  }\n  /**\n   * The `Range` header indicates the part of a resource that the client wants to receive.\n   *\n   * [MDN `Range` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range)\n   *\n   * [HTTP/1.1 Specification](https://httpwg.org/specs/rfc9110.html#field.range)\n   */\n  get range() {\n    return this.#getHeaderValue(RangeKey, Range);\n  }\n  set range(value) {\n    this.#setHeaderValue(RangeKey, Range, value);\n  }\n  /**\n   * The `Referer` header contains the address of the previous web page from which a link to the\n   * currently requested page was followed.\n   *\n   * [MDN `Referer` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc7231#section-5.5.2)\n   */\n  get referer() {\n    return this.#getStringValue(RefererKey);\n  }\n  set referer(value) {\n    this.#setStringValue(RefererKey, value);\n  }\n  /**\n   * The `Set-Cookie` header is used to send cookies from the server to the user agent.\n   *\n   * [MDN `Set-Cookie` Reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie)\n   *\n   * [HTTP/1.1 Specification](https://datatracker.ietf.org/doc/html/rfc6265#section-4.1)\n   */\n  get setCookie() {\n    let setCookies = this.#setCookies;\n    for (let i = 0; i < setCookies.length; ++i) {\n      if (typeof setCookies[i] === \"string\") {\n        setCookies[i] = new SetCookie(setCookies[i]);\n      }\n    }\n    return setCookies;\n  }\n  set setCookie(value) {\n    if (value != null) {\n      this.#setCookies = (Array.isArray(value) ? value : [value]).map((v) => typeof v === \"string\" ? v : new SetCookie(v));\n    } else {\n      this.#setCookies = [];\n    }\n  }\n  // Helpers\n  #getHeaderValue(key, ctor) {\n    let value = this.#map.get(key);\n    if (value !== void 0) {\n      if (typeof value === \"string\") {\n        let obj2 = new ctor(value);\n        this.#map.set(key, obj2);\n        return obj2;\n      } else {\n        return value;\n      }\n    }\n    let obj = new ctor();\n    this.#map.set(key, obj);\n    return obj;\n  }\n  #setHeaderValue(key, ctor, value) {\n    if (value != null) {\n      this.#map.set(key, typeof value === \"string\" ? value : new ctor(value));\n    } else {\n      this.#map.delete(key);\n    }\n  }\n  #getDateValue(key) {\n    let value = this.#map.get(key);\n    return value === void 0 ? null : new Date(value);\n  }\n  #setDateValue(key, value) {\n    if (value != null) {\n      this.#map.set(key, typeof value === \"string\" ? value : (typeof value === \"number\" ? new Date(value) : value).toUTCString());\n    } else {\n      this.#map.delete(key);\n    }\n  }\n  #getNumberValue(key) {\n    let value = this.#map.get(key);\n    return value === void 0 ? null : parseInt(value, 10);\n  }\n  #setNumberValue(key, value) {\n    if (value != null) {\n      this.#map.set(key, typeof value === \"string\" ? value : value.toString());\n    } else {\n      this.#map.delete(key);\n    }\n  }\n  #getStringValue(key) {\n    let value = this.#map.get(key);\n    return value === void 0 ? null : value;\n  }\n  #setStringValue(key, value) {\n    if (value != null) {\n      this.#map.set(key, value);\n    } else {\n      this.#map.delete(key);\n    }\n  }\n}\n\nconst HeaderUtilities = {\n  /**\n   * Check if client accepts a specific media type based on Accept header.\n   * @param acceptHeader HTTP Accept header value\n   * @param mediaType Media type to check for acceptance\n   * @returns True if the media type is accepted by the client\n   */\n  acceptsMediaType(acceptHeader, mediaType) {\n    const accept = this.parseAccept(acceptHeader);\n    return accept ? accept.accepts(mediaType) : false;\n  },\n  /**\n   * Create Cache-Control header value from options.\n   * @param options Cache control directives configuration\n   * @returns Cache-Control header value string\n   */\n  createCacheControl(options) {\n    const directives = [];\n    if (options.public) {\n      directives.push(\"public\");\n    }\n    if (options.private) {\n      directives.push(\"private\");\n    }\n    if (options.noCache) {\n      directives.push(\"no-cache\");\n    }\n    if (options.noStore) {\n      directives.push(\"no-store\");\n    }\n    if (options.immutable) {\n      directives.push(\"immutable\");\n    }\n    if (options.mustRevalidate) {\n      directives.push(\"must-revalidate\");\n    }\n    if (options.proxyRevalidate) {\n      directives.push(\"proxy-revalidate\");\n    }\n    if (options.maxAge !== void 0) {\n      directives.push(`max-age=${options.maxAge}`);\n    }\n    if (options.sMaxAge !== void 0) {\n      directives.push(`s-maxage=${options.sMaxAge}`);\n    }\n    if (options.minFresh !== void 0) {\n      directives.push(`min-fresh=${options.minFresh}`);\n    }\n    if (options.staleWhileRevalidate !== void 0) {\n      directives.push(`stale-while-revalidate=${options.staleWhileRevalidate}`);\n    }\n    if (options.staleIfError !== void 0) {\n      directives.push(`stale-if-error=${options.staleIfError}`);\n    }\n    return directives.join(\", \");\n  },\n  /**\n   * Create common cache control presets with predefined configurations.\n   * @param preset Preset name ('no-cache', 'no-store', 'public', 'private', or 'immutable')\n   * @returns Cache-Control header value string for the preset\n   */\n  createCacheControlPreset(preset) {\n    const presets = {\n      immutable: { immutable: true, maxAge: 31536e3 },\n      // 1 year\n      \"no-cache\": { noCache: true },\n      \"no-store\": { noStore: true },\n      private: { maxAge: 3600, private: true },\n      // 1 hour default\n      public: { maxAge: 3600, public: true }\n      // 1 hour default\n    };\n    return this.createCacheControl(presets[preset]);\n  },\n  /**\n   * Create Content-Disposition header for file downloads with optional filename.\n   * @param options\n   * @param options.filename Filename for the download\n   * @param options.filenameSplat Alternative filename format\n   * @param options.type Disposition type ('inline' or 'attachment')\n   * @returns Content-Disposition header value string\n   */\n  createContentDisposition(options) {\n    const disposition = new ContentDisposition({\n      type: options.type,\n      ...options.filename && { filename: options.filename },\n      ...options.filenameSplat && { filenameSplat: options.filenameSplat }\n    });\n    return disposition.toString();\n  },\n  /**\n   * Create Content-Type header value from structured data with optional charset and boundary.\n   * @param options\n   * @param options.boundary Multipart boundary string\n   * @param options.charset Character encoding (e.g., 'utf8')\n   * @param options.mediaType MIME media type (e.g., 'application/json')\n   * @returns Content-Type header value string\n   */\n  createContentType(options) {\n    const contentType = new ContentType({\n      mediaType: options.mediaType,\n      ...options.charset && { charset: options.charset },\n      ...options.boundary && { boundary: options.boundary }\n    });\n    return contentType.toString();\n  },\n  /**\n   * Get content type with charset if not already present.\n   * @param contentType Content-Type header value to ensure charset for\n   * @param defaultCharset Default charset to use if not present (default: 'utf8')\n   * @returns Content-Type header value with charset ensured\n   */\n  ensureCharset(contentType, defaultCharset = \"utf8\") {\n    const ct = this.parseContentType(contentType);\n    if (!ct) {\n      return contentType;\n    }\n    if (!ct.charset) {\n      ct.charset = defaultCharset;\n    }\n    return ct.toString();\n  },\n  /**\n   * Convert our Headers type to EnhancedHeaders from remix-run/headers.\n   * @param headers Headers in array or object format\n   * @returns SuperHeaders instance with converted header values\n   */\n  fromHeaders(headers) {\n    const enhanced = new SuperHeaders();\n    if (Array.isArray(headers)) {\n      headers.forEach(([name, value]) => {\n        enhanced.set(name, Array.isArray(value) ? value.join(\", \") : String(value));\n      });\n    } else {\n      Object.entries(headers).forEach(([name, value]) => {\n        enhanced.set(name, Array.isArray(value) ? value.join(\", \") : String(value));\n      });\n    }\n    return enhanced;\n  },\n  /**\n   * Get preferred media type from Accept header based on quality factors and supported types.\n   * @param acceptHeader HTTP Accept header value\n   * @param supportedTypes Array of supported MIME types to match against\n   * @returns Best matching media type or undefined if no match found\n   */\n  getPreferredMediaType(acceptHeader, supportedTypes) {\n    const accept = this.parseAccept(acceptHeader);\n    if (!accept) {\n      return void 0;\n    }\n    for (const type of supportedTypes) {\n      if (accept.accepts(type)) {\n        return type;\n      }\n    }\n    return void 0;\n  },\n  /**\n   * Parse Accept header with quality factor support.\n   * @param headerValue HTTP Accept header value to parse\n   * @returns Accept instance or undefined if header is invalid or missing\n   */\n  parseAccept(headerValue) {\n    if (!headerValue) {\n      return void 0;\n    }\n    try {\n      return new Accept(headerValue);\n    } catch {\n      return void 0;\n    }\n  },\n  /**\n   * Parse Content-Disposition header into structured object.\n   * @param headerValue HTTP Content-Disposition header value to parse\n   * @returns ContentDisposition instance or undefined if header is invalid or missing\n   */\n  parseContentDisposition(headerValue) {\n    if (!headerValue) {\n      return void 0;\n    }\n    try {\n      return new ContentDisposition(headerValue);\n    } catch {\n      return void 0;\n    }\n  },\n  /**\n   * Parse Content-Type header with structured access to media type, charset, and boundary.\n   * @param headerValue HTTP Content-Type header value to parse\n   * @returns ContentType instance or undefined if header is invalid or missing\n   */\n  parseContentType(headerValue) {\n    if (!headerValue) {\n      return void 0;\n    }\n    try {\n      return new ContentType(headerValue);\n    } catch {\n      return void 0;\n    }\n  }\n};\n\nexport { HeaderUtilities as H, createHttpError as c, httpErrorsExports as h };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2884, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/ERRORS-DKaR93nv.js"],"sourcesContent":["var ERRORS = /* @__PURE__ */ ((ERRORS2) => {\n  ERRORS2[\"BAD_REQUEST\"] = \"BadRequest\";\n  ERRORS2[\"CHECKSUM_MISMATCH\"] = \"ChecksumMismatch\";\n  ERRORS2[\"FILE_CONFLICT\"] = \"FileConflict\";\n  ERRORS2[\"FILE_ERROR\"] = \"FileError\";\n  ERRORS2[\"FILE_LOCKED\"] = \"FileLocked\";\n  ERRORS2[\"FILE_NOT_ALLOWED\"] = \"FileNotAllowed\";\n  ERRORS2[\"FILE_NOT_FOUND\"] = \"FileNotFound\";\n  ERRORS2[\"FORBIDDEN\"] = \"Forbidden\";\n  ERRORS2[\"GONE\"] = \"Gone\";\n  ERRORS2[\"INVALID_FILE_NAME\"] = \"InvalidFileName\";\n  ERRORS2[\"INVALID_FILE_SIZE\"] = \"InvalidFileSize\";\n  ERRORS2[\"INVALID_RANGE\"] = \"InvalidRange\";\n  ERRORS2[\"INVALID_TYPE\"] = \"Invalidtype\";\n  ERRORS2[\"METHOD_NOT_ALLOWED\"] = \"MethodNotAllowed\";\n  ERRORS2[\"REQUEST_ABORTED\"] = \"RequestAborted\";\n  ERRORS2[\"REQUEST_ENTITY_TOO_LARGE\"] = \"RequestEntityTooLarge\";\n  ERRORS2[\"STORAGE_BUSY\"] = \"StorageBusy\";\n  ERRORS2[\"STORAGE_ERROR\"] = \"StorageError\";\n  ERRORS2[\"TOO_MANY_REQUESTS\"] = \"TooManyRequests\";\n  ERRORS2[\"UNKNOWN_ERROR\"] = \"UnknownError\";\n  ERRORS2[\"UNPROCESSABLE_ENTITY\"] = \"UnprocessableEntity\";\n  ERRORS2[\"UNSUPPORTED_CHECKSUM_ALGORITHM\"] = \"UnsupportedChecksumAlgorithm\";\n  ERRORS2[\"UNSUPPORTED_MEDIA_TYPE\"] = \"UnsupportedMediaType\";\n  return ERRORS2;\n})(ERRORS || {});\nconst ErrorMap = (() => {\n  const errors = {\n    BadRequest: [400, \"Bad request\"],\n    ChecksumMismatch: [460, \"Checksum mismatch\"],\n    FileConflict: [409, \"File conflict\"],\n    FileError: [500, \"Something went wrong writing the file\"],\n    FileLocked: [423, \"File locked\"],\n    FileNotAllowed: [403, \"File not allowed\"],\n    FileNotFound: [404, \"Not found\"],\n    Forbidden: [403, \"Authenticated user is not allowed access\"],\n    Gone: [410, \"The file for this url no longer exists\"],\n    InvalidFileName: [400, \"Invalid file name or it cannot be retrieved\"],\n    InvalidFileSize: [400, \"File size cannot be retrieved\"],\n    InvalidRange: [400, \"Invalid or missing content-range header\"],\n    Invalidtype: [400, 'Invalid or missing \"content-type\" header'],\n    MethodNotAllowed: [405, \"Method not allowed\"],\n    RequestAborted: [499, \"Request aborted\"],\n    RequestEntityTooLarge: [413, \"Request entity too large\"],\n    StorageBusy: [503, \"Storage is busy\"],\n    StorageError: [503, \"Storage error\"],\n    TooManyRequests: [429, \"Too many requests\"],\n    UnknownError: [500, \"Something went wrong\"],\n    UnprocessableEntity: [422, \"Validation failed\"],\n    UnsupportedChecksumAlgorithm: [400, \"Unsupported checksum algorithm\"],\n    UnsupportedMediaType: [415, \"Unsupported media type\"]\n  };\n  const errorMap = {};\n  Object.keys(errors).forEach((code) => {\n    const [statusCode, message] = errors[code];\n    errorMap[code] = { code, message, statusCode };\n  });\n  return errorMap;\n})();\nclass UploadError extends Error {\n  name = \"UploadError\";\n  /** The standardized error code from the ERRORS enum */\n  UploadErrorCode = \"UnknownError\" /* UNKNOWN_ERROR */;\n  /** Optional additional error details */\n  detail;\n  /**\n   * Creates a new UploadError instance.\n   * @param code Standardized error code (defaults to UNKNOWN_ERROR)\n   * @param message Human-readable error message (defaults to the code)\n   * @param detail Optional additional error details\n   */\n  constructor(code = \"UnknownError\" /* UNKNOWN_ERROR */, message, detail) {\n    super(message || code);\n    this.name = \"UploadError\";\n    this.detail = detail;\n    if (Object.values(ERRORS).includes(code)) {\n      this.UploadErrorCode = code;\n    }\n  }\n}\nconst isUploadError = (error) => !!error.UploadErrorCode;\nconst throwErrorCode = (UploadErrorCode, detail) => {\n  const errorResponse = ErrorMap[UploadErrorCode];\n  const error = new UploadError(detail || errorResponse?.message || \"UnknownError\" /* UNKNOWN_ERROR */);\n  error.UploadErrorCode = UploadErrorCode;\n  if (typeof detail === \"string\") {\n    error.detail = detail;\n  }\n  throw error;\n};\n\nexport { ERRORS, ErrorMap, UploadError, isUploadError, throwErrorCode };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3061, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/validator-InvzeyVl.js"],"sourcesContent":["import { ErrorMap } from './ERRORS-DKaR93nv.js';\n\nclass ValidationError extends Error {\n  /**\n   * Creates a new ValidationError instance.\n   * @param code Machine-readable error code\n   * @param statusCode HTTP status code for the error\n   * @param body Error response body (string or structured object)\n   * @param headers HTTP headers to include in error response\n   */\n  constructor(code, statusCode, body, headers) {\n    super(typeof body === \"string\" ? body : body?.message);\n    this.code = code;\n    this.statusCode = statusCode;\n    this.body = body;\n    this.headers = headers;\n    this.name = \"ValidationError\";\n  }\n}\n\nconst capitalize = (s) => s && s[0].toUpperCase() + s.slice(1);\nconst toResponse = (response) => {\n  if (!Array.isArray(response)) {\n    return response;\n  }\n  const [statusCode, body, headers] = response;\n  return { body, headers, statusCode };\n};\nclass Validator {\n  /**\n   * Creates a new Validator instance.\n   * @param prefix Prefix for generated error codes (default: \"ValidationError\")\n   */\n  constructor(prefix = \"ValidationError\") {\n    this.prefix = prefix;\n  }\n  validators = {};\n  /**\n   * Adds validation rules to the validator.\n   * Each rule must include an `isValid` function.\n   * @param config Validation configuration object\n   * @throws TypeError if any validator is missing the isValid function\n   */\n  add(config) {\n    Object.entries(config).forEach(([key, validator]) => {\n      const code = `${this.prefix}${capitalize(key)}`;\n      this.validators[code] = { ...this.validators[code], ...validator };\n      if (typeof this.validators[code].isValid !== \"function\") {\n        throw new TypeError('Validation config \"isValid\" is missing, or it is not a function!');\n      }\n    });\n  }\n  /**\n   * Verifies an object against all configured validation rules.\n   * Throws ValidationError on first validation failure.\n   * @param t Object to validate\n   * @throws ValidationError if validation fails\n   */\n  async verify(t) {\n    for await (const [code, validator] of Object.entries(this.validators)) {\n      const isValid = await validator.isValid(t);\n      if (!isValid) {\n        const errorResponse = validator.response || (code in ErrorMap ? ErrorMap[code] : ErrorMap.UnknownError);\n        const response = toResponse(errorResponse);\n        const { body, headers, message, statusCode } = response;\n        throw new ValidationError(code, statusCode, body || message, headers);\n      }\n    }\n  }\n}\nconst isValidationError = (error) => error.name === \"ValidationError\";\n\nexport { ValidationError as V, Validator as a, isValidationError as i };\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B;;;;;;GAMC,GACD,YAAY,IAAI,EAAE,UAAU,EAAE,IAAI,EAAE,OAAO,CAAE;QAC3C,KAAK,CAAC,OAAO,SAAS,WAAW,OAAO,MAAM;QAC9C,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,UAAU,GAAG;QAClB,IAAI,CAAC,IAAI,GAAG;QACZ,IAAI,CAAC,OAAO,GAAG;QACf,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEA,MAAM,aAAa,CAAC,IAAM,KAAK,CAAC,CAAC,EAAE,CAAC,WAAW,KAAK,EAAE,KAAK,CAAC;AAC5D,MAAM,aAAa,CAAC;IAClB,IAAI,CAAC,MAAM,OAAO,CAAC,WAAW;QAC5B,OAAO;IACT;IACA,MAAM,CAAC,YAAY,MAAM,QAAQ,GAAG;IACpC,OAAO;QAAE;QAAM;QAAS;IAAW;AACrC;AACA,MAAM;IACJ;;;GAGC,GACD,YAAY,SAAS,iBAAiB,CAAE;QACtC,IAAI,CAAC,MAAM,GAAG;IAChB;IACA,aAAa,CAAC,EAAE;IAChB;;;;;GAKC,GACD,IAAI,MAAM,EAAE;QACV,OAAO,OAAO,CAAC,QAAQ,OAAO,CAAC,CAAC,CAAC,KAAK,UAAU;YAC9C,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,GAAG,WAAW,MAAM;YAC/C,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG;gBAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK;gBAAE,GAAG,SAAS;YAAC;YACjE,IAAI,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,KAAK,YAAY;gBACvD,MAAM,IAAI,UAAU;YACtB;QACF;IACF;IACA;;;;;GAKC,GACD,MAAM,OAAO,CAAC,EAAE;QACd,WAAW,MAAM,CAAC,MAAM,UAAU,IAAI,OAAO,OAAO,CAAC,IAAI,CAAC,UAAU,EAAG;YACrE,MAAM,UAAU,MAAM,UAAU,OAAO,CAAC;YACxC,IAAI,CAAC,SAAS;gBACZ,MAAM,gBAAgB,UAAU,QAAQ,IAAI,CAAC,QAAQ,gLAAQ,GAAG,gLAAQ,CAAC,KAAK,GAAG,gLAAQ,CAAC,YAAY;gBACtG,MAAM,WAAW,WAAW;gBAC5B,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG;gBAC/C,MAAM,IAAI,gBAAgB,MAAM,YAAY,QAAQ,SAAS;YAC/D;QACF;IACF;AACF;AACA,MAAM,oBAAoB,CAAC,QAAU,MAAM,IAAI,KAAK"}},
    {"offset": {"line": 3159, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/base-handler-core-AWhpn4ts.js"],"sourcesContent":["import { EventEmitter } from 'node:events';\nimport { format } from 'node:url';\nimport mime from 'mime';\nimport { ErrorMap } from './ERRORS-DKaR93nv.js';\nimport { H as HeaderUtilities } from './headers-C9CQX79R.js';\nimport { Readable } from 'node:stream';\nimport 'type-is';\n\nconst getLastOne = (value) => value.at(-1);\n\nconst extractForwarded = (request) => {\n  let proto = \"\";\n  let host = \"\";\n  const header = getHeader(request, \"forwarded\");\n  if (header) {\n    const kvPairs = header.split(\";\");\n    kvPairs.forEach((kv) => {\n      const [token, value] = kv.split(\"=\");\n      if (token === \"proto\") {\n        proto = value;\n      }\n      if (token === \"host\") {\n        host = value;\n      }\n    });\n  }\n  return { host, proto };\n};\nconst readBody = (request, encoding = \"utf8\", limit) => new Promise((resolve, reject) => {\n  let body = \"\";\n  request.setEncoding(encoding);\n  request.on(\"data\", (chunk) => {\n    if (body.length + chunk.length > limit) {\n      return reject(new Error(\"Request body length limit exceeded\"));\n    }\n    body += chunk;\n  });\n  request.once(\"end\", () => resolve(body));\n});\nconst getHeader = (request, name, all = false) => {\n  const raw = request.headers?.[name.toLowerCase()];\n  if (!raw || raw.length === 0) {\n    return \"\";\n  }\n  return all ? raw.toString().trim() : getLastOne(Array.isArray(raw) ? raw : raw.split(\",\")).trim();\n};\nconst appendHeader = (response, name, value) => {\n  const s = [response.getHeader(name), value].flat().filter(Boolean).toString();\n  response.setHeader(name, s);\n};\nconst setHeaders = (response, headers = {}) => {\n  const keys = Object.keys(headers);\n  if (keys.length > 0) {\n    appendHeader(response, \"Access-Control-Expose-Headers\", keys);\n  }\n  keys.forEach((key) => {\n    if ([\"link\", \"location\"].includes(key.toLowerCase())) {\n      response.setHeader(key, encodeURI(headers[key].toString()));\n    } else {\n      response.setHeader(key, headers[key]);\n    }\n  });\n};\nconst extractHost = (request) => getHeader(request, \"host\") || getHeader(request, \"x-forwarded-host\");\nconst extractProto = (request) => getHeader(request, \"x-forwarded-proto\").toLowerCase();\nconst getBaseUrl = (request) => {\n  let { host, proto } = extractForwarded(request);\n  host ||= extractHost(request);\n  proto ||= extractProto(request);\n  if (!host) {\n    return \"\";\n  }\n  return proto ? `${proto}://${host}` : `//${host}`;\n};\nconst getRealPath = (request) => {\n  let realPath = (request.originalUrl || request.url || \"\").split(\"?\")[0];\n  if (!realPath) {\n    throw new TypeError(\"Invalid request URL\");\n  }\n  if (!realPath.startsWith(\"/\")) {\n    realPath = `/${realPath}`;\n  }\n  if (realPath.startsWith(\"http\")) {\n    const url = new URL(realPath);\n    realPath = url.pathname;\n  }\n  return realPath;\n};\nconst uuidRegex = /(?:[\\dA-Z]+-){2}[\\dA-Z]+/i;\nconst getIdFromRequest = (request) => {\n  const realPath = getRealPath(request);\n  const segments = realPath.split(\"/\").filter(Boolean);\n  if (segments.length === 0) {\n    throw new Error(\"Invalid request URL\");\n  }\n  for (let index = segments.length - 1; index >= 0; index--) {\n    const segment = segments[index];\n    if (!segment) {\n      continue;\n    }\n    const cleanSegment = segment.replace(/\\.[^/.]+$/, \"\");\n    const commonPathNames2 = [\"files\", \"metadata\", \"upload\", \"download\", \"http-rest\", \"http-rest-chunked\"];\n    if (commonPathNames2.includes(cleanSegment.toLowerCase())) {\n      continue;\n    }\n    if (uuidRegex.test(cleanSegment)) {\n      return cleanSegment;\n    }\n  }\n  const lastSegment = segments[segments.length - 1];\n  if (!lastSegment) {\n    throw new Error(\"Invalid request URL\");\n  }\n  const cleanLastSegment = lastSegment.replace(/\\.[^/.]+$/, \"\");\n  const commonPathNames = [\"files\", \"metadata\", \"upload\", \"download\", \"http-rest\", \"http-rest-chunked\"];\n  if (commonPathNames.includes(cleanLastSegment.toLowerCase())) {\n    throw new Error(\"Invalid request URL\");\n  }\n  if (cleanLastSegment.length < 8) {\n    throw new Error(\"Invalid request URL\");\n  }\n  if (segments.length > 1) {\n    return cleanLastSegment;\n  }\n  throw new Error(\"Invalid request URL\");\n};\nconst getRequestStream = (request) => {\n  if (\"body\" in request && request.body && typeof request.body.getReader === \"function\") {\n    return Readable.fromWeb(request.body);\n  }\n  if (\"body\" in request && request.body && request.body instanceof Uint8Array) {\n    return Readable.from(Buffer.from(request.body));\n  }\n  if (request instanceof Readable) {\n    return request;\n  }\n  return Readable.from(new Uint8Array(0));\n};\n\nconst pick = (object, whitelist) => {\n  const result = {};\n  whitelist.forEach((key) => {\n    result[key] = object[key];\n  });\n  return result;\n};\n\nclass BaseHandlerCore extends EventEmitter {\n  /**\n   * Response body type for the handler.\n   */\n  responseType = \"json\";\n  /**\n   * Storage instance for file operations.\n   */\n  storage;\n  /**\n   * Optional media transformer for image/video processing.\n   */\n  mediaTransformer;\n  /**\n   * Whether to disable termination for finished uploads.\n   */\n  disableTerminationForFinishedUploads;\n  /**\n   * Logger instance for debugging and error reporting.\n   */\n  logger;\n  /**\n   * Gets the logger instance.\n   * @returns Logger instance or undefined.\n   */\n  get loggerInstance() {\n    return this.logger;\n  }\n  /**\n   * Internal error responses configuration.\n   */\n  internalErrorResponses = {};\n  /**\n   * Gets the error responses configuration.\n   * @returns Error responses configuration.\n   */\n  get errorResponses() {\n    return this.internalErrorResponses;\n  }\n  constructor({ disableTerminationForFinishedUploads, mediaTransformer, storage }) {\n    super();\n    this.storage = storage;\n    this.mediaTransformer = mediaTransformer;\n    this.disableTerminationForFinishedUploads = disableTerminationForFinishedUploads;\n    this.logger = this.storage?.logger;\n    this.assembleErrors();\n  }\n  /**\n   * Sets custom error responses.\n   * @param value Partial error responses to override defaults.\n   */\n  set errorResponses(value) {\n    this.assembleErrors(value);\n  }\n  /**\n   * Assemble error responses by merging defaults with custom overrides.\n   * @param customErrors Custom error responses to override defaults\n   */\n  assembleErrors = (customErrors = {}) => {\n    this.internalErrorResponses = {\n      ...ErrorMap,\n      ...this.internalErrorResponses,\n      ...this.storage.errorResponses,\n      ...customErrors\n    };\n  };\n  /**\n   * Parses HTTP Range header and returns start/end byte positions for partial content requests.\n   * @param rangeHeader HTTP Range header value (e.g., \"bytes=0-1023\").\n   * @param fileSize Total size of the file in bytes.\n   * @returns Object with start and end positions, or undefined if range is invalid.\n   */\n  // eslint-disable-next-line class-methods-use-this\n  parseRangeHeader(rangeHeader, fileSize) {\n    if (!rangeHeader || !rangeHeader.startsWith(\"bytes=\")) {\n      return void 0;\n    }\n    const ranges = rangeHeader.slice(6).split(\",\");\n    if (ranges.length !== 1) {\n      return void 0;\n    }\n    const range = ranges[0]?.trim();\n    if (!range) {\n      return void 0;\n    }\n    const parts = range.split(\"-\");\n    if (parts.length !== 2) {\n      return void 0;\n    }\n    const [startString, endString] = parts;\n    let start;\n    let end;\n    if (startString && endString) {\n      start = Number.parseInt(startString, 10);\n      end = Number.parseInt(endString, 10);\n    } else if (startString && !endString) {\n      start = Number.parseInt(startString, 10);\n      end = fileSize - 1;\n    } else if (!startString && endString) {\n      const suffixLength = Number.parseInt(endString, 10);\n      start = Math.max(0, fileSize - suffixLength);\n      end = fileSize - 1;\n    } else {\n      return void 0;\n    }\n    if (Number.isNaN(start) || Number.isNaN(end) || start >= fileSize || end >= fileSize || start > end) {\n      return void 0;\n    }\n    return { end, start };\n  }\n  /**\n   * Build file URL from request and file data.\n   * Platform-agnostic version that accepts URL string.\n   * @param requestUrl Request URL string\n   * @param file File object containing ID and content type\n   * @returns Constructed file URL with extension based on content type\n   */\n  buildFileUrlFromString(requestUrl, file) {\n    const url = new URL(requestUrl, \"http://localhost\");\n    const { pathname } = url;\n    const query = Object.fromEntries(url.searchParams.entries());\n    const relative = format({ pathname: `${pathname}/${file.id}`, query });\n    return `${this.storage.config.useRelativeLocation ? relative : getBaseUrl({ }) + relative}.${mime.getExtension(file.contentType)}`;\n  }\n  /**\n   * Negotiates content type based on Accept header and supported formats.\n   * Platform-agnostic version that accepts header string.\n   * @param acceptHeader Accept header value\n   * @param supportedTypes Array of supported MIME types to match against\n   * @returns Best matching content type or undefined if no match found\n   */\n  // eslint-disable-next-line class-methods-use-this\n  negotiateContentType(acceptHeader, supportedTypes) {\n    if (!acceptHeader) {\n      return void 0;\n    }\n    return HeaderUtilities.getPreferredMediaType(acceptHeader, supportedTypes);\n  }\n  /**\n   * Check for undefined ID or path errors and throw appropriate HTTP errors.\n   * @param error The error to check\n   */\n  checkForUndefinedIdOrPath(error) {\n    if (error instanceof Error && [\"Id is undefined\", \"Invalid request URL\", \"Path is undefined\"].includes(error.message)) {\n      throw error;\n    }\n  }\n}\n\nexport { BaseHandlerCore as B, getHeader as a, getRequestStream as b, getBaseUrl as c, getRealPath as d, getIdFromRequest as g, pick as p, readBody as r, setHeaders as s, uuidRegex as u };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3503, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/base-handler-fetch-DkAUTzhr.js"],"sourcesContent":["import { H as HeaderUtilities, h as httpErrorsExports } from './headers-C9CQX79R.js';\nimport { ERRORS, isUploadError } from './ERRORS-DKaR93nv.js';\nimport { B as BaseHandlerCore, p as pick } from './base-handler-core-AWhpn4ts.js';\nimport { i as isValidationError } from './validator-InvzeyVl.js';\n\nclass BaseHandlerFetch extends BaseHandlerCore {\n  /**\n   * Limiting enabled HTTP method handler.\n   */\n  static methods = [\"delete\", \"get\", \"head\", \"options\", \"patch\", \"post\", \"put\"];\n  /**\n   * Map of registered HTTP method handlers.\n   */\n  registeredHandlers = /* @__PURE__ */ new Map();\n  constructor(options) {\n    super(options);\n    this.compose();\n  }\n  /**\n   * Gets the registered handlers map.\n   * @returns Map of registered handlers.\n   */\n  get handlers() {\n    return this.registeredHandlers;\n  }\n  /**\n   * Handles Web API Fetch requests (for Hono, Cloudflare Workers, etc.).\n   * @param request Web API Request object.\n   * @returns Promise resolving to Web API Response.\n   */\n  async fetch(request) {\n    this.logger?.debug(\"[fetch request]: %s %s\", request.method, request.url);\n    const handler = this.registeredHandlers.get(request.method || \"GET\");\n    if (!handler) {\n      return this.createErrorResponse({ UploadErrorCode: ERRORS.METHOD_NOT_ALLOWED });\n    }\n    if (!this.storage.isReady) {\n      return this.createErrorResponse({ UploadErrorCode: ERRORS.STORAGE_ERROR });\n    }\n    try {\n      const file = await handler.call(this, request);\n      return this.handleFetchResponse(request, file);\n    } catch (error) {\n      const errorObject = error instanceof Error ? error : new Error(String(error));\n      const uError = pick(errorObject, [\"name\", ...Object.getOwnPropertyNames(errorObject)]);\n      const errorEvent = {\n        ...uError,\n        request: {\n          headers: Object.fromEntries(request.headers.entries()),\n          method: request.method,\n          url: request.url\n        }\n      };\n      if (this.listenerCount(\"error\") > 0) {\n        this.emit(\"error\", errorEvent);\n      }\n      this.logger?.error(\"[fetch error]: %O\", errorEvent);\n      return this.createErrorResponse(errorObject);\n    }\n  }\n  /**\n   * Handle the response from handlers for fetch requests and convert to Web API Response.\n   * @param request Web API Request object\n   * @param file Response file or list from handler\n   * @returns Promise resolving to Web API Response object\n   */\n  async handleFetchResponse(request, file) {\n    if (request.method === \"HEAD\" || request.method === \"OPTIONS\") {\n      const { headers: headers2, statusCode: statusCode2 } = file;\n      return new Response(void 0, {\n        headers: this.convertHeaders({\n          ...headers2,\n          \"Access-Control-Expose-Headers\": \"location,upload-expires,upload-offset,upload-length,upload-metadata,upload-defer-length,tus-resumable,tus-extension,tus-max-size,tus-version,tus-checksum-algorithm,cache-control\"\n        }),\n        status: statusCode2\n      });\n    }\n    if (request.method === \"GET\") {\n      const { headers: headers2, statusCode: statusCode2 } = file;\n      let body = \"\";\n      if (file.content !== void 0) {\n        body = new Uint8Array(file.content);\n      } else if (typeof file === \"object\" && \"data\" in file) {\n        body = JSON.stringify(file.data);\n      }\n      return new Response(body, {\n        headers: this.convertHeaders({\n          ...headers2,\n          \"Access-Control-Expose-Headers\": \"location,upload-expires,upload-offset,upload-length,upload-metadata,upload-defer-length,tus-resumable,tus-extension,tus-max-size,tus-version,tus-checksum-algorithm,cache-control\"\n        }),\n        status: statusCode2\n      });\n    }\n    const { headers, statusCode, ...basicFile } = file;\n    if (basicFile.status !== void 0 && this.listenerCount(basicFile.status) > 0) {\n      this.emit(basicFile.status, {\n        ...basicFile,\n        request: {\n          headers: Object.fromEntries(request.headers.entries()),\n          method: request.method,\n          url: request.url\n        }\n      });\n    }\n    if (basicFile.status === \"completed\") {\n      const responseFile = file;\n      if (responseFile.headers === void 0) {\n        responseFile.headers = {};\n      }\n      if (responseFile.statusCode === void 0) {\n        responseFile.statusCode = 200;\n      }\n      try {\n        await this.storage.onComplete(basicFile, responseFile);\n      } catch (error) {\n        this.logger?.error(\"[onComplete error]: %O\", error);\n        throw error;\n      }\n      const { headers: responseFileHeaders2, statusCode: responseFileStatusCode, ...fileData } = responseFile;\n      const cleanFileData = { ...fileData };\n      if (\"content\" in cleanFileData) {\n        delete cleanFileData.content;\n      }\n      if (\"stream\" in cleanFileData) {\n        delete cleanFileData.stream;\n      }\n      return this.createResponse({\n        body: cleanFileData,\n        headers: responseFileHeaders2 || headers,\n        statusCode: responseFileStatusCode || statusCode || 200\n      });\n    }\n    const allHeaders = {\n      ...headers,\n      ...file.headers\n    };\n    const convertedHeaders = this.convertHeaders({\n      ...allHeaders,\n      \"Access-Control-Expose-Headers\": \"location,upload-expires,upload-offset,upload-length,upload-metadata,upload-defer-length,tus-resumable,tus-extension,tus-max-size,tus-version,tus-checksum-algorithm,cache-control\",\n      ...basicFile.hash === void 0 ? {} : { [`X-Range-${basicFile.hash?.algorithm.toUpperCase()}`]: basicFile.hash?.value }\n    });\n    const responseFileHeaders = file.headers || {};\n    if (responseFileHeaders.Location && !convertedHeaders.location && !convertedHeaders.Location) {\n      convertedHeaders.location = String(responseFileHeaders.Location);\n    } else if (responseFileHeaders.location && !convertedHeaders.location && !convertedHeaders.Location) {\n      convertedHeaders.location = String(responseFileHeaders.location);\n    } else if (headers.Location && !convertedHeaders.location && !convertedHeaders.Location) {\n      convertedHeaders.location = String(headers.Location);\n    } else if (headers.location && !convertedHeaders.location && !convertedHeaders.Location) {\n      convertedHeaders.location = String(headers.location);\n    }\n    let responseBody;\n    if (statusCode >= 200 && statusCode < 300) {\n      responseBody = Object.keys(basicFile).length > 0 ? { ...basicFile } : {};\n      if (\"content\" in responseBody) {\n        delete responseBody.content;\n      }\n      if (\"stream\" in responseBody) {\n        delete responseBody.stream;\n      }\n      if (Object.keys(responseBody).length === 0) {\n        responseBody = {};\n      }\n    }\n    return this.createResponse({\n      body: responseBody,\n      headers: convertedHeaders,\n      statusCode: statusCode || 200\n    });\n  }\n  /**\n   * Convert headers to Web API Headers format by flattening arrays and converting to strings.\n   * @param headers Headers object with potentially array values\n   * @returns Headers object with all values as strings\n   */\n  // eslint-disable-next-line class-methods-use-this\n  convertHeaders(headers) {\n    const result = {};\n    for (const [key, value] of Object.entries(headers)) {\n      result[key] = Array.isArray(value) ? value.join(\", \") : String(value);\n    }\n    return result;\n  }\n  /**\n   * Create Web API Response from UploadResponse object.\n   * @param uploadResponse Upload response containing body, headers, and status code\n   * @returns Web API Response object\n   */\n  createResponse(uploadResponse) {\n    const { body, headers = {}, statusCode } = uploadResponse;\n    let responseBody;\n    if (statusCode === 204) {\n      responseBody = null;\n    } else if (typeof body === \"string\") {\n      responseBody = body;\n    } else if (body instanceof Buffer) {\n      responseBody = body;\n    } else if (body && typeof body === \"object\") {\n      responseBody = JSON.stringify(body);\n      if (!headers[\"Content-Type\"]) {\n        headers[\"Content-Type\"] = HeaderUtilities.createContentType({\n          charset: \"utf8\",\n          mediaType: \"application/json\"\n        });\n      }\n    } else if (body === void 0 && statusCode >= 200 && statusCode < 300) {\n      responseBody = \"{}\";\n      if (!headers[\"Content-Type\"]) {\n        headers[\"Content-Type\"] = HeaderUtilities.createContentType({\n          charset: \"utf8\",\n          mediaType: \"application/json\"\n        });\n      }\n    }\n    return new Response(responseBody, {\n      headers: this.convertHeaders(headers),\n      status: statusCode\n    });\n  }\n  /**\n   * Create error Response from Error object with appropriate status code and message.\n   * @param error Error object to convert to HTTP error response\n   * @returns Web API Response object with error details\n   */\n  async createErrorResponse(error) {\n    let httpError;\n    if (isUploadError(error)) {\n      httpError = this.internalErrorResponses[error.UploadErrorCode];\n    } else if (!isValidationError(error) && !httpErrorsExports.isHttpError(error)) {\n      httpError = this.storage.normalizeError(error);\n    } else {\n      httpError = {\n        ...error,\n        code: error.code || error.name,\n        headers: error.headers || {},\n        message: error.message,\n        name: error.name,\n        statusCode: error.statusCode || 500\n      };\n    }\n    await this.storage.onError(httpError);\n    let errorResponse;\n    if (httpError.body) {\n      if (typeof httpError.body === \"object\" && httpError.body !== null) {\n        errorResponse = { body: httpError.body, headers: httpError.headers, statusCode: httpError.statusCode };\n      } else {\n        errorResponse = {\n          body: {\n            error: {\n              code: httpError.code || httpError.name || \"Error\",\n              message: httpError.body || httpError.message || \"Unknown error\",\n              name: httpError.name || \"Error\"\n            }\n          },\n          headers: httpError.headers,\n          statusCode: httpError.statusCode || 500\n        };\n      }\n    } else {\n      errorResponse = {\n        body: {\n          error: {\n            code: httpError.code || httpError.name || \"Error\",\n            message: httpError.message || \"Unknown error\",\n            name: httpError.name || \"Error\"\n          }\n        },\n        headers: httpError.headers,\n        statusCode: httpError.statusCode || 500\n      };\n    }\n    return this.createResponse(errorResponse);\n  }\n  /**\n   * Build file URL from request and file data.\n   * @param request Web API Request object\n   * @param file File object containing ID and content type\n   * @returns Constructed file URL with extension based on content type\n   */\n  buildFileUrl(request, file) {\n    return this.buildFileUrlFromString(request.url, file);\n  }\n  /**\n   * Negotiates content type based on Accept header and supported formats.\n   * @param request Web API Request object containing Accept header.\n   * @param supportedTypes Array of supported MIME types to match against.\n   * @returns Best matching content type or undefined if no match found.\n   */\n  negotiateContentType(request, supportedTypes) {\n    return super.negotiateContentType(request.headers.get(\"accept\") || void 0, supportedTypes);\n  }\n}\n\nexport { BaseHandlerFetch as B };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3822, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/multipart-base-Bw0JgeCS.js"],"sourcesContent":["import { c as createHttpError } from './headers-C9CQX79R.js';\n\nclass MultipartBase {\n  /**\n   * Storage instance for file operations.\n   */\n  get storage() {\n    throw new Error(\"storage must be implemented\");\n  }\n  /**\n   * Build file URL from request URL and file data.\n   * @param _requestUrl Request URL string\n   * @param _file File object containing ID and content type\n   * @returns Constructed file URL with extension based on content type\n   */\n  buildFileUrl(_requestUrl, _file) {\n    throw new Error(\"buildFileUrl must be implemented\");\n  }\n  /**\n   * Handle multipart POST (upload file).\n   * @param filePart File part from multipart parser\n   * @param filePart.bytes File bytes data\n   * @param filePart.filename Original filename\n   * @param filePart.mediaType Content type\n   * @param filePart.size File size in bytes\n   * @param metadataParts All parts from multipart parser (for extracting metadata)\n   * @param requestUrl Request URL for Location header\n   * @returns Promise resolving to ResponseFile with upload result\n   */\n  async handlePost(filePart, metadataParts, requestUrl) {\n    const config = {\n      contentType: filePart.mediaType || \"application/octet-stream\",\n      metadata: {},\n      originalName: filePart.filename,\n      size: filePart.size\n    };\n    for (const part of metadataParts) {\n      if (!part.isFile && part.name) {\n        let data = {};\n        if (part.name === \"metadata\" && part.text) {\n          try {\n            data = JSON.parse(part.text);\n          } catch {\n          }\n        } else if (part.name) {\n          data = { [part.name]: part.text };\n        }\n        Object.assign(config.metadata, data);\n      }\n    }\n    const file = await this.storage.create(config);\n    const stream = this.createStreamFromBytes(filePart.bytes);\n    await this.storage.write({\n      body: stream,\n      contentLength: filePart.size,\n      id: file.id,\n      start: 0\n    });\n    const completedFile = await this.storage.write({\n      body: this.createEmptyStream(),\n      contentLength: 0,\n      id: file.id,\n      start: filePart.size\n    });\n    let finalFile = completedFile;\n    if (Object.keys(config.metadata).length > 0) {\n      const mergedMetadata = {\n        ...completedFile.metadata,\n        ...config.metadata\n      };\n      const updatedFile = await this.storage.update({ id: completedFile.id }, { metadata: mergedMetadata });\n      finalFile = { ...updatedFile, status: completedFile.status };\n    }\n    const locationUrl = this.buildFileUrl(requestUrl, finalFile);\n    return {\n      ...finalFile,\n      headers: {\n        Location: locationUrl,\n        ...finalFile.expiredAt === void 0 ? {} : { \"X-Upload-Expires\": finalFile.expiredAt.toString() },\n        ...finalFile.ETag === void 0 ? {} : { ETag: finalFile.ETag }\n      },\n      statusCode: 200\n    };\n  }\n  /**\n   * Handle DELETE (delete file).\n   * @param id File ID from URL\n   * @returns Promise resolving to ResponseFile with deletion result\n   */\n  async handleDelete(id) {\n    const file = await this.storage.delete({ id });\n    if (file.status === void 0) {\n      throw createHttpError(404, \"File not found\");\n    }\n    return { ...file, headers: {}, statusCode: 204 };\n  }\n}\n\nexport { MultipartBase as M };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;IACJ;;GAEC,GACD,IAAI,UAAU;QACZ,MAAM,IAAI,MAAM;IAClB;IACA;;;;;GAKC,GACD,aAAa,WAAW,EAAE,KAAK,EAAE;QAC/B,MAAM,IAAI,MAAM;IAClB;IACA;;;;;;;;;;GAUC,GACD,MAAM,WAAW,QAAQ,EAAE,aAAa,EAAE,UAAU,EAAE;QACpD,MAAM,SAAS;YACb,aAAa,SAAS,SAAS,IAAI;YACnC,UAAU,CAAC;YACX,cAAc,SAAS,QAAQ;YAC/B,MAAM,SAAS,IAAI;QACrB;QACA,KAAK,MAAM,QAAQ,cAAe;YAChC,IAAI,CAAC,KAAK,MAAM,IAAI,KAAK,IAAI,EAAE;gBAC7B,IAAI,OAAO,CAAC;gBACZ,IAAI,KAAK,IAAI,KAAK,cAAc,KAAK,IAAI,EAAE;oBACzC,IAAI;wBACF,OAAO,KAAK,KAAK,CAAC,KAAK,IAAI;oBAC7B,EAAE,OAAM,CACR;gBACF,OAAO,IAAI,KAAK,IAAI,EAAE;oBACpB,OAAO;wBAAE,CAAC,KAAK,IAAI,CAAC,EAAE,KAAK,IAAI;oBAAC;gBAClC;gBACA,OAAO,MAAM,CAAC,OAAO,QAAQ,EAAE;YACjC;QACF;QACA,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;QACvC,MAAM,SAAS,IAAI,CAAC,qBAAqB,CAAC,SAAS,KAAK;QACxD,MAAM,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;YACvB,MAAM;YACN,eAAe,SAAS,IAAI;YAC5B,IAAI,KAAK,EAAE;YACX,OAAO;QACT;QACA,MAAM,gBAAgB,MAAM,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;YAC7C,MAAM,IAAI,CAAC,iBAAiB;YAC5B,eAAe;YACf,IAAI,KAAK,EAAE;YACX,OAAO,SAAS,IAAI;QACtB;QACA,IAAI,YAAY;QAChB,IAAI,OAAO,IAAI,CAAC,OAAO,QAAQ,EAAE,MAAM,GAAG,GAAG;YAC3C,MAAM,iBAAiB;gBACrB,GAAG,cAAc,QAAQ;gBACzB,GAAG,OAAO,QAAQ;YACpB;YACA,MAAM,cAAc,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;gBAAE,IAAI,cAAc,EAAE;YAAC,GAAG;gBAAE,UAAU;YAAe;YACnG,YAAY;gBAAE,GAAG,WAAW;gBAAE,QAAQ,cAAc,MAAM;YAAC;QAC7D;QACA,MAAM,cAAc,IAAI,CAAC,YAAY,CAAC,YAAY;QAClD,OAAO;YACL,GAAG,SAAS;YACZ,SAAS;gBACP,UAAU;gBACV,GAAG,UAAU,SAAS,KAAK,KAAK,IAAI,CAAC,IAAI;oBAAE,oBAAoB,UAAU,SAAS,CAAC,QAAQ;gBAAG,CAAC;gBAC/F,GAAG,UAAU,IAAI,KAAK,KAAK,IAAI,CAAC,IAAI;oBAAE,MAAM,UAAU,IAAI;gBAAC,CAAC;YAC9D;YACA,YAAY;QACd;IACF;IACA;;;;GAIC,GACD,MAAM,aAAa,EAAE,EAAE;QACrB,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;YAAE;QAAG;QAC5C,IAAI,KAAK,MAAM,KAAK,KAAK,GAAG;YAC1B,MAAM,IAAA,0KAAe,EAAC,KAAK;QAC7B;QACA,OAAO;YAAE,GAAG,IAAI;YAAE,SAAS,CAAC;YAAG,YAAY;QAAI;IACjD;AACF"}},
    {"offset": {"line": 3942, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/Multipart-D3eg40wT.js"],"sourcesContent":["import { Readable } from 'node:stream';\nimport { parseMultipartRequest, MaxFileSizeExceededError, MultipartParseError } from '@remix-run/multipart-parser';\nimport { c as createHttpError } from './headers-C9CQX79R.js';\nimport { V as ValidationError } from './validator-InvzeyVl.js';\nimport { B as BaseHandlerFetch } from './base-handler-fetch-DkAUTzhr.js';\nimport { M as MultipartBase } from './multipart-base-Bw0JgeCS.js';\n\nconst RE_MIME = /^multipart\\/.+|application\\/x-www-form-urlencoded$/i;\nconst getIdFromRequestUrl = (url) => {\n  try {\n    const urlObject = new URL(url);\n    const pathParts = urlObject.pathname.split(\"/\").filter(Boolean);\n    return pathParts[pathParts.length - 1] || void 0;\n  } catch {\n    return void 0;\n  }\n};\nclass Multipart extends BaseHandlerFetch {\n  /**\n   * Limiting enabled http method handler\n   */\n  static methods = [\"delete\", \"download\", \"get\", \"options\", \"post\"];\n  multipartBase;\n  /**\n   * Maximum file size allowed for multipart uploads\n   */\n  maxFileSize;\n  /**\n   * Maximum header size allowed for multipart parser\n   */\n  maxHeaderSize;\n  constructor(options) {\n    super(options);\n    this.maxFileSize = options.maxFileSize ?? Math.min(this.storage.maxUploadSize, 1024 * 1024 * 1024);\n    this.maxHeaderSize = options.maxHeaderSize ?? 64 * 1024;\n    const multipartInstance = this;\n    this.multipartBase = new class extends MultipartBase {\n      get storage() {\n        return multipartInstance.storage;\n      }\n      get maxFileSize() {\n        return multipartInstance.maxFileSize;\n      }\n      get maxHeaderSize() {\n        return multipartInstance.maxHeaderSize;\n      }\n      buildFileUrl(requestUrl, file) {\n        return multipartInstance.buildFileUrl({ url: requestUrl }, file);\n      }\n      createStreamFromBytes(bytes) {\n        if (bytes instanceof Uint8Array) {\n          return Readable.from(Buffer.from(bytes));\n        }\n        if (bytes instanceof ArrayBuffer) {\n          return Readable.from(Buffer.from(bytes));\n        }\n        return Readable.from(new Uint8Array(0));\n      }\n      createEmptyStream() {\n        return Readable.from(new Uint8Array(0));\n      }\n    }();\n  }\n  /**\n   * Compose and register HTTP method handlers.\n   */\n  compose() {\n    this.registeredHandlers.set(\"POST\", this.post.bind(this));\n    this.registeredHandlers.set(\"DELETE\", this.delete.bind(this));\n    this.registeredHandlers.set(\"GET\", this.get.bind(this));\n    this.registeredHandlers.set(\"OPTIONS\", this.options.bind(this));\n    this.logger?.debug(\"Registered handler: %s\", [...this.registeredHandlers.keys()].join(\", \"));\n  }\n  /**\n   * Handles multipart/form-data POST requests for file uploads.\n   * @param request Web API Request containing multipart data.\n   * @returns Promise resolving to ResponseFile with upload result.\n   */\n  async post(request) {\n    const contentType = request.headers.get(\"content-type\") || \"\";\n    if (!RE_MIME.test(contentType.split(\";\")[0])) {\n      throw createHttpError(400, \"Invalid content-type\");\n    }\n    try {\n      const parts = [];\n      for await (const part of parseMultipartRequest(request, {\n        maxFileSize: this.maxFileSize,\n        maxHeaderSize: this.maxHeaderSize\n      })) {\n        parts.push(part);\n      }\n      const filePart = parts.find((part) => part.isFile);\n      if (!filePart) {\n        throw createHttpError(400, \"No file found in multipart request\");\n      }\n      const requestUrl = request.url;\n      return this.multipartBase.handlePost(filePart, parts, requestUrl);\n    } catch (error) {\n      if (error instanceof MaxFileSizeExceededError) {\n        throw createHttpError(413, \"File size limit exceeded\");\n      }\n      if (error instanceof MultipartParseError) {\n        throw createHttpError(400, \"Invalid multipart request\");\n      }\n      if (error instanceof ValidationError && error.statusCode) {\n        throw createHttpError(error.statusCode, error.message || error.body || \"Validation failed\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Delete an uploaded file.\n   * @param request Web API Request with file ID\n   * @returns Promise resolving to ResponseFile with deletion result\n   */\n  async delete(request) {\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    try {\n      return this.multipartBase.handleDelete(id);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.code === \"ENOENT\") {\n        throw createHttpError(404, \"File not found\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Handle OPTIONS requests with CORS headers.\n   * @param _request Web API Request (unused)\n   * @returns Promise resolving to ResponseFile with CORS headers\n   */\n  async options(_request) {\n    const child = this.constructor;\n    return {\n      headers: {\n        \"Access-Control-Allow-Methods\": (child.methods || Multipart.methods).map((method) => method.toUpperCase()).join(\", \")\n      },\n      statusCode: 204\n    };\n  }\n  /**\n   * Retrieves a file or list of files based on the request path.\n   * Delegates to BaseHandlerFetch.fetch() method.\n   * @param request Web API Request\n   * @returns Promise resolving to Web API Response\n   */\n  async get(request) {\n    throw createHttpError(500, \"GET requests should be handled via fetch() method\");\n  }\n}\n\nexport { Multipart as default };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4114, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/response-builder-BtnRiBUI.js"],"sourcesContent":["import 'mime';\n\nconst buildResponseFile = (file, headers = {}, statusCode = 200) => ({\n  ...file,\n  headers,\n  statusCode\n});\nconst buildFileHeaders = (file, locationUrl, additionalHeaders = {}) => {\n  return {\n    Location: locationUrl,\n    ...file.expiredAt === void 0 ? {} : { \"X-Upload-Expires\": file.expiredAt.toString() },\n    ...file.ETag === void 0 ? {} : { ETag: file.ETag },\n    ...additionalHeaders\n  };\n};\nconst buildChunkedUploadHeaders = (file, isComplete) => {\n  const metadata = file.metadata || {};\n  const headers = {\n    \"x-chunked-upload\": \"true\",\n    \"x-upload-complete\": isComplete ? \"true\" : \"false\",\n    \"x-upload-offset\": String(file.bytesWritten || 0)\n  };\n  if (Array.isArray(metadata._chunks) && metadata._chunks.length > 0) {\n    headers[\"x-received-chunks\"] = JSON.stringify(metadata._chunks);\n  }\n  return headers;\n};\nconst buildFileMetadataHeaders = (file) => {\n  return {\n    \"Content-Length\": String(file.size || 0),\n    \"Content-Type\": file.contentType,\n    ...file.expiredAt === void 0 ? {} : { \"X-Upload-Expires\": file.expiredAt.toString() },\n    ...file.modifiedAt === void 0 ? {} : { \"Last-Modified\": file.modifiedAt.toString() },\n    ...file.ETag === void 0 ? {} : { ETag: file.ETag }\n  };\n};\nconst convertHeadersToString = (headers) => {\n  const result = {};\n  for (const [key, value] of Object.entries(headers)) {\n    result[key] = Array.isArray(value) ? value.join(\", \") : String(value);\n  }\n  return result;\n};\n\nexport { buildFileHeaders as a, buildResponseFile as b, buildChunkedUploadHeaders as c, buildFileMetadataHeaders as d, convertHeadersToString as e };\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEA,MAAM,oBAAoB,CAAC,MAAM,UAAU,CAAC,CAAC,EAAE,aAAa,GAAG,GAAK,CAAC;QACnE,GAAG,IAAI;QACP;QACA;IACF,CAAC;AACD,MAAM,mBAAmB,CAAC,MAAM,aAAa,oBAAoB,CAAC,CAAC;IACjE,OAAO;QACL,UAAU;QACV,GAAG,KAAK,SAAS,KAAK,KAAK,IAAI,CAAC,IAAI;YAAE,oBAAoB,KAAK,SAAS,CAAC,QAAQ;QAAG,CAAC;QACrF,GAAG,KAAK,IAAI,KAAK,KAAK,IAAI,CAAC,IAAI;YAAE,MAAM,KAAK,IAAI;QAAC,CAAC;QAClD,GAAG,iBAAiB;IACtB;AACF;AACA,MAAM,4BAA4B,CAAC,MAAM;IACvC,MAAM,WAAW,KAAK,QAAQ,IAAI,CAAC;IACnC,MAAM,UAAU;QACd,oBAAoB;QACpB,qBAAqB,aAAa,SAAS;QAC3C,mBAAmB,OAAO,KAAK,YAAY,IAAI;IACjD;IACA,IAAI,MAAM,OAAO,CAAC,SAAS,OAAO,KAAK,SAAS,OAAO,CAAC,MAAM,GAAG,GAAG;QAClE,OAAO,CAAC,oBAAoB,GAAG,KAAK,SAAS,CAAC,SAAS,OAAO;IAChE;IACA,OAAO;AACT;AACA,MAAM,2BAA2B,CAAC;IAChC,OAAO;QACL,kBAAkB,OAAO,KAAK,IAAI,IAAI;QACtC,gBAAgB,KAAK,WAAW;QAChC,GAAG,KAAK,SAAS,KAAK,KAAK,IAAI,CAAC,IAAI;YAAE,oBAAoB,KAAK,SAAS,CAAC,QAAQ;QAAG,CAAC;QACrF,GAAG,KAAK,UAAU,KAAK,KAAK,IAAI,CAAC,IAAI;YAAE,iBAAiB,KAAK,UAAU,CAAC,QAAQ;QAAG,CAAC;QACpF,GAAG,KAAK,IAAI,KAAK,KAAK,IAAI,CAAC,IAAI;YAAE,MAAM,KAAK,IAAI;QAAC,CAAC;IACpD;AACF;AACA,MAAM,yBAAyB,CAAC;IAC9B,MAAM,SAAS,CAAC;IAChB,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,SAAU;QAClD,MAAM,CAAC,IAAI,GAAG,MAAM,OAAO,CAAC,SAAS,MAAM,IAAI,CAAC,QAAQ,OAAO;IACjE;IACA,OAAO;AACT"}},
    {"offset": {"line": 4184, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/rest-base-CdRaPXKr.js"],"sourcesContent":["import { c as createHttpError } from './headers-C9CQX79R.js';\nimport { ERRORS } from './ERRORS-DKaR93nv.js';\nimport { b as buildResponseFile, a as buildFileHeaders, c as buildChunkedUploadHeaders, d as buildFileMetadataHeaders } from './response-builder-BtnRiBUI.js';\n\nconst isUploadComplete = (chunks, totalSize) => {\n  if (chunks.length === 0) {\n    return false;\n  }\n  const sorted = [...chunks].toSorted((a, b) => a.offset - b.offset);\n  const firstChunk = sorted[0];\n  if (!firstChunk || firstChunk.offset !== 0) {\n    return false;\n  }\n  let currentEnd = firstChunk.length;\n  for (let i = 1; i < sorted.length; i += 1) {\n    const chunk = sorted[i];\n    if (!chunk) {\n      continue;\n    }\n    if (chunk.offset > currentEnd) {\n      return false;\n    }\n    currentEnd = Math.max(currentEnd, chunk.offset + chunk.length);\n  }\n  return currentEnd >= totalSize;\n};\nconst validateChunk = (chunkOffset, chunkLength, totalSize, maxChunkSize) => {\n  if (Number.isNaN(chunkOffset) || chunkOffset < 0) {\n    throw new Error(\"Chunk offset must be a valid non-negative number\");\n  }\n  if (chunkLength <= 0) {\n    throw new Error(\"Chunk length must be greater than 0\");\n  }\n  if (chunkLength > maxChunkSize) {\n    throw new Error(`Chunk size exceeds maximum allowed size of ${maxChunkSize} bytes`);\n  }\n  if (chunkOffset + chunkLength > totalSize) {\n    throw new Error(`Chunk exceeds file size. Offset: ${chunkOffset}, Size: ${chunkLength}, Total: ${totalSize}`);\n  }\n};\nconst trackChunk = (chunks, chunkInfo) => {\n  const existingChunk = chunks.find((chunk) => chunk.offset === chunkInfo.offset && chunk.length === chunkInfo.length);\n  if (!existingChunk) {\n    return [...chunks, chunkInfo];\n  }\n  if (chunkInfo.checksum && existingChunk.checksum !== chunkInfo.checksum) {\n    return chunks.map((chunk) => chunk.offset === chunkInfo.offset ? { ...chunk, checksum: chunkInfo.checksum } : chunk);\n  }\n  return chunks;\n};\nconst isChunkedUpload = (file) => {\n  const metadata = file.metadata || {};\n  return metadata._chunkedUpload === true;\n};\nconst getTotalSize = (file) => {\n  const metadata = file.metadata || {};\n  const isChunkedUpload2 = metadata._chunkedUpload === true;\n  if (isChunkedUpload2 && typeof metadata._totalSize === \"number\") {\n    return metadata._totalSize;\n  }\n  return void 0;\n};\n\nclass RestBase {\n  /**\n   * Storage instance for file operations.\n   */\n  get storage() {\n    throw new Error(\"storage must be implemented\");\n  }\n  /**\n   * Build file URL from request URL and file data.\n   * @param requestUrl Request URL string\n   * @param file File object containing ID and content type\n   * @returns Constructed file URL with extension based on content type\n   */\n  buildFileUrl(requestUrl, file) {\n    throw new Error(\"buildFileUrl must be implemented\");\n  }\n  /**\n   * Handle batch file deletion.\n   * @param ids Array of file IDs to delete\n   * @returns Promise resolving to ResponseList with deletion results\n   */\n  async deleteBatch(ids) {\n    const result = await this.storage.deleteBatch(ids);\n    if (result.successfulCount === 0 && result.failedCount > 0) {\n      const failedIds = result.failed.map((errorItem) => errorItem.id).join(\", \");\n      throw createHttpError(404, `Failed to delete files: ${failedIds}`);\n    }\n    return {\n      data: result.successful,\n      headers: result.failedCount > 0 ? {\n        \"X-Delete-Errors\": JSON.stringify(result.failed),\n        \"X-Delete-Failed\": String(result.failedCount),\n        \"X-Delete-Successful\": String(result.successfulCount)\n      } : {\n        \"X-Delete-Successful\": String(result.successfulCount)\n      },\n      statusCode: result.successfulCount === ids.length ? 204 : 207\n      // 207 Multi-Status for partial success\n    };\n  }\n  /**\n   * Handle single file deletion.\n   * @param id File ID to delete\n   * @returns Promise resolving to ResponseFile with deletion result\n   */\n  async deleteSingle(id) {\n    const file = await this.storage.delete({ id });\n    if (file.status === void 0) {\n      throw createHttpError(404, \"File not found\");\n    }\n    return { ...file, headers: {}, statusCode: 204 };\n  }\n  /**\n   * Handle file creation (POST).\n   * @param config File initialization config\n   * @param isChunkedUpload Whether this is a chunked upload initialization\n   * @param requestUrl Request URL for Location header\n   * @param bodyStream Request body stream (for non-chunked uploads)\n   * @param contentLength Content length (for non-chunked uploads)\n   * @returns Promise resolving to ResponseFile with upload result\n   */\n  async handlePost(config, isChunkedUpload2, requestUrl, bodyStream, contentLength) {\n    if (isChunkedUpload2 && config.size > 0 && config.size > this.storage.maxUploadSize) {\n      throw createHttpError(413, `File size exceeds maximum allowed size of ${this.storage.maxUploadSize} bytes`);\n    }\n    const file = await this.storage.create(config);\n    if (isChunkedUpload2) {\n      const locationUrl2 = this.buildFileUrl(requestUrl, file);\n      return buildResponseFile(\n        file,\n        {\n          ...buildFileHeaders(file, locationUrl2),\n          \"X-Chunked-Upload\": \"true\",\n          \"X-Upload-ID\": file.id\n        },\n        201\n      );\n    }\n    const completedFile = await this.storage.write({\n      body: bodyStream,\n      contentLength,\n      id: file.id,\n      start: 0\n    });\n    const locationUrl = this.buildFileUrl(requestUrl, completedFile);\n    return buildResponseFile(completedFile, buildFileHeaders(completedFile, locationUrl), 201);\n  }\n  /**\n   * Handle file update or creation (PUT).\n   * @param id File ID from URL\n   * @param config File initialization config (for new files)\n   * @param requestUrl Request URL for Location header\n   * @param bodyStream Request body stream\n   * @param contentLength Content length\n   * @param metadata Optional metadata to merge (for updates)\n   * @returns Promise resolving to ResponseFile with upload result\n   */\n  async handlePut(id, config, requestUrl, bodyStream, contentLength, metadata) {\n    let file;\n    let isUpdate = false;\n    try {\n      await this.storage.getMeta(id);\n      isUpdate = true;\n      if (metadata) {\n        await this.storage.update({ id }, { metadata });\n      }\n      file = await this.storage.write({\n        body: bodyStream,\n        contentLength,\n        id,\n        start: 0\n      });\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === ERRORS.FILE_NOT_FOUND || errorWithCode.code === \"ENOENT\") {\n        try {\n          const newFile = await this.storage.create(config);\n          file = await this.storage.write({\n            body: bodyStream,\n            contentLength,\n            id: newFile.id,\n            start: 0\n          });\n        } catch (createError) {\n          throw createError;\n        }\n      } else {\n        throw error;\n      }\n    }\n    const locationUrl = this.buildFileUrl(requestUrl, file);\n    return buildResponseFile(file, buildFileHeaders(file, locationUrl), isUpdate ? 200 : 201);\n  }\n  /**\n   * Handle chunked upload chunk (PATCH).\n   * @param id File ID from URL\n   * @param chunkOffset Chunk offset in bytes\n   * @param contentLength Chunk content length\n   * @param chunkChecksum Optional chunk checksum\n   * @param requestUrl Request URL for Location header\n   * @param bodyStream Request body stream\n   * @returns Promise resolving to ResponseFile with upload progress\n   */\n  async handlePatch(id, chunkOffset, contentLength, chunkChecksum, requestUrl, bodyStream) {\n    let file = await this.storage.getMeta(id);\n    const metadata = file.metadata || {};\n    const isChunkedUploadFile = isChunkedUpload(file);\n    if (isChunkedUploadFile) {\n      const totalSize2 = getTotalSize(file);\n      if (totalSize2 && file.size !== totalSize2) {\n        file = { ...file, size: totalSize2 };\n      }\n    }\n    const totalSize = typeof metadata._totalSize === \"number\" ? metadata._totalSize : file.size || 0;\n    if (!isChunkedUploadFile) {\n      throw createHttpError(400, \"File is not a chunked upload. Use POST or PUT for full file uploads.\");\n    }\n    const MAX_CHUNK_SIZE = 100 * 1024 * 1024;\n    try {\n      validateChunk(chunkOffset, contentLength, totalSize, MAX_CHUNK_SIZE);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"exceeds maximum\")) {\n        throw createHttpError(413, error.message);\n      }\n      throw createHttpError(400, error instanceof Error ? error.message : String(error));\n    }\n    if (file.status === \"completed\") {\n      const locationUrl2 = this.buildFileUrl(requestUrl, file);\n      return buildResponseFile(\n        file,\n        {\n          ...buildFileHeaders(file, locationUrl2),\n          \"X-Upload-Complete\": \"true\"\n        },\n        200\n      );\n    }\n    const existingChunks = Array.isArray(metadata._chunks) ? metadata._chunks : [];\n    const chunkInfo = {\n      checksum: chunkChecksum,\n      length: contentLength,\n      offset: chunkOffset\n    };\n    const chunks = trackChunk(existingChunks, chunkInfo);\n    const updatedMetadata = {\n      ...metadata,\n      _chunks: chunks\n    };\n    await this.storage.update({ id }, { metadata: updatedMetadata });\n    const updatedFile = await this.storage.write({\n      body: bodyStream,\n      contentLength,\n      id,\n      start: chunkOffset\n    });\n    let isComplete = updatedFile.bytesWritten >= totalSize;\n    if (isChunkedUploadFile) {\n      const isChunksComplete = isUploadComplete(chunks, totalSize);\n      isComplete = isChunksComplete;\n      if (updatedFile.status === \"completed\" && !isComplete) {\n        await this.storage.update({ id }, { status: \"part\" });\n        updatedFile.status = \"part\";\n      }\n    }\n    const finalFile = isComplete && updatedFile.bytesWritten !== totalSize ? { ...updatedFile, bytesWritten: totalSize } : updatedFile;\n    const locationUrl = this.buildFileUrl(requestUrl, finalFile);\n    const headers = {\n      ...buildFileHeaders(finalFile, locationUrl),\n      ...buildChunkedUploadHeaders(finalFile, isComplete),\n      \"x-upload-offset\": String(finalFile.bytesWritten || 0)\n    };\n    return buildResponseFile(finalFile, headers, isComplete ? 200 : 202);\n  }\n  /**\n   * Handle file metadata retrieval (HEAD).\n   * @param id File ID from URL\n   * @returns Promise resolving to ResponseFile with metadata headers\n   */\n  async handleHead(id) {\n    let file = await this.storage.getMeta(id);\n    const isChunkedUploadFile = isChunkedUpload(file);\n    if (isChunkedUploadFile) {\n      const totalSize = getTotalSize(file);\n      if (totalSize && file.size !== totalSize) {\n        file = { ...file, size: totalSize };\n      }\n    }\n    const headers = {\n      ...buildFileMetadataHeaders(file)\n    };\n    if (isChunkedUploadFile) {\n      const metadata = file.metadata || {};\n      const totalSize = getTotalSize(file) || file.size || 0;\n      const chunks = Array.isArray(metadata._chunks) ? metadata._chunks : [];\n      const isComplete = isUploadComplete(chunks, totalSize);\n      Object.assign(headers, buildChunkedUploadHeaders(file, isComplete));\n    }\n    return buildResponseFile(file, headers, 200);\n  }\n  /**\n   * Handle OPTIONS request with REST API capabilities.\n   * @param methods Array of supported HTTP methods\n   * @param maxUploadSize Maximum upload size\n   * @returns ResponseFile with CORS headers\n   */\n  handleOptions(methods, maxUploadSize) {\n    const headers = {\n      \"Access-Control-Allow-Headers\": \"Authorization, Content-Type, Content-Length, Content-Disposition, X-File-Metadata, X-Chunked-Upload, X-Total-Size, X-Chunk-Offset, X-Chunk-Checksum\",\n      \"Access-Control-Allow-Methods\": methods.map((method) => method.toUpperCase()).join(\", \"),\n      \"Access-Control-Max-Age\": 86400,\n      \"X-Max-Upload-Size\": String(maxUploadSize)\n    };\n    return {\n      headers,\n      statusCode: 204\n    };\n  }\n}\n\nexport { RestBase as R };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4532, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/Rest-DxBjOMcM.js"],"sourcesContent":["import { c as createHttpError } from './headers-C9CQX79R.js';\nimport { ERRORS } from './ERRORS-DKaR93nv.js';\nimport { b as getRequestStream } from './base-handler-core-AWhpn4ts.js';\nimport { B as BaseHandlerFetch } from './base-handler-fetch-DkAUTzhr.js';\nimport { R as RestBase } from './rest-base-CdRaPXKr.js';\n\nclass RestFetch extends BaseHandlerFetch {\n  /**\n   * Limiting enabled http method handler\n   */\n  static methods = [\"delete\", \"download\", \"get\", \"head\", \"options\", \"patch\", \"post\", \"put\"];\n  restBase;\n  constructor(options) {\n    super(options);\n    const restInstance = this;\n    this.restBase = new class extends RestBase {\n      get storage() {\n        return restInstance.storage;\n      }\n      buildFileUrl(requestUrl, file) {\n        return restInstance.buildFileUrl({ url: requestUrl }, file);\n      }\n    }();\n  }\n  /**\n   * Compose and register HTTP method handlers.\n   */\n  compose() {\n    this.registeredHandlers.set(\"POST\", this.post.bind(this));\n    this.registeredHandlers.set(\"PUT\", this.put.bind(this));\n    this.registeredHandlers.set(\"PATCH\", this.patch.bind(this));\n    this.registeredHandlers.set(\"DELETE\", this.delete.bind(this));\n    this.registeredHandlers.set(\"HEAD\", this.head.bind(this));\n    this.registeredHandlers.set(\"GET\", this.get.bind(this));\n    this.registeredHandlers.set(\"OPTIONS\", this.options.bind(this));\n    this.logger?.debug(\"Registered handler: %s\", [...this.registeredHandlers.keys()].join(\", \"));\n  }\n  /**\n   * Creates a new file via POST request with raw binary data.\n   * Supports both full file uploads and chunked upload initialization.\n   * @param request Web API Request with file data.\n   * @returns Promise resolving to ResponseFile with upload result.\n   */\n  async post(request) {\n    const isChunkedUpload = request.headers.get(\"x-chunked-upload\") === \"true\";\n    const contentLengthHeader = request.headers.get(\"content-length\");\n    const contentLength = contentLengthHeader ? Number.parseInt(contentLengthHeader, 10) : 0;\n    if (!isChunkedUpload) {\n      if (!contentLengthHeader || Number.isNaN(contentLength) || contentLength === 0) {\n        throw createHttpError(400, \"Content-Length is required and must be greater than 0\");\n      }\n      if (request.body === null) {\n        throw createHttpError(400, \"Request body is required\");\n      }\n    }\n    if (contentLength > this.storage.maxUploadSize) {\n      throw createHttpError(413, `File size exceeds maximum allowed size of ${this.storage.maxUploadSize} bytes`);\n    }\n    const contentType = request.headers.get(\"content-type\") || \"application/octet-stream\";\n    const config = extractFileInitFromRequest(request, contentLength, contentType);\n    const requestUrl = request.url;\n    const bodyStream = request.body ? getRequestStream(request) : void 0;\n    return this.restBase.handlePost(config, isChunkedUpload, requestUrl, bodyStream, contentLength);\n  }\n  /**\n   * Create or update a file via PUT request.\n   * Requires file ID in the URL path.\n   * @param request Web API Request with file ID and data\n   * @returns Promise resolving to ResponseFile with upload result\n   */\n  async put(request) {\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(400, \"File ID is required in URL path\");\n    }\n    if (request.body === null) {\n      throw createHttpError(400, \"Request body is required\");\n    }\n    const contentLengthHeader = request.headers.get(\"content-length\");\n    const contentLength = contentLengthHeader ? Number.parseInt(contentLengthHeader, 10) : 0;\n    if (contentLength === 0) {\n      throw createHttpError(400, \"Content-Length is required and must be greater than 0\");\n    }\n    if (contentLength > this.storage.maxUploadSize) {\n      throw createHttpError(413, `File size exceeds maximum allowed size of ${this.storage.maxUploadSize} bytes`);\n    }\n    const contentType = request.headers.get(\"content-type\") || \"application/octet-stream\";\n    const metadataHeader = request.headers.get(\"x-file-metadata\");\n    let metadata;\n    if (metadataHeader) {\n      try {\n        metadata = JSON.parse(metadataHeader);\n      } catch {\n      }\n    }\n    let originalName;\n    const contentDisposition = request.headers.get(\"content-disposition\");\n    if (contentDisposition) {\n      const filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n      if (filenameMatch && filenameMatch[1]) {\n        originalName = filenameMatch[1].replaceAll(/['\"]/g, \"\");\n      }\n    }\n    const config = {\n      contentType,\n      metadata: metadata || {},\n      originalName,\n      size: contentLength\n    };\n    const requestUrl = request.url;\n    const bodyStream = getRequestStream(request);\n    return this.restBase.handlePut(id, config, requestUrl, bodyStream, contentLength, metadata);\n  }\n  /**\n   * Delete an uploaded file or multiple files.\n   * Supports single file (ID in URL) or batch delete (via ?ids=id1,id2 or JSON body).\n   * @param request Web API Request with file ID(s)\n   * @returns Promise resolving to ResponseFile (single) or ResponseList (batch) with deletion result\n   */\n  async delete(request) {\n    const url = new URL(request.url);\n    const idsParameter = url.searchParams.get(\"ids\");\n    if (idsParameter) {\n      const ids = idsParameter.split(\",\").map((id2) => id2.trim()).filter(Boolean);\n      if (ids.length === 0) {\n        throw createHttpError(400, \"No file IDs provided\");\n      }\n      return this.restBase.deleteBatch(ids);\n    }\n    const contentType = request.headers.get(\"content-type\") || \"\";\n    if (contentType.includes(\"application/json\")) {\n      try {\n        const body = await request.text();\n        const parsed = JSON.parse(body);\n        if (Array.isArray(parsed)) {\n          if (parsed.length === 0) {\n            throw createHttpError(400, \"No file IDs provided\");\n          }\n          return this.restBase.deleteBatch(parsed);\n        }\n        if (typeof parsed === \"object\" && parsed !== null && \"ids\" in parsed && Array.isArray(parsed.ids)) {\n          const idsArray = parsed.ids;\n          if (idsArray.length === 0) {\n            throw createHttpError(400, \"No file IDs provided\");\n          }\n          return this.restBase.deleteBatch(idsArray);\n        }\n      } catch (error) {\n        if (error.statusCode === 400) {\n          throw error;\n        }\n      }\n    }\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    try {\n      return this.restBase.deleteSingle(id);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === ERRORS.FILE_NOT_FOUND || errorWithCode.code === \"ENOENT\") {\n        throw createHttpError(404, \"File not found\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Uploads a chunk via PATCH request for chunked uploads.\n   * Headers required: X-Chunk-Offset (byte offset), Content-Length (chunk size).\n   * Optional: X-Chunk-Checksum (SHA256 checksum for validation).\n   * @param request Web API Request with chunk data.\n   * @returns Promise resolving to ResponseFile with upload progress.\n   */\n  async patch(request) {\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    if (request.body === null) {\n      throw createHttpError(400, \"Request body is required\");\n    }\n    const contentLengthHeader = request.headers.get(\"content-length\");\n    const contentLength = contentLengthHeader ? Number.parseInt(contentLengthHeader, 10) : 0;\n    if (contentLength === 0) {\n      throw createHttpError(400, \"Content-Length is required and must be greater than 0\");\n    }\n    const chunkOffsetHeader = request.headers.get(\"x-chunk-offset\");\n    const chunkOffset = chunkOffsetHeader ? Number.parseInt(chunkOffsetHeader, 10) : void 0;\n    if (chunkOffset === void 0) {\n      throw createHttpError(400, \"X-Chunk-Offset header is required\");\n    }\n    const chunkChecksum = request.headers.get(\"x-chunk-checksum\") || void 0;\n    const requestUrl = request.url;\n    const bodyStream = getRequestStream(request);\n    return this.restBase.handlePatch(id, chunkOffset, contentLength, chunkChecksum, requestUrl, bodyStream);\n  }\n  /**\n   * Get file metadata via HEAD request.\n   * For chunked uploads, also returns upload progress information.\n   * @param request Web API Request with file ID\n   * @returns Promise resolving to ResponseFile with metadata headers\n   */\n  async head(request) {\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    try {\n      return this.restBase.handleHead(id);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === ERRORS.FILE_NOT_FOUND || errorWithCode.code === \"ENOENT\") {\n        throw createHttpError(404, \"File not found\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Handle OPTIONS requests with REST API capabilities.\n   * @param request Web API Request\n   * @returns Promise resolving to ResponseFile with CORS headers\n   */\n  async options(request) {\n    return this.restBase.handleOptions(RestFetch.methods, this.storage.maxUploadSize);\n  }\n  /**\n   * Retrieves a file or list of files based on the request path.\n   * Delegates to BaseHandlerFetch.fetch() method.\n   * @param request Web API Request\n   * @returns Promise resolving to Web API Response\n   */\n  async get(request) {\n    throw createHttpError(500, \"GET requests should be handled via fetch() method\");\n  }\n}\nconst extractFileInitFromRequest = (request, contentLength, contentType) => {\n  const totalSizeHeader = request.headers.get(\"x-total-size\");\n  const totalSize = totalSizeHeader ? Number.parseInt(totalSizeHeader, 10) : contentLength;\n  const metadataHeader = request.headers.get(\"x-file-metadata\");\n  let metadata = {};\n  if (metadataHeader) {\n    try {\n      metadata = JSON.parse(metadataHeader);\n    } catch {\n    }\n  }\n  let originalName;\n  const contentDisposition = request.headers.get(\"content-disposition\");\n  if (contentDisposition) {\n    const filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n    if (filenameMatch && filenameMatch[1]) {\n      originalName = filenameMatch[1].replaceAll(/['\"]/g, \"\");\n    }\n  }\n  return {\n    contentType,\n    metadata,\n    originalName,\n    size: totalSize\n  };\n};\nconst getIdFromRequestUrl = (url) => {\n  try {\n    const urlObject = new URL(url);\n    const pathParts = urlObject.pathname.split(\"/\").filter(Boolean);\n    const lastPart = pathParts[pathParts.length - 1];\n    if (!lastPart) {\n      return void 0;\n    }\n    const id = lastPart.replace(/\\.[^.]+$/, \"\");\n    return id || void 0;\n  } catch {\n    return void 0;\n  }\n};\n\nexport { RestFetch as default };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4823, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/Metadata-v9haqHC6.js"],"sourcesContent":["const isRecord = (x) => x !== null && typeof x === \"object\" && !Array.isArray(x);\n\nconst ASCII_SPACE = \" \".codePointAt(0) ?? 32;\nconst ASCII_COMMA = \",\".codePointAt(0) ?? 44;\nconst BASE64_REGEX = /^[\\d+/A-Z]*={0,2}$/i;\nconst isNumeric = (input) => {\n  if (typeof input !== \"string\") {\n    return false;\n  }\n  const number_ = Number.parseFloat(input);\n  return !Number.isNaN(number_) && isFinite(number_);\n};\nclass Metadata {\n  psize;\n  pname;\n  pfiletype;\n  ptype;\n  pmimeType;\n  pcontentType;\n  ptitle;\n  pfilename;\n  poriginalName;\n  plastModified;\n}\nconst isMetadata = (raw) => isRecord(raw);\nconst validateKey = (key) => {\n  if (key.length === 0) {\n    return false;\n  }\n  for (let index = 0; index < key.length; ++index) {\n    const charCodePoint = key.codePointAt(index);\n    if (charCodePoint > 127 || charCodePoint === ASCII_SPACE || charCodePoint === ASCII_COMMA) {\n      return false;\n    }\n  }\n  return true;\n};\nconst validateValue = (value) => {\n  if (value.length % 4 !== 0) {\n    return false;\n  }\n  return BASE64_REGEX.test(value);\n};\nconst stringifyMetadata = (metadata) => Object.entries(metadata).map(([key, value]) => {\n  if (value === null || value === void 0) {\n    return key;\n  }\n  const stringValue = typeof value === \"object\" ? JSON.stringify(value) : String(value);\n  const encodedValue = Buffer.from(stringValue, \"utf8\").toString(\"base64\");\n  return `${key} ${encodedValue}`;\n}).join(\",\");\nconst parseMetadata = (string_) => {\n  const meta = {};\n  if (!string_ || string_.trim().length === 0) {\n    throw new Error(\"Metadata string is not valid\");\n  }\n  for (const pair of string_.split(\",\")) {\n    const tokens = pair.split(\" \");\n    const [key, value] = tokens;\n    if ((tokens.length === 1 || tokens.length === 2) && validateKey(key) && (tokens.length === 1 || validateValue(value)) && !(key in meta)) {\n      const decodedValue = tokens.length === 1 ? void 0 : value ? Buffer.from(value, \"base64\").toString(\"utf8\") : \"\";\n      let parsedValue = decodedValue;\n      if (decodedValue !== void 0) {\n        try {\n          parsedValue = JSON.parse(decodedValue);\n        } catch {\n          if (decodedValue === \"true\") {\n            parsedValue = true;\n          } else if (decodedValue === \"false\") {\n            parsedValue = false;\n          } else if (isNumeric(decodedValue)) {\n            parsedValue = Number(decodedValue);\n          }\n        }\n      }\n      meta[key] = parsedValue;\n    } else {\n      throw new Error(\"Metadata string is not valid\");\n    }\n  }\n  return meta;\n};\n\nexport { Metadata, isMetadata, parseMetadata, stringifyMetadata, validateKey, validateValue };\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,MAAM,WAAW,CAAC,IAAM,MAAM,QAAQ,OAAO,MAAM,YAAY,CAAC,MAAM,OAAO,CAAC;AAE9E,MAAM,cAAc,IAAI,WAAW,CAAC,MAAM;AAC1C,MAAM,cAAc,IAAI,WAAW,CAAC,MAAM;AAC1C,MAAM,eAAe;AACrB,MAAM,YAAY,CAAC;IACjB,IAAI,OAAO,UAAU,UAAU;QAC7B,OAAO;IACT;IACA,MAAM,UAAU,OAAO,UAAU,CAAC;IAClC,OAAO,CAAC,OAAO,KAAK,CAAC,YAAY,SAAS;AAC5C;AACA,MAAM;IACJ,MAAM;IACN,MAAM;IACN,UAAU;IACV,MAAM;IACN,UAAU;IACV,aAAa;IACb,OAAO;IACP,UAAU;IACV,cAAc;IACd,cAAc;AAChB;AACA,MAAM,aAAa,CAAC,MAAQ,SAAS;AACrC,MAAM,cAAc,CAAC;IACnB,IAAI,IAAI,MAAM,KAAK,GAAG;QACpB,OAAO;IACT;IACA,IAAK,IAAI,QAAQ,GAAG,QAAQ,IAAI,MAAM,EAAE,EAAE,MAAO;QAC/C,MAAM,gBAAgB,IAAI,WAAW,CAAC;QACtC,IAAI,gBAAgB,OAAO,kBAAkB,eAAe,kBAAkB,aAAa;YACzF,OAAO;QACT;IACF;IACA,OAAO;AACT;AACA,MAAM,gBAAgB,CAAC;IACrB,IAAI,MAAM,MAAM,GAAG,MAAM,GAAG;QAC1B,OAAO;IACT;IACA,OAAO,aAAa,IAAI,CAAC;AAC3B;AACA,MAAM,oBAAoB,CAAC,WAAa,OAAO,OAAO,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,KAAK,MAAM;QAChF,IAAI,UAAU,QAAQ,UAAU,KAAK,GAAG;YACtC,OAAO;QACT;QACA,MAAM,cAAc,OAAO,UAAU,WAAW,KAAK,SAAS,CAAC,SAAS,OAAO;QAC/E,MAAM,eAAe,OAAO,IAAI,CAAC,aAAa,QAAQ,QAAQ,CAAC;QAC/D,OAAO,GAAG,IAAI,CAAC,EAAE,cAAc;IACjC,GAAG,IAAI,CAAC;AACR,MAAM,gBAAgB,CAAC;IACrB,MAAM,OAAO,CAAC;IACd,IAAI,CAAC,WAAW,QAAQ,IAAI,GAAG,MAAM,KAAK,GAAG;QAC3C,MAAM,IAAI,MAAM;IAClB;IACA,KAAK,MAAM,QAAQ,QAAQ,KAAK,CAAC,KAAM;QACrC,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,MAAM,CAAC,KAAK,MAAM,GAAG;QACrB,IAAI,CAAC,OAAO,MAAM,KAAK,KAAK,OAAO,MAAM,KAAK,CAAC,KAAK,YAAY,QAAQ,CAAC,OAAO,MAAM,KAAK,KAAK,cAAc,MAAM,KAAK,CAAC,CAAC,OAAO,IAAI,GAAG;YACvI,MAAM,eAAe,OAAO,MAAM,KAAK,IAAI,KAAK,IAAI,QAAQ,OAAO,IAAI,CAAC,OAAO,UAAU,QAAQ,CAAC,UAAU;YAC5G,IAAI,cAAc;YAClB,IAAI,iBAAiB,KAAK,GAAG;gBAC3B,IAAI;oBACF,cAAc,KAAK,KAAK,CAAC;gBAC3B,EAAE,OAAM;oBACN,IAAI,iBAAiB,QAAQ;wBAC3B,cAAc;oBAChB,OAAO,IAAI,iBAAiB,SAAS;wBACnC,cAAc;oBAChB,OAAO,IAAI,UAAU,eAAe;wBAClC,cAAc,OAAO;oBACvB;gBACF;YACF;YACA,IAAI,CAAC,IAAI,GAAG;QACd,OAAO;YACL,MAAM,IAAI,MAAM;QAClB;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 4923, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/TUS_RESUMABLE-E8ESjr80.js"],"sourcesContent":["import { c as createHttpError, H as HeaderUtilities } from './headers-C9CQX79R.js';\nimport { Metadata } from './Metadata-v9haqHC6.js';\n\nconst TUS_RESUMABLE_VERSION = \"1.0.0\";\nconst TUS_VERSION_VERSION = \"1.0.0\";\nconst parseMetadata = (encoded = \"\") => {\n  const kvPairs = encoded.split(\",\").map((kv) => kv.split(\" \"));\n  const metadata = Object.create(Metadata.prototype);\n  Object.values(kvPairs).forEach(([key, value]) => {\n    if (key) {\n      metadata[key] = value ? Buffer.from(value, \"base64\").toString() : \"\";\n    }\n  });\n  return metadata;\n};\nconst serializeMetadata = (object) => {\n  if (!object || Object.keys(object).length === 0) {\n    return \"\";\n  }\n  return Object.entries(object).map(([key, value]) => {\n    if (value === void 0) {\n      return key;\n    }\n    return `${key} ${Buffer.from(String(value)).toString(\"base64\")}`;\n  }).toString();\n};\nclass TusBase {\n  /**\n   * Storage instance for file operations.\n   */\n  get storage() {\n    throw new Error(\"storage must be implemented\");\n  }\n  /**\n   * Build file URL from request URL and file data.\n   * @param requestUrl Request URL string\n   * @param file File object containing ID\n   * @returns Constructed file URL for TUS protocol\n   */\n  buildFileUrl(requestUrl, file) {\n    throw new Error(\"buildFileUrl must be implemented\");\n  }\n  /**\n   * Handle OPTIONS request with TUS protocol capabilities.\n   * @param methods Array of supported HTTP methods\n   * @returns ResponseFile with TUS headers\n   */\n  handleOptions(methods) {\n    const headers = {\n      \"Access-Control-Allow-Headers\": \"Authorization, Content-Type, Location, Tus-Extension, Tus-Max-Size, Tus-Resumable, Tus-Version, Upload-Concat, Upload-Defer-Length, Upload-Length, Upload-Metadata, Upload-Offset, X-HTTP-Method-Override, X-Requested-With\",\n      \"Access-Control-Allow-Methods\": methods.map((method) => method.toUpperCase()).join(\", \"),\n      \"Access-Control-Max-Age\": 86400,\n      \"Tus-Checksum-Algorithm\": this.storage.checksumTypes.join(\",\"),\n      \"Tus-Extension\": this.storage.tusExtension.toString(),\n      \"Tus-Max-Size\": this.storage.maxUploadSize,\n      \"Tus-Version\": TUS_VERSION_VERSION\n    };\n    return { headers, statusCode: 204 };\n  }\n  /**\n   * Handle TUS POST (create upload).\n   * @param uploadLength Upload length header value\n   * @param uploadDeferLength Upload defer length header value\n   * @param uploadConcat Upload concat header value\n   * @param metadataHeader Upload metadata header value\n   * @param requestUrl Request URL for Location header\n   * @param bodyStream Request body stream (for creation-with-upload)\n   * @param contentLength Content length (for creation-with-upload)\n   * @param contentType Content type (for creation-with-upload)\n   * @returns Promise resolving to ResponseFile with upload result\n   */\n  async handlePost(uploadLength, uploadDeferLength, uploadConcat, metadataHeader, requestUrl, bodyStream, contentLength, contentType) {\n    if (uploadDeferLength !== void 0) {\n      if (!this.storage.tusExtension.includes(\"creation-defer-length\")) {\n        throw createHttpError(501, \"creation-defer-length extension is not (yet) supported.\");\n      }\n      if (uploadLength === void 0) {\n        const metadata2 = metadataHeader ? parseMetadata(metadataHeader) : {};\n        const config2 = { metadata: metadata2 };\n        let file2 = await this.storage.create(config2);\n        if (contentType === \"application/offset+octet-stream\" && contentLength > 0) {\n          file2 = await this.storage.write({\n            ...file2,\n            body: bodyStream,\n            contentLength,\n            start: 0\n          });\n        }\n        let headers2 = {};\n        if (this.storage.tusExtension.includes(\"expiration\") && typeof file2.expiredAt === \"number\" && file2.size === void 0) {\n          headers2 = { \"Upload-Expires\": new Date(file2.expiredAt).toUTCString() };\n        }\n        const locationUrl2 = this.buildFileUrl(requestUrl, file2);\n        headers2 = { ...headers2, ...this.buildHeaders(file2, { Location: locationUrl2 }) };\n        if (!headers2.Location) {\n          headers2.Location = locationUrl2;\n        }\n        if (file2.bytesWritten > 0) {\n          headers2[\"Upload-Offset\"] = file2.bytesWritten.toString();\n        }\n        headers2[\"Upload-Defer-Length\"] = \"1\";\n        const statusCode2 = file2.bytesWritten > 0 ? 200 : 201;\n        return { ...file2, headers: headers2, statusCode: statusCode2 };\n      }\n    }\n    if (uploadConcat) {\n      if (!this.storage.tusExtension.includes(\"concatenation\")) {\n        throw createHttpError(501, \"Concatenation extension is not (yet) supported. Disable parallel upload in the tus client.\");\n      }\n      const parsedMetadata = metadataHeader ? parseMetadata(metadataHeader) : {};\n      if (uploadConcat === \"partial\") {\n        const config2 = {\n          metadata: { ...parsedMetadata, uploadConcat: \"partial\" },\n          size: uploadLength\n        };\n        let file2 = await this.storage.create(config2);\n        if (contentType === \"application/offset+octet-stream\" && contentLength > 0) {\n          file2 = await this.storage.write({\n            ...file2,\n            body: bodyStream,\n            contentLength,\n            start: 0\n          });\n        }\n        let headers2 = {};\n        if (this.storage.tusExtension.includes(\"expiration\") && typeof file2.expiredAt === \"number\" && file2.bytesWritten !== (file2.size ?? 0)) {\n          headers2 = { \"Upload-Expires\": new Date(file2.expiredAt).toUTCString() };\n        }\n        const locationUrl2 = this.buildFileUrl(requestUrl, file2);\n        headers2 = { ...headers2, ...this.buildHeaders(file2, { Location: locationUrl2 }) };\n        if (!headers2.Location) {\n          headers2.Location = locationUrl2;\n        }\n        if (file2.bytesWritten > 0) {\n          headers2[\"Upload-Offset\"] = file2.bytesWritten.toString();\n        }\n        headers2[\"Upload-Concat\"] = \"partial\";\n        const statusCode2 = file2.bytesWritten > 0 ? 200 : 201;\n        return { ...file2, headers: headers2, statusCode: statusCode2 };\n      }\n      if (uploadConcat.startsWith(\"final;\")) {\n        const partialIds = uploadConcat.slice(6).trim().split(/\\s+/).filter(Boolean);\n        if (partialIds.length === 0) {\n          throw createHttpError(400, \"Upload-Concat final must include at least one partial upload ID\");\n        }\n        let totalSize = 0;\n        const partialFiles = [];\n        for (const partialId of partialIds) {\n          try {\n            const partialFile = await this.storage.getMeta(partialId);\n            await this.storage.checkIfExpired(partialFile);\n            if (partialFile.metadata?.uploadConcat !== \"partial\") {\n              throw createHttpError(400, `Upload ${partialId} is not a partial upload`);\n            }\n            if (partialFile.status !== \"completed\" || partialFile.size === void 0) {\n              throw createHttpError(409, `Partial upload ${partialId} is not completed`);\n            }\n            partialFiles.push(partialFile);\n            totalSize += partialFile.size;\n          } catch (error) {\n            const errorWithCode = error;\n            if (errorWithCode.statusCode === 404 || errorWithCode.statusCode === 410) {\n              throw createHttpError(409, `Partial upload ${partialId} not found or expired`);\n            }\n            throw error;\n          }\n        }\n        const config2 = {\n          metadata: {\n            ...parsedMetadata,\n            partialIds,\n            uploadConcat: `final;${partialIds.join(\" \")}`\n          },\n          size: totalSize\n        };\n        const file2 = await this.storage.create(config2);\n        await this.concatenateFiles(file2, partialFiles);\n        const locationUrl2 = this.buildFileUrl(requestUrl, file2);\n        const headers2 = {\n          ...this.buildHeaders(file2, { Location: locationUrl2 }),\n          \"Upload-Concat\": uploadConcat\n        };\n        return { ...file2, headers: headers2, statusCode: 201 };\n      }\n      throw createHttpError(400, \"Invalid Upload-Concat header format\");\n    }\n    if (uploadLength === void 0 && uploadDeferLength === void 0) {\n      throw createHttpError(400, \"Either upload-length or upload-defer-length must be specified.\");\n    }\n    if (uploadLength !== void 0 && Number.isNaN(Number(uploadLength))) {\n      throw createHttpError(400, \"Invalid upload-length\");\n    }\n    const metadata = metadataHeader ? parseMetadata(metadataHeader) : {};\n    const config = { metadata, size: uploadLength };\n    let file = await this.storage.create(config);\n    if (contentType === \"application/offset+octet-stream\" && contentLength > 0) {\n      file = await this.storage.write({\n        ...file,\n        body: bodyStream,\n        contentLength,\n        start: 0\n      });\n    }\n    let headers = {};\n    if (this.storage.tusExtension.includes(\"expiration\") && typeof file.expiredAt === \"number\" && file.bytesWritten !== Number.parseInt(uploadLength, 10)) {\n      headers = { \"Upload-Expires\": new Date(file.expiredAt).toUTCString() };\n    }\n    const locationUrl = this.buildFileUrl(requestUrl, file);\n    headers = { ...headers, ...this.buildHeaders(file, { Location: locationUrl }) };\n    if (!headers.Location) {\n      headers.Location = locationUrl;\n    }\n    if (file.bytesWritten > 0) {\n      headers[\"Upload-Offset\"] = file.bytesWritten.toString();\n    }\n    const statusCode = file.bytesWritten > 0 ? 200 : 201;\n    return { ...file, headers, statusCode };\n  }\n  /**\n   * Handle TUS PATCH (write chunk).\n   * @param id File ID from URL\n   * @param uploadOffset Upload offset header value\n   * @param uploadLength Optional upload length header value (for defer-length)\n   * @param metadataHeader Optional upload metadata header value\n   * @param checksum Optional checksum\n   * @param checksumAlgorithm Optional checksum algorithm\n   * @param requestUrl Request URL for Location header\n   * @param bodyStream Request body stream\n   * @param contentLength Content length\n   * @returns Promise resolving to ResponseFile with upload progress\n   */\n  async handlePatch(id, uploadOffset, uploadLength, metadataHeader, checksum, checksumAlgorithm, requestUrl, bodyStream, contentLength) {\n    const metadata = metadataHeader ? parseMetadata(metadataHeader) : void 0;\n    if (metadata) {\n      try {\n        await this.storage.update({ id }, { id, metadata });\n      } catch (error) {\n        const errorWithCode = error;\n        if (errorWithCode.UploadErrorCode === \"FILE_NOT_FOUND\") {\n          throw createHttpError(410, \"Upload expired\");\n        }\n        throw error;\n      }\n    }\n    let currentFile;\n    try {\n      currentFile = await this.storage.getMeta(id);\n      await this.storage.checkIfExpired(currentFile);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === \"GONE\" || errorWithCode.UploadErrorCode === \"FILE_NOT_FOUND\") {\n        throw createHttpError(410, \"Upload expired\");\n      }\n      throw error;\n    }\n    const uploadConcatValue = currentFile.metadata?.uploadConcat;\n    if (typeof uploadConcatValue === \"string\" && uploadConcatValue.startsWith(\"final;\")) {\n      throw createHttpError(403, \"Cannot PATCH a final concatenation upload\");\n    }\n    let file = await this.storage.write({\n      body: bodyStream,\n      checksum,\n      checksumAlgorithm,\n      contentLength,\n      id,\n      start: uploadOffset\n    });\n    if (uploadLength !== void 0) {\n      if (!this.storage.tusExtension.includes(\"creation-defer-length\")) {\n        throw createHttpError(501, \"creation-defer-length extension is not (yet) supported.\");\n      }\n      if (file.size !== void 0 && !Number.isNaN(file.size)) {\n        throw createHttpError(412, \"Upload-Length has already been set for this upload\");\n      }\n      const size = Number.parseInt(uploadLength, 10);\n      if (Number.isNaN(size)) {\n        throw createHttpError(400, \"Invalid Upload-Length value\");\n      }\n      if (size < file.bytesWritten) {\n        throw createHttpError(400, \"Upload-Length is smaller than the current offset\");\n      }\n      file = await this.storage.update({ id }, { size });\n      if (file.bytesWritten === file.size) {\n        file.status = \"completed\";\n      }\n    }\n    return {\n      ...file,\n      headers: this.buildHeaders(file, {\n        \"Upload-Offset\": file.bytesWritten\n      }),\n      statusCode: file.status === \"completed\" ? 200 : 204\n    };\n  }\n  /**\n   * Handle TUS HEAD (get upload status).\n   * @param id File ID from URL\n   * @returns Promise resolving to ResponseFile with upload status headers\n   */\n  async handleHead(id) {\n    const file = await this.storage.getMeta(id);\n    await this.storage.checkIfExpired(file);\n    const headers = {\n      ...typeof file.size === \"number\" && !Number.isNaN(file.size) ? {\n        \"Upload-Length\": file.size\n      } : {\n        \"Upload-Defer-Length\": \"1\"\n      },\n      ...this.buildHeaders(file, {\n        \"Cache-Control\": HeaderUtilities.createCacheControlPreset(\"no-store\"),\n        \"Upload-Metadata\": serializeMetadata(file.metadata),\n        \"Upload-Offset\": file.bytesWritten\n      })\n    };\n    const uploadConcatValue = file.metadata?.uploadConcat;\n    if (typeof uploadConcatValue === \"string\") {\n      headers[\"Upload-Concat\"] = uploadConcatValue;\n    }\n    return { headers, statusCode: 200 };\n  }\n  /**\n   * Handle TUS GET (get upload metadata).\n   * @param id File ID from URL\n   * @returns Promise resolving to ResponseFile with file metadata as JSON\n   */\n  async handleGet(id) {\n    const file = await this.storage.getMeta(id);\n    return {\n      ...file,\n      body: file,\n      // Return file metadata as JSON\n      headers: this.buildHeaders(file, {\n        \"Content-Type\": HeaderUtilities.createContentType({\n          mediaType: \"application/json\"\n        })\n      }),\n      statusCode: 200\n    };\n  }\n  /**\n   * Handle TUS DELETE (terminate upload).\n   * @param id File ID from URL\n   * @returns Promise resolving to ResponseFile with deletion confirmation\n   */\n  async handleDelete(id) {\n    if (this.disableTerminationForFinishedUploads) {\n      const file2 = await this.storage.getMeta(id);\n      if (file2.status === \"completed\") {\n        throw createHttpError(400, \"Termination of finished uploads is disabled\");\n      }\n    }\n    const file = await this.storage.delete({ id });\n    if (file.status === void 0) {\n      throw createHttpError(404, \"File not found\");\n    }\n    return {\n      ...file,\n      headers: this.buildHeaders(file),\n      statusCode: 204\n    };\n  }\n  /**\n   * Build TUS protocol headers including required Tus-Resumable and optional Upload-Expires.\n   * @param file Upload file object with metadata\n   * @param headers Additional headers to include\n   * @returns Headers object with TUS protocol headers\n   */\n  buildHeaders(file, headers = {}) {\n    headers[\"Tus-Resumable\"] = TUS_RESUMABLE_VERSION;\n    if (this.storage.tusExtension.includes(\"expiration\") && file.expiredAt !== void 0) {\n      headers[\"Upload-Expires\"] = new Date(file.expiredAt).toUTCString();\n    }\n    return headers;\n  }\n  /**\n   * Extract checksum algorithm and value from Upload-Checksum header.\n   * @param checksumHeader Upload-Checksum header value\n   * @returns Object containing checksum algorithm and value\n   */\n  extractChecksum(checksumHeader) {\n    if (!checksumHeader) {\n      return { checksum: void 0, checksumAlgorithm: void 0 };\n    }\n    const [checksumAlgorithm, checksum] = checksumHeader.split(/\\s+/).filter(Boolean);\n    return { checksum, checksumAlgorithm };\n  }\n  /**\n   * Validate Tus-Resumable header value.\n   * @param tusResumable Tus-Resumable header value\n   * @throws {Error} 412 if version doesn't match or header is missing\n   */\n  validateTusResumableHeader(tusResumable) {\n    if (!tusResumable) {\n      throw createHttpError(412, \"Missing Tus-Resumable header\");\n    }\n    if (tusResumable !== TUS_RESUMABLE_VERSION) {\n      throw createHttpError(412, `Unsupported TUS version: ${tusResumable}. Server supports: ${TUS_RESUMABLE_VERSION}`);\n    }\n  }\n  /**\n   * Concatenate partial uploads into a final upload.\n   * @param finalFile Final file that will contain concatenated content\n   * @param partialFiles Array of partial upload files to concatenate\n   * @returns Promise resolving when concatenation is complete\n   */\n  async concatenateFiles(finalFile, partialFiles) {\n    let offset = 0;\n    for (const partialFile of partialFiles) {\n      const { size, stream } = await this.storage.getStream({ id: partialFile.id });\n      if (size === void 0) {\n        throw createHttpError(500, \"Partial upload size is undefined\");\n      }\n      const updatedFile = await this.storage.write({\n        ...finalFile,\n        body: stream,\n        contentLength: size,\n        start: offset\n      });\n      Object.assign(finalFile, updatedFile);\n      offset += size;\n    }\n    if (finalFile.size !== void 0 && finalFile.bytesWritten !== finalFile.size) {\n      await this.storage.update({ id: finalFile.id }, { bytesWritten: finalFile.size });\n    }\n  }\n}\nconst TUS_RESUMABLE = TUS_RESUMABLE_VERSION;\nconst TUS_VERSION = TUS_VERSION_VERSION;\n\nexport { TUS_RESUMABLE, TUS_VERSION, TusBase, parseMetadata, serializeMetadata };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5433, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/Tus-BnhzcQUB.js"],"sourcesContent":["import { c as createHttpError } from './headers-C9CQX79R.js';\nimport { B as BaseHandlerFetch } from './base-handler-fetch-DkAUTzhr.js';\nimport { TusBase } from './TUS_RESUMABLE-E8ESjr80.js';\nexport { TUS_RESUMABLE, TUS_VERSION } from './TUS_RESUMABLE-E8ESjr80.js';\n\nclass Tus extends BaseHandlerFetch {\n  /**\n   * Limiting enabled http method handler\n   */\n  static methods = [\"delete\", \"download\", \"get\", \"head\", \"options\", \"patch\", \"post\"];\n  tusBase;\n  disableTerminationForFinishedUploads = false;\n  constructor(options) {\n    super(options);\n    this.disableTerminationForFinishedUploads = options.disableTerminationForFinishedUploads ?? false;\n    const tusInstance = this;\n    this.tusBase = new class extends TusBase {\n      get storage() {\n        return tusInstance.storage;\n      }\n      get disableTerminationForFinishedUploads() {\n        return tusInstance.disableTerminationForFinishedUploads;\n      }\n      buildFileUrl(requestUrl, file) {\n        return tusInstance.buildFileUrlForTus(requestUrl, file);\n      }\n    }();\n  }\n  /**\n   * Handle OPTIONS requests with TUS protocol capabilities.\n   * @returns Promise resolving to ResponseFile with TUS headers\n   */\n  async options() {\n    return this.tusBase.handleOptions(Tus.methods);\n  }\n  /**\n   * Creates a new TUS upload and optionally starts uploading data.\n   * @param request Web API Request with TUS headers.\n   * @returns Promise resolving to ResponseFile with upload location and offset.\n   */\n  async post(request) {\n    const tusResumable = request.headers.get(\"tus-resumable\");\n    this.tusBase.validateTusResumableHeader(tusResumable || void 0);\n    const uploadLength = request.headers.get(\"upload-length\") || void 0;\n    const uploadDeferLength = request.headers.get(\"upload-defer-length\") || void 0;\n    const uploadConcat = request.headers.get(\"upload-concat\") || void 0;\n    const metadataHeader = request.headers.get(\"upload-metadata\") || void 0;\n    const contentType = request.headers.get(\"content-type\") || \"\";\n    const contentLengthHeader = request.headers.get(\"content-length\");\n    const contentLength = contentLengthHeader ? Number.parseInt(contentLengthHeader, 10) : 0;\n    const requestUrl = request.url;\n    const bodyStream = request.body;\n    return this.tusBase.handlePost(uploadLength, uploadDeferLength, uploadConcat, metadataHeader, requestUrl, bodyStream, contentLength, contentType);\n  }\n  /**\n   * Write a chunk of data to an existing TUS upload.\n   * @param request Web API Request with chunk data and TUS headers\n   * @returns Promise resolving to ResponseFile with updated offset\n   */\n  async patch(request) {\n    const tusResumable = request.headers.get(\"tus-resumable\");\n    this.tusBase.validateTusResumableHeader(tusResumable || void 0);\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    const uploadOffsetHeader = request.headers.get(\"upload-offset\");\n    if (!uploadOffsetHeader) {\n      throw createHttpError(412, \"Missing Upload-Offset header\");\n    }\n    const contentType = request.headers.get(\"content-type\");\n    if (!contentType) {\n      throw createHttpError(412, \"Content-Type header required\");\n    }\n    if (contentType !== \"application/offset+octet-stream\") {\n      throw createHttpError(415, \"Unsupported Media Type\");\n    }\n    const uploadOffset = Number.parseInt(uploadOffsetHeader, 10);\n    const uploadLength = request.headers.get(\"upload-length\") || void 0;\n    const metadataHeader = request.headers.get(\"upload-metadata\") || void 0;\n    const contentLengthHeader = request.headers.get(\"content-length\");\n    const contentLength = contentLengthHeader ? Number.parseInt(contentLengthHeader, 10) : 0;\n    const checksumHeader = request.headers.get(\"upload-checksum\") || void 0;\n    const { checksum, checksumAlgorithm } = this.tusBase.extractChecksum(checksumHeader);\n    const requestUrl = request.url;\n    const bodyStream = request.body;\n    try {\n      return this.tusBase.handlePatch(id, uploadOffset, uploadLength, metadataHeader, checksum, checksumAlgorithm, requestUrl, bodyStream, contentLength);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === \"GONE\" || errorWithCode.UploadErrorCode === \"FILE_NOT_FOUND\") {\n        throw createHttpError(410, \"Upload expired\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Get current upload offset and metadata for TUS resumable uploads.\n   * @param request Web API Request with upload ID\n   * @returns Promise resolving to ResponseFile with upload-offset and metadata headers\n   */\n  async head(request) {\n    const tusResumable = request.headers.get(\"tus-resumable\");\n    this.tusBase.validateTusResumableHeader(tusResumable || void 0);\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    try {\n      return this.tusBase.handleHead(id);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === \"GONE\" || errorWithCode.UploadErrorCode === \"FILE_NOT_FOUND\") {\n        throw createHttpError(410, \"Upload expired\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Get TUS upload metadata and current status.\n   * @param request Web API Request with upload ID\n   * @returns Promise resolving to ResponseFile with file metadata as JSON\n   */\n  async get(request) {\n    const tusResumable = request.headers.get(\"tus-resumable\");\n    this.tusBase.validateTusResumableHeader(tusResumable || void 0);\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    try {\n      return this.tusBase.handleGet(id);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.UploadErrorCode === \"GONE\") {\n        throw createHttpError(410, \"Upload expired\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Delete a TUS upload and its associated data.\n   * @param request Web API Request with upload ID\n   * @returns Promise resolving to ResponseFile with deletion confirmation\n   */\n  async delete(request) {\n    const tusResumable = request.headers.get(\"tus-resumable\");\n    this.tusBase.validateTusResumableHeader(tusResumable || void 0);\n    const id = getIdFromRequestUrl(request.url);\n    if (!id) {\n      throw createHttpError(404, \"File not found\");\n    }\n    try {\n      return this.tusBase.handleDelete(id);\n    } catch (error) {\n      const errorWithCode = error;\n      if (errorWithCode.code === \"ENOENT\") {\n        throw createHttpError(404, \"File not found\");\n      }\n      throw error;\n    }\n  }\n  /**\n   * Compose and register HTTP method handlers.\n   */\n  compose() {\n    this.registeredHandlers.set(\"POST\", this.post.bind(this));\n    this.registeredHandlers.set(\"PATCH\", this.patch.bind(this));\n    this.registeredHandlers.set(\"HEAD\", this.head.bind(this));\n    this.registeredHandlers.set(\"GET\", this.get.bind(this));\n    this.registeredHandlers.set(\"DELETE\", this.delete.bind(this));\n    this.registeredHandlers.set(\"OPTIONS\", this.options.bind(this));\n    this.logger?.debug(\"Registered handler: %s\", [...this.registeredHandlers.keys()].join(\", \"));\n  }\n  /**\n   * Build file URL for TUS uploads (without file extension).\n   * @param requestUrl Request URL string\n   * @param file File object containing ID\n   * @returns Constructed file URL for TUS protocol\n   */\n  buildFileUrlForTus(requestUrl, file) {\n    const url = new URL(requestUrl);\n    const { pathname } = url;\n    Object.fromEntries(url.searchParams.entries());\n    const relative = `${pathname}/${file.id}${url.search}`;\n    return `${this.storage.config.useRelativeLocation ? relative : url.origin + relative}`;\n  }\n}\nconst getIdFromRequestUrl = (url) => {\n  try {\n    const urlObject = new URL(url);\n    const pathParts = urlObject.pathname.split(\"/\").filter(Boolean);\n    const lastPart = pathParts[pathParts.length - 1];\n    return lastPart || void 0;\n  } catch {\n    return void 0;\n  }\n};\n\nexport { Tus as default };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5643, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/handler/http/nextjs/index.js"],"sourcesContent":["import Multipart from '../../../packem_shared/Multipart-D3eg40wT.js';\nimport RestFetch from '../../../packem_shared/Rest-DxBjOMcM.js';\nimport Tus from '../../../packem_shared/Tus-BnhzcQUB.js';\n\nconst waitForStorage = async (storage) => {\n  if (storage.isReady) {\n    return;\n  }\n  const maxWait = 5e3;\n  const startTime = Date.now();\n  while (!storage.isReady && Date.now() - startTime < maxWait) {\n    await new Promise((resolve) => {\n      setTimeout(() => {\n        resolve();\n      }, 100);\n    });\n  }\n  if (!storage.isReady) {\n    throw new Error(\"Storage initialization timeout\");\n  }\n};\nconst createNextjsHandler = (config) => {\n  let handler;\n  switch (config.type) {\n    case \"multipart\": {\n      handler = new Multipart(config);\n      break;\n    }\n    case \"rest\": {\n      handler = new RestFetch(config);\n      break;\n    }\n    case \"tus\": {\n      handler = new Tus(config);\n      break;\n    }\n    default: {\n      throw new Error(`Unknown handler type: ${String(config.type ?? \"unknown\")}`);\n    }\n  }\n  const nextjsHandler = async (request) => {\n    try {\n      await waitForStorage(handler.storage);\n      return await handler.fetch(request);\n    } catch (error) {\n      const errorObject = error;\n      const statusCode = errorObject.statusCode || (errorObject.status ? Number.parseInt(errorObject.status, 10) : void 0) || 500;\n      return Response.json(\n        { error: errorObject.message || \"Request failed\" },\n        { status: statusCode }\n      );\n    }\n  };\n  return nextjsHandler;\n};\n\nexport { createNextjsHandler };\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,iBAAiB,OAAO;IAC5B,IAAI,QAAQ,OAAO,EAAE;QACnB;IACF;IACA,MAAM,UAAU;IAChB,MAAM,YAAY,KAAK,GAAG;IAC1B,MAAO,CAAC,QAAQ,OAAO,IAAI,KAAK,GAAG,KAAK,YAAY,QAAS;QAC3D,MAAM,IAAI,QAAQ,CAAC;YACjB,WAAW;gBACT;YACF,GAAG;QACL;IACF;IACA,IAAI,CAAC,QAAQ,OAAO,EAAE;QACpB,MAAM,IAAI,MAAM;IAClB;AACF;AACA,MAAM,sBAAsB,CAAC;IAC3B,IAAI;IACJ,OAAQ,OAAO,IAAI;QACjB,KAAK;YAAa;gBAChB,UAAU,IAAI,kLAAS,CAAC;gBACxB;YACF;QACA,KAAK;YAAQ;gBACX,UAAU,IAAI,6KAAS,CAAC;gBACxB;YACF;QACA,KAAK;YAAO;gBACV,UAAU,IAAI,4LAAG,CAAC;gBAClB;YACF;QACA;YAAS;gBACP,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,OAAO,OAAO,IAAI,IAAI,YAAY;YAC7E;IACF;IACA,MAAM,gBAAgB,OAAO;QAC3B,IAAI;YACF,MAAM,eAAe,QAAQ,OAAO;YACpC,OAAO,MAAM,QAAQ,KAAK,CAAC;QAC7B,EAAE,OAAO,OAAO;YACd,MAAM,cAAc;YACpB,MAAM,aAAa,YAAY,UAAU,IAAI,CAAC,YAAY,MAAM,GAAG,OAAO,QAAQ,CAAC,YAAY,MAAM,EAAE,MAAM,KAAK,CAAC,KAAK;YACxH,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO,YAAY,OAAO,IAAI;YAAiB,GACjD;gBAAE,QAAQ;YAAW;QAEzB;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 5756, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/part-match-CW8Z1naC.js"],"sourcesContent":["import { PassThrough, Transform } from 'node:stream';\nimport { fileTypeFromBuffer } from 'file-type';\n\nconst detectFileTypeFromBuffer = async (buffer) => {\n  try {\n    return await fileTypeFromBuffer(buffer);\n  } catch {\n    return void 0;\n  }\n};\nconst detectFileTypeFromStream = async (stream, options) => {\n  const sampleSize = 4100;\n  let fileType;\n  const chunks = [];\n  let totalLength = 0;\n  let detectionStarted = false;\n  let detectionPromise;\n  const outputStream = new PassThrough({ highWaterMark: 0 });\n  const peekStream = new Transform({\n    objectMode: false,\n    transform(chunk, _encoding, callback) {\n      if (!detectionStarted) {\n        chunks.push(chunk);\n        totalLength += chunk.length;\n        if (totalLength >= sampleSize || totalLength > 0) {\n          detectionStarted = true;\n          const buffer = Buffer.concat(chunks);\n          detectionPromise = fileTypeFromBuffer(buffer).then((detected) => {\n            fileType = detected;\n            return detected;\n          }).catch(() => void 0);\n        }\n      }\n      callback(void 0, chunk);\n    }\n  });\n  stream.pipe(peekStream).pipe(outputStream);\n  stream.on(\"error\", (error) => {\n    peekStream.destroy(error);\n    outputStream.destroy(error);\n  });\n  peekStream.on(\"error\", (error) => {\n    if (!outputStream.destroyed) {\n      outputStream.destroy(error);\n    }\n  });\n  await Promise.race([\n    new Promise((resolve) => {\n      if (detectionStarted) {\n        resolve();\n        return;\n      }\n      const timeout = setTimeout(() => resolve(), 10);\n      peekStream.once(\"data\", () => {\n        clearTimeout(timeout);\n        resolve();\n      });\n      peekStream.once(\"end\", () => {\n        clearTimeout(timeout);\n        resolve();\n      });\n    }),\n    new Promise((resolve) => {\n      setTimeout(() => resolve(), 10);\n    })\n  ]);\n  if (detectionPromise) {\n    await Promise.race([\n      detectionPromise.then(() => void 0),\n      new Promise((resolve) => {\n        setTimeout(() => resolve(), 150);\n      })\n    ]).catch(() => {\n    });\n  }\n  return { fileType, stream: outputStream };\n};\n\nconst getFileStatus = (file) => file.bytesWritten === file.size ? \"completed\" : file.createdAt ? \"part\" : \"created\";\n\nconst partMatch = (part, file) => {\n  if (part.size !== void 0 && file.size !== void 0 && part.size > 0 && file.size > 0 && part.size > file.size) {\n    return false;\n  }\n  if (file.size === void 0) {\n    return true;\n  }\n  return (part.start || 0) + (part.contentLength || 0) <= file.size;\n};\n\nexport { detectFileTypeFromBuffer as a, detectFileTypeFromStream as d, getFileStatus as g, partMatch as p };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,2BAA2B,OAAO;IACtC,IAAI;QACF,OAAO,MAAM,IAAA,sNAAkB,EAAC;IAClC,EAAE,OAAM;QACN,OAAO,KAAK;IACd;AACF;AACA,MAAM,2BAA2B,OAAO,QAAQ;IAC9C,MAAM,aAAa;IACnB,IAAI;IACJ,MAAM,SAAS,EAAE;IACjB,IAAI,cAAc;IAClB,IAAI,mBAAmB;IACvB,IAAI;IACJ,MAAM,eAAe,IAAI,oIAAW,CAAC;QAAE,eAAe;IAAE;IACxD,MAAM,aAAa,IAAI,kIAAS,CAAC;QAC/B,YAAY;QACZ,WAAU,KAAK,EAAE,SAAS,EAAE,QAAQ;YAClC,IAAI,CAAC,kBAAkB;gBACrB,OAAO,IAAI,CAAC;gBACZ,eAAe,MAAM,MAAM;gBAC3B,IAAI,eAAe,cAAc,cAAc,GAAG;oBAChD,mBAAmB;oBACnB,MAAM,SAAS,OAAO,MAAM,CAAC;oBAC7B,mBAAmB,IAAA,sNAAkB,EAAC,QAAQ,IAAI,CAAC,CAAC;wBAClD,WAAW;wBACX,OAAO;oBACT,GAAG,KAAK,CAAC,IAAM,KAAK;gBACtB;YACF;YACA,SAAS,KAAK,GAAG;QACnB;IACF;IACA,OAAO,IAAI,CAAC,YAAY,IAAI,CAAC;IAC7B,OAAO,EAAE,CAAC,SAAS,CAAC;QAClB,WAAW,OAAO,CAAC;QACnB,aAAa,OAAO,CAAC;IACvB;IACA,WAAW,EAAE,CAAC,SAAS,CAAC;QACtB,IAAI,CAAC,aAAa,SAAS,EAAE;YAC3B,aAAa,OAAO,CAAC;QACvB;IACF;IACA,MAAM,QAAQ,IAAI,CAAC;QACjB,IAAI,QAAQ,CAAC;YACX,IAAI,kBAAkB;gBACpB;gBACA;YACF;YACA,MAAM,UAAU,WAAW,IAAM,WAAW;YAC5C,WAAW,IAAI,CAAC,QAAQ;gBACtB,aAAa;gBACb;YACF;YACA,WAAW,IAAI,CAAC,OAAO;gBACrB,aAAa;gBACb;YACF;QACF;QACA,IAAI,QAAQ,CAAC;YACX,WAAW,IAAM,WAAW;QAC9B;KACD;IACD,IAAI,kBAAkB;QACpB,MAAM,QAAQ,IAAI,CAAC;YACjB,iBAAiB,IAAI,CAAC,IAAM,KAAK;YACjC,IAAI,QAAQ,CAAC;gBACX,WAAW,IAAM,WAAW;YAC9B;SACD,EAAE,KAAK,CAAC,KACT;IACF;IACA,OAAO;QAAE;QAAU,QAAQ;IAAa;AAC1C;AAEA,MAAM,gBAAgB,CAAC,OAAS,KAAK,YAAY,KAAK,KAAK,IAAI,GAAG,cAAc,KAAK,SAAS,GAAG,SAAS;AAE1G,MAAM,YAAY,CAAC,MAAM;IACvB,IAAI,KAAK,IAAI,KAAK,KAAK,KAAK,KAAK,IAAI,KAAK,KAAK,KAAK,KAAK,IAAI,GAAG,KAAK,KAAK,IAAI,GAAG,KAAK,KAAK,IAAI,GAAG,KAAK,IAAI,EAAE;QAC3G,OAAO;IACT;IACA,IAAI,KAAK,IAAI,KAAK,KAAK,GAAG;QACxB,OAAO;IACT;IACA,OAAO,CAAC,KAAK,KAAK,IAAI,CAAC,IAAI,CAAC,KAAK,aAAa,IAAI,CAAC,KAAK,KAAK,IAAI;AACnE"}},
    {"offset": {"line": 5881, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/NoOpMetrics-DhAk5rXc.js"],"sourcesContent":["class NoOpMetrics {\n  increment(_name, _value, _attributes) {\n  }\n  timing(_name, _duration, _attributes) {\n  }\n  gauge(_name, _value, _attributes) {\n  }\n}\n\nexport { NoOpMetrics as default };\n"],"names":[],"mappings":";;;;AAAA,MAAM;IACJ,UAAU,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,CACtC;IACA,OAAO,KAAK,EAAE,SAAS,EAAE,WAAW,EAAE,CACtC;IACA,MAAM,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE,CAClC;AACF"}},
    {"offset": {"line": 5895, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/cache-B88MXQ_2.js"],"sourcesContent":["class NoOpCache {\n  get() {\n    return void 0;\n  }\n  set() {\n    return true;\n  }\n  delete() {\n    return true;\n  }\n  clear() {\n  }\n  has() {\n    return false;\n  }\n}\n\nexport { NoOpCache as N };\n"],"names":[],"mappings":";;;;AAAA,MAAM;IACJ,MAAM;QACJ,OAAO,KAAK;IACd;IACA,MAAM;QACJ,OAAO;IACT;IACA,SAAS;QACP,OAAO;IACT;IACA,QAAQ,CACR;IACA,MAAM;QACJ,OAAO;IACT;AACF"}},
    {"offset": {"line": 5919, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/path-CR6YkPXX-7R1-9CMk.js"],"sourcesContent":["const DRIVE_LETTER_START_RE = /^[A-Z]:\\//i;\nconst normalizeWindowsPath = (input = \"\") => {\n  if (!input) {\n    return input;\n  }\n  return input.replaceAll(\"\\\\\", \"/\").replace(DRIVE_LETTER_START_RE, (r) => r.toUpperCase());\n};\nconst UNC_REGEX = /^[/\\\\]{2}/;\nconst IS_ABSOLUTE_RE = /^[/\\\\](?![/\\\\])|^[/\\\\]{2}(?!\\.)|^[A-Z]:[/\\\\]/i;\nconst DRIVE_LETTER_RE = /^[A-Z]:$/i;\nconst cwd = () => {\n  if (typeof process.cwd === \"function\") {\n    return process.cwd().replaceAll(\"\\\\\", \"/\");\n  }\n  return \"/\";\n};\nconst normalizeString = (path2, allowAboveRoot) => {\n  let result = \"\";\n  let lastSegmentLength = 0;\n  let lastSlash = -1;\n  let dots = 0;\n  let char;\n  for (let index = 0; index <= path2.length; ++index) {\n    if (index < path2.length) {\n      char = path2[index];\n    } else if (char === \"/\") {\n      break;\n    } else {\n      char = \"/\";\n    }\n    if (char === \"/\") {\n      if (lastSlash === index - 1 || dots === 1) ;\n      else if (dots === 2) {\n        if (result.length < 2 || lastSegmentLength !== 2 || !result.endsWith(\".\") || result.at(-2) !== \".\") {\n          if (result.length > 2) {\n            const lastSlashIndex = result.lastIndexOf(\"/\");\n            if (lastSlashIndex === -1) {\n              result = \"\";\n              lastSegmentLength = 0;\n            } else {\n              result = result.slice(0, lastSlashIndex);\n              lastSegmentLength = result.length - 1 - result.lastIndexOf(\"/\");\n            }\n            lastSlash = index;\n            dots = 0;\n            continue;\n          } else if (result.length > 0) {\n            result = \"\";\n            lastSegmentLength = 0;\n            lastSlash = index;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          result += result.length > 0 ? \"/..\" : \"..\";\n          lastSegmentLength = 2;\n        }\n      } else {\n        if (result.length > 0) {\n          result += `/${path2.slice(lastSlash + 1, index)}`;\n        } else {\n          result = path2.slice(lastSlash + 1, index);\n        }\n        lastSegmentLength = index - lastSlash - 1;\n      }\n      lastSlash = index;\n      dots = 0;\n    } else if (char === \".\" && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return result;\n};\nconst isAbsolute = (path2) => IS_ABSOLUTE_RE.test(path2);\nconst normalize = function(path2) {\n  if (path2.length === 0) {\n    return \".\";\n  }\n  path2 = normalizeWindowsPath(path2);\n  const isUNCPath = UNC_REGEX.exec(path2);\n  const isPathAbsolute = isAbsolute(path2);\n  const trailingSeparator = path2.at(-1) === \"/\";\n  path2 = normalizeString(path2, !isPathAbsolute);\n  if (path2.length === 0) {\n    if (isPathAbsolute) {\n      return \"/\";\n    }\n    return trailingSeparator ? \"./\" : \".\";\n  }\n  if (trailingSeparator) {\n    path2 += \"/\";\n  }\n  if (DRIVE_LETTER_RE.test(path2)) {\n    path2 += \"/\";\n  }\n  if (isUNCPath) {\n    if (!isPathAbsolute) {\n      return `//./${path2}`;\n    }\n    return `//${path2}`;\n  }\n  return isPathAbsolute && !isAbsolute(path2) ? `/${path2}` : path2;\n};\nconst join = (...segments) => {\n  let path2 = \"\";\n  for (const seg of segments) {\n    if (!seg) {\n      continue;\n    }\n    if (path2.length > 0) {\n      const pathTrailing = path2[path2.length - 1] === \"/\";\n      const segLeading = seg[0] === \"/\";\n      const both = pathTrailing && segLeading;\n      if (both) {\n        path2 += seg.slice(1);\n      } else {\n        path2 += pathTrailing || segLeading ? seg : `/${seg}`;\n      }\n    } else {\n      path2 += seg;\n    }\n  }\n  return normalize(path2);\n};\nconst resolve = function(...arguments_) {\n  arguments_ = arguments_.map((argument) => normalizeWindowsPath(argument));\n  let resolvedPath = \"\";\n  let resolvedAbsolute = false;\n  for (let index = arguments_.length - 1; index >= -1 && !resolvedAbsolute; index--) {\n    const path2 = index >= 0 ? arguments_[index] : cwd();\n    if (!path2 || path2.length === 0) {\n      continue;\n    }\n    resolvedPath = `${path2}/${resolvedPath}`;\n    resolvedAbsolute = isAbsolute(path2);\n  }\n  resolvedPath = normalizeString(resolvedPath, !resolvedAbsolute);\n  if (resolvedAbsolute && !isAbsolute(resolvedPath)) {\n    return `/${resolvedPath}`;\n  }\n  return resolvedPath.length > 0 ? resolvedPath : \".\";\n};\nconst dirname = (path2) => {\n  const segments = normalizeWindowsPath(path2).replace(/\\/$/, \"\").split(\"/\").slice(0, -1);\n  if (segments.length === 1 && DRIVE_LETTER_RE.test(segments[0])) {\n    segments[0] += \"/\";\n  }\n  return segments.join(\"/\") || (isAbsolute(path2) ? \"/\" : \".\");\n};\nconst basename = (path2, extension) => {\n  const lastSegment = normalizeWindowsPath(path2).split(\"/\").pop();\n  if (extension && lastSegment.endsWith(extension)) {\n    return lastSegment.slice(0, -extension.length);\n  }\n  return lastSegment;\n};\n\nexport { normalizeWindowsPath as a, basename as b, dirname as d, isAbsolute as i, join as j, normalize as n, resolve as r };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6099, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/is-expired-CTThU1q5.js"],"sourcesContent":["const isExpired = (file) => {\n  if (!file.expiredAt) {\n    return false;\n  }\n  return Date.now() > +new Date(file.expiredAt);\n};\n\nexport { isExpired as i };\n"],"names":[],"mappings":";;;;AAAA,MAAM,YAAY,CAAC;IACjB,IAAI,CAAC,KAAK,SAAS,EAAE;QACnB,OAAO;IACT;IACA,OAAO,KAAK,GAAG,KAAK,CAAC,IAAI,KAAK,KAAK,SAAS;AAC9C"}},
    {"offset": {"line": 6114, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/storage-qBIeShej.js"],"sourcesContent":["import { Readable } from 'node:stream';\nimport { setInterval } from 'node:timers';\nimport { inspect } from 'node:util';\nimport typeis from 'type-is';\nimport NoOpMetrics from './NoOpMetrics-DhAk5rXc.js';\nimport { N as NoOpCache } from './cache-B88MXQ_2.js';\nimport { ErrorMap, throwErrorCode, ERRORS } from './ERRORS-DKaR93nv.js';\nimport { LRUCache } from 'lru-cache';\nimport { a as Validator } from './validator-InvzeyVl.js';\nimport { n as normalize, i as isAbsolute } from './path-CR6YkPXX-7R1-9CMk.js';\nimport { i as isExpired } from './is-expired-CTThU1q5.js';\n\nconst BYTE_SIZES = {\n  iec: [\n    {\n      long: \"Bytes\",\n      short: \"B\"\n    },\n    {\n      long: \"Kibibytes\",\n      short: \"KiB\"\n    },\n    {\n      long: \"Mebibytes\",\n      short: \"MiB\"\n    },\n    {\n      long: \"Gibibytes\",\n      short: \"GiB\"\n    },\n    {\n      long: \"Tebibytes\",\n      short: \"TiB\"\n    },\n    {\n      long: \"Pebibytes\",\n      short: \"PiB\"\n    },\n    {\n      long: \"Exbibytes\",\n      short: \"EiB\"\n    },\n    {\n      long: \"Zebibytes\",\n      short: \"ZiB\"\n    },\n    {\n      long: \"Yobibytes\",\n      short: \"YiB\"\n    }\n  ],\n  iec_octet: [\n    {\n      long: \"Octets\",\n      short: \"o\"\n    },\n    {\n      long: \"Kibioctets\",\n      short: \"Kio\"\n    },\n    {\n      long: \"Mebioctets\",\n      short: \"Mio\"\n    },\n    {\n      long: \"Gibioctets\",\n      short: \"Gio\"\n    },\n    {\n      long: \"Tebioctets\",\n      short: \"Tio\"\n    },\n    {\n      long: \"Pebioctets\",\n      short: \"Pio\"\n    },\n    {\n      long: \"Exbioctets\",\n      short: \"Eio\"\n    },\n    {\n      long: \"Zebioctets\",\n      short: \"Zio\"\n    },\n    {\n      long: \"Yobioctets\",\n      short: \"Yio\"\n    }\n  ],\n  metric: [\n    {\n      long: \"Bytes\",\n      short: \"Bytes\"\n    },\n    {\n      long: \"Kilobytes\",\n      short: \"KB\"\n    },\n    {\n      long: \"Megabytes\",\n      short: \"MB\"\n    },\n    {\n      long: \"Gigabytes\",\n      short: \"GB\"\n    },\n    {\n      long: \"Terabytes\",\n      short: \"TB\"\n    },\n    {\n      long: \"Petabytes\",\n      short: \"PB\"\n    },\n    {\n      long: \"Exabytes\",\n      short: \"EB\"\n    },\n    {\n      long: \"Zettabytes\",\n      short: \"ZB\"\n    },\n    {\n      long: \"Yottabytes\",\n      short: \"YB\"\n    }\n  ],\n  metric_octet: [\n    {\n      long: \"Octets\",\n      short: \"o\"\n    },\n    {\n      long: \"Kilo-octets\",\n      short: \"ko\"\n    },\n    {\n      long: \"Mega-octets\",\n      short: \"Mo\"\n    },\n    {\n      long: \"Giga-octets\",\n      short: \"Go\"\n    },\n    {\n      long: \"Tera-octets\",\n      short: \"To\"\n    },\n    {\n      long: \"Peta-octets\",\n      short: \"Po\"\n    },\n    {\n      long: \"Exa-octets\",\n      short: \"Eo\"\n    },\n    {\n      long: \"Zetta-octets\",\n      short: \"Zo\"\n    },\n    {\n      long: \"Yotta-octets\",\n      short: \"Yo\"\n    }\n  ]\n};\nconst parseLocalizedNumber = (stringNumber, locale) => {\n  const thousandSeparator = new Intl.NumberFormat(locale).format(11111).replaceAll(new RegExp(\"\\\\p{Number}\", \"gu\"), \"\");\n  const decimalSeparator = new Intl.NumberFormat(locale).format(1.1).replaceAll(new RegExp(\"\\\\p{Number}\", \"gu\"), \"\");\n  return Number.parseFloat(stringNumber.replaceAll(new RegExp(`\\\\${thousandSeparator}`, \"g\"), \"\").replace(new RegExp(`\\\\${decimalSeparator}`), \".\"));\n};\nconst fromBase = (base) => {\n  if (base === 2) {\n    return 1024;\n  }\n  if (base === 10) {\n    return 1e3;\n  }\n  throw new TypeError(`Unsupported base.`);\n};\nconst parseBytes = (value, options) => {\n  const config = {\n    base: 2,\n    locale: \"en-US\",\n    units: \"metric\",\n    ...options\n  };\n  if (typeof value !== \"string\" || value.length === 0) {\n    throw new TypeError(\"Value is not a string or is empty.\");\n  }\n  if (value.length > 100) {\n    throw new TypeError(\"Value exceeds the maximum length of 100 characters.\");\n  }\n  const match = /^(?<value>-?(?:\\d+(([.,])\\d+)*)?[.,]?\\d+) *(?<type>bytes?|b|kb|kib|mb|mib|gb|gib|tb|tib|pb|pib|eb|eib|zb|zib|yb|yib|(kilo|kibi|mega|mebi|giga|gibi|tera|tebi|peta|pebi|exa|exbi|zetta|zebi|yotta|yobi)?bytes)?$/i.exec(\n    value\n  );\n  const groups = match?.groups;\n  if (!groups) {\n    return Number.NaN;\n  }\n  const localizedNumber = parseLocalizedNumber(groups.value, config.locale);\n  const type = (groups.type ?? \"Bytes\").toUpperCase().replace(/^KIBI/, \"KILO\").replace(/^MIBI/, \"MEGA\").replace(/^GIBI/, \"GIGA\").replace(/^TEBI/, \"TERA\").replace(/^PEBI/, \"PETA\").replace(/^EXBI/, \"EXA\").replace(/^ZEBI/, \"ZETTA\").replace(/^YIBI/, \"YOTTA\").replace(/^(.)IB$/, \"$1B\");\n  const level = BYTE_SIZES[config.units].findIndex((unit) => unit.short[0].toUpperCase() === type[0]);\n  const base = fromBase(config.base);\n  return localizedNumber * base ** level;\n};\n\nconst createDurationLanguage = (y, mo, w, d, h, m, s, ms, future, past, decimal, unitMap, groupSeparator, placeholderSeparator) => {\n  const result = {\n    d,\n    h,\n    m,\n    mo,\n    ms,\n    s,\n    w,\n    y\n  };\n  {\n    result.future = future;\n  }\n  {\n    result.past = past;\n  }\n  {\n    result.decimal = decimal;\n  }\n  if (unitMap !== void 0) {\n    result.unitMap = unitMap;\n  }\n  {\n    result.groupSeparator = groupSeparator;\n  }\n  {\n    result.placeholderSeparator = placeholderSeparator;\n  }\n  return result;\n};\n\nconst englishUnitMap = {\n  d: \"d\",\n  day: \"d\",\n  days: \"d\",\n  h: \"h\",\n  hour: \"h\",\n  hours: \"h\",\n  hr: \"h\",\n  hrs: \"h\",\n  m: \"m\",\n  millisecond: \"ms\",\n  milliseconds: \"ms\",\n  min: \"m\",\n  mins: \"m\",\n  minute: \"m\",\n  minutes: \"m\",\n  mo: \"mo\",\n  month: \"mo\",\n  months: \"mo\",\n  ms: \"ms\",\n  s: \"s\",\n  sec: \"s\",\n  second: \"s\",\n  seconds: \"s\",\n  secs: \"s\",\n  w: \"w\",\n  week: \"w\",\n  weeks: \"w\",\n  y: \"y\",\n  year: \"y\",\n  years: \"y\",\n  yr: \"y\",\n  yrs: \"y\"\n};\nconst durationLanguage = createDurationLanguage(\n  (counter) => `year${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `month${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `week${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `day${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `hour${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `minute${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `second${counter === 1 ? \"\" : \"s\"}`,\n  (counter) => `millisecond${counter === 1 ? \"\" : \"s\"}`,\n  \"in %s\",\n  \"%s ago\",\n  \".\",\n  // decimal\n  englishUnitMap,\n  \",\",\n  // groupSeparator\n  \"_\"\n  // placeholderSeparator\n);\n\nconst validateDurationLanguage = (language) => {\n  const requiredProperties = [\"y\", \"mo\", \"w\", \"d\", \"h\", \"m\", \"s\", \"ms\", \"future\", \"past\"];\n  for (const property of requiredProperties) {\n    if (!Object.prototype.hasOwnProperty.call(language, property)) {\n      throw new TypeError(`Missing required property: ${property}`);\n    }\n  }\n  if (typeof language.future !== \"string\" || typeof language.past !== \"string\") {\n    throw new TypeError(\"Properties future and past must be of type string\");\n  }\n  for (const property of [\"y\", \"mo\", \"w\", \"d\", \"h\", \"m\", \"s\", \"ms\"]) {\n    if (typeof language[property] !== \"string\" && typeof language[property] !== \"function\") {\n      throw new TypeError(`Property ${property} must be of type string or function`);\n    }\n  }\n  if (language.decimal && typeof language.decimal !== \"string\") {\n    throw new TypeError(\"Property decimal must be of type string\");\n  }\n  if (language.delimiter && typeof language.delimiter !== \"string\") {\n    throw new TypeError(\"Property delimiter must be of type string\");\n  }\n  if (language._digitReplacements && !Array.isArray(language._digitReplacements)) {\n    throw new TypeError(\"Property _digitReplacements must be an array\");\n  }\n  if (language._numberFirst && typeof language._numberFirst !== \"boolean\") {\n    throw new TypeError(\"Property _numberFirst must be of type boolean\");\n  }\n  if (language.unitMap && typeof language.unitMap !== \"object\") {\n    throw new TypeError(\"Property unitMap must be an object\");\n  }\n  if (language.unitMap && Object.values(language.unitMap).some((value) => typeof value !== \"string\")) {\n    throw new TypeError(\"All values in unitMap must be of type string\");\n  }\n};\n\nconst STANDARD_UNIT_MEASURES = {\n  d: 864e5,\n  h: 36e5,\n  m: 6e4,\n  mo: 2629746e3,\n  ms: 1,\n  s: 1e3,\n  w: 6048e5,\n  y: 31556952e3\n};\nconst ESCAPE_REGEX = /[-/\\\\^$*+?.()|[\\]{}]/g;\nconst ISO_FORMAT = /^PT(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+)S)?$/i;\nconst COLON_FORMAT = /^(?:(\\d+):)?(?:(\\d+):)?(\\d+)$/;\nconst NUMERIC_STRING_REGEX = /^[+-]?\\d+(?:\\.\\d+)?$/;\nconst parseDuration = (value, options) => {\n  if (typeof value !== \"string\" || value.length === 0) {\n    return void 0;\n  }\n  const { defaultUnit = \"ms\", language = durationLanguage } = {};\n  validateDurationLanguage(language);\n  const decimalSeparator = language.decimal ?? \".\";\n  const groupSeparator = language.groupSeparator ?? \",\";\n  const placeholderSeparator = language.placeholderSeparator ?? \"_\";\n  const escapedDecimal = decimalSeparator.replaceAll(ESCAPE_REGEX, String.raw`\\$&`);\n  const escapedGroup = groupSeparator.replaceAll(ESCAPE_REGEX, String.raw`\\$&`);\n  const escapedPlaceholder = placeholderSeparator.replaceAll(ESCAPE_REGEX, String.raw`\\$&`);\n  const currentUnitMap = language.unitMap ?? englishUnitMap;\n  let processedValue = value.replaceAll(new RegExp(`(\\\\d)[${escapedPlaceholder}${escapedGroup}](\\\\d)`, \"g\"), \"$1$2\");\n  if (decimalSeparator !== \".\") {\n    processedValue = processedValue.replace(escapedDecimal, \".\");\n  }\n  if (NUMERIC_STRING_REGEX.test(value)) {\n    const numberOnly = Number.parseFloat(processedValue.trim());\n    if (!Number.isNaN(numberOnly)) {\n      const unitKey = currentUnitMap[defaultUnit];\n      if (unitKey !== void 0) {\n        return numberOnly * STANDARD_UNIT_MEASURES[unitKey];\n      }\n    }\n    return void 0;\n  }\n  const isoMatch = ISO_FORMAT.exec(value);\n  if (isoMatch) {\n    const hours = Number.parseInt(isoMatch[1] ?? \"0\", 10);\n    const minutes = Number.parseInt(isoMatch[2] ?? \"0\", 10);\n    const seconds = Number.parseInt(isoMatch[3] ?? \"0\", 10);\n    return hours * 36e5 + minutes * 6e4 + seconds * 1e3;\n  }\n  const colonMatch = COLON_FORMAT.exec(value);\n  if (colonMatch) {\n    let hours = 0;\n    let minutes = 0;\n    let seconds = 0;\n    if (colonMatch[2] !== void 0) {\n      hours = Number.parseInt(colonMatch[1] ?? \"0\", 10);\n      minutes = Number.parseInt(colonMatch[2], 10);\n    } else if (colonMatch[1] !== void 0) {\n      minutes = Number.parseInt(colonMatch[1], 10);\n    }\n    seconds = Number.parseInt(colonMatch[3] ?? \"0\", 10);\n    return hours * 36e5 + minutes * 6e4 + seconds * 1e3;\n  }\n  const currentUnitMapKeys = Object.keys(currentUnitMap);\n  const regexKeys = currentUnitMapKeys.toSorted((a, b) => b.length - a.length).map((k) => k.replaceAll(ESCAPE_REGEX, String.raw`\\$&`)).join(\"|\");\n  const durationRegex = new RegExp(`(-?\\\\d*\\\\.?\\\\d+)\\\\s*(${regexKeys})`, \"gi\");\n  let totalMs = 0;\n  let match;\n  let unitsFound = false;\n  let firstMatchIndex = -1;\n  let lastMatchEndIndex = 0;\n  durationRegex.lastIndex = 0;\n  while ((match = durationRegex.exec(processedValue)) !== null) {\n    if (!unitsFound) {\n      firstMatchIndex = match.index;\n    }\n    unitsFound = true;\n    const numberString = match[1];\n    const unitString = match[2];\n    if (!numberString || !unitString) {\n      continue;\n    }\n    const trimmedNumberString = numberString.trim();\n    const sign = trimmedNumberString.startsWith(\"-\") ? -1 : 1;\n    const absNumberString = trimmedNumberString.replace(/^[-+]/, \"\");\n    const parsedNumber = Number.parseFloat(absNumberString);\n    const unitKey = currentUnitMap[unitString.toLowerCase()];\n    if (unitKey === void 0) {\n      continue;\n    }\n    const unitValue = STANDARD_UNIT_MEASURES[unitKey];\n    if (Number.isNaN(parsedNumber)) {\n      return void 0;\n    }\n    totalMs += sign * parsedNumber * unitValue;\n    lastMatchEndIndex = durationRegex.lastIndex;\n  }\n  const leadingText = processedValue.slice(0, firstMatchIndex).trim();\n  const trailingText = processedValue.slice(lastMatchEndIndex).trim();\n  if (unitsFound && (leadingText.length > 0 || trailingText.length > 0)) {\n    return void 0;\n  }\n  if (!unitsFound) {\n    return void 0;\n  }\n  return totalMs;\n};\n\nconst toMilliseconds = (value) => {\n  if (value === Number(value)) {\n    return value;\n  }\n  if (!value) {\n    return void 0;\n  }\n  const parsed = parseDuration(value);\n  if (parsed === void 0) {\n    return void 0;\n  }\n  return parsed;\n};\n\nclass Locker extends LRUCache {\n  /**\n   * Creates a new Locker instance with configurable TTL and cache options.\n   * @param options LRU cache configuration options\n   */\n  constructor(options) {\n    super({\n      ttl: 1e3,\n      ttlAutopurge: true,\n      ...options\n    });\n  }\n  /**\n   * Acquires a lock for the specified key.\n   * Throws an error if the key is already locked.\n   * @param key The key to lock\n   * @returns The lock token (same as the key)\n   * @throws Error if the key is already locked\n   */\n  lock(key) {\n    const locked = this.get(key);\n    if (locked) {\n      throw new Error(`${key} is locked`);\n    }\n    this.set(key, key);\n    return key;\n  }\n  /**\n   * Releases the lock for the specified key.\n   * @param key The key to unlock\n   */\n  unlock(key) {\n    this.delete(key);\n  }\n}\n\nconst extractOriginalName = (meta) => {\n  if (typeof meta.name === \"string\") {\n    return meta.name;\n  }\n  if (typeof meta.title === \"string\") {\n    return meta.title;\n  }\n  if (typeof meta.originalName === \"string\") {\n    return meta.originalName;\n  }\n  if (typeof meta.filename === \"string\") {\n    return meta.filename;\n  }\n  return void 0;\n};\nconst deepMerge = (target, source) => {\n  const result = { ...target };\n  Object.keys(source).forEach((key) => {\n    const sourceValue = source[key];\n    if (sourceValue !== null && typeof sourceValue === \"object\" && !Array.isArray(sourceValue)) {\n      const targetValue = result[key];\n      const targetObject = targetValue && typeof targetValue === \"object\" && !Array.isArray(targetValue) ? targetValue : {};\n      result[key] = deepMerge(targetObject, sourceValue);\n    } else {\n      result[key] = sourceValue;\n    }\n  });\n  return result;\n};\nconst updateMetadata = (file, metadata) => {\n  const merged = deepMerge(file, metadata);\n  Object.assign(file, merged);\n  file.originalName = extractOriginalName(file.metadata) || file.originalName;\n};\n\nconst defaults = {\n  allowMIME: [\"*/*\"],\n  filename: ({ id }) => id,\n  maxMetadataSize: \"8MB\",\n  maxUploadSize: \"5TB\",\n  onComplete: () => {\n  },\n  onCreate: () => {\n  },\n  onDelete: () => {\n  },\n  onError: () => {\n  },\n  onUpdate: () => {\n  },\n  useRelativeLocation: false,\n  validation: {}\n};\nconst defaultCloudStorageFileNameValidation = (name) => {\n  if (!name || name.length < 3 || name.length > 255 || isAbsolute(name)) {\n    return false;\n  }\n  const upperCase = name.toUpperCase();\n  return !(upperCase.includes(\"../\") || name.includes(\"\\0\"));\n};\nconst defaultFilesystemFileNameValidation = (name) => {\n  if (!name || name.length < 3 || name.length > 255 || isAbsolute(name)) {\n    return false;\n  }\n  const upperCase = name.toUpperCase();\n  const filesystemInvalidChars = ['\"', \"*\", \":\", \"<\", \">\", \"?\", \"\\\\\", \"|\", \"../\", \"\\0\"];\n  return !filesystemInvalidChars.some((char) => upperCase.includes(char));\n};\nclass BaseStorage {\n  /**\n   * Hook called when a new file is created.\n   * @param file The newly created file object.\n   * @remarks This hook is called after file metadata is saved but before returning the file.\n   * Can be used for side effects like logging, notifications, or custom processing.\n   */\n  onCreate;\n  /**\n   * Hook called when file metadata is updated.\n   * @param file The updated file object.\n   * @remarks This hook is called after metadata is updated and saved.\n   * Can be used for side effects like logging or custom processing.\n   */\n  onUpdate;\n  /**\n   * Hook called when a file upload is completed.\n   * @param file The completed file object.\n   * @param response The response object that can be modified in place (headers, statusCode, body).\n   * @param request Optional request object for additional context.\n   * @remarks This hook is called when file status becomes \"completed\".\n   * The response object can be modified directly to add headers or change the status code.\n   */\n  onComplete;\n  /**\n   * Hook called when a file is deleted.\n   * @param file The deleted file object.\n   * @remarks This hook is called after the file is deleted but before returning.\n   * Can be used for side effects like cleanup or logging.\n   */\n  onDelete;\n  /**\n   * Hook called when an error occurs during storage operations.\n   * @param error The HTTP error object that can be modified in place.\n   * @remarks This hook allows customizing error responses by modifying the error object.\n   * The error object can be modified to change headers, statusCode, or body properties.\n   * Error formatting happens in handlers after this hook is called.\n   */\n  onError;\n  isReady = true;\n  errorResponses = {};\n  cache;\n  logger;\n  metrics;\n  genericConfig;\n  maxMetadataSize;\n  checksumTypes = [];\n  maxUploadSize;\n  expiration;\n  locker;\n  namingFunction;\n  validation = new Validator();\n  assetFolder = void 0;\n  /**\n   * Limits the number of concurrent upload requests\n   */\n  concurrency;\n  constructor(config) {\n    const options = { ...defaults, ...config };\n    this.onCreate = options.onCreate;\n    this.onUpdate = options.onUpdate;\n    this.onComplete = options.onComplete;\n    this.onDelete = options.onDelete;\n    this.onError = options.onError;\n    this.namingFunction = options.filename;\n    this.maxUploadSize = typeof options.maxUploadSize === \"string\" ? parseBytes(options.maxUploadSize) : options.maxUploadSize;\n    this.maxMetadataSize = typeof options.maxMetadataSize === \"string\" ? parseBytes(options.maxMetadataSize) : options.maxMetadataSize;\n    this.expiration = options.expiration;\n    this.genericConfig = options;\n    if (options.assetFolder !== void 0) {\n      this.assetFolder = normalize(options.assetFolder);\n    }\n    this.locker = new Locker({\n      max: 1e3,\n      ttl: 3e4,\n      ttlAutopurge: true\n    });\n    this.cache = options.cache ?? new NoOpCache();\n    this.logger = options.logger;\n    this.metrics = options.metrics ?? new NoOpMetrics();\n    this.logger?.debug(`${this.constructor.name} config: ${inspect({ ...config, logger: this.logger.constructor })}`);\n    const purgeInterval = toMilliseconds(options.expiration?.purgeInterval);\n    if (purgeInterval) {\n      this.startAutoPurge(purgeInterval);\n    }\n    const size = {\n      isValid(file) {\n        if (file.size === void 0) {\n          return true;\n        }\n        const fileSize = Number(file.size);\n        if (fileSize < 0) {\n          return false;\n        }\n        return fileSize <= this.value;\n      },\n      response: ErrorMap.RequestEntityTooLarge,\n      value: this.maxUploadSize\n    };\n    const mime = {\n      isValid(file) {\n        return !!typeis.is(file.contentType, this.value);\n      },\n      // @TODO: add better error handling for mime types\n      response: ErrorMap.UnsupportedMediaType,\n      value: options.allowMIME\n    };\n    const fileNameValidation = options.fileNameValidation ?? defaultCloudStorageFileNameValidation;\n    const filename = {\n      isValid(file) {\n        return fileNameValidation(file.name);\n      },\n      response: ErrorMap.InvalidFileName\n    };\n    this.validation.add({ filename, mime, size });\n    this.validation.add({ ...options.validation });\n  }\n  get tusExtension() {\n    const extensions = [\"creation\", \"creation-with-upload\", \"termination\", \"checksum\", \"creation-defer-length\", \"concatenation\"];\n    if (this.expiration) {\n      extensions.push(\"expiration\");\n    }\n    return extensions;\n  }\n  /**\n   * Validates a file against configured validation rules.\n   * @param file File object to validate.\n   * @returns Promise resolving to undefined if file is valid, throws ValidationError otherwise.\n   * @throws {ValidationError} If validation fails\n   */\n  async validate(file) {\n    await this.validation.verify(file);\n  }\n  /**\n   * Checks if a file exists by querying its metadata.\n   * @param query File query containing the file ID to check.\n   * @param query.id File ID to check.\n   * @returns Promise resolving to true if file exists, false otherwise.\n   * @remarks This method does not throw errors - it returns false if the file is not found.\n   */\n  async exists(query) {\n    return this.instrumentOperation(\"exists\", async () => {\n      try {\n        await this.getMeta(query.id);\n        return true;\n      } catch {\n        return false;\n      }\n    });\n  }\n  /**\n   * Normalizes errors with storage-specific context.\n   * @param error The error to normalize.\n   * @returns Normalized HTTP error with storage class context added to the message.\n   * @remarks Errors are enhanced with the storage class name for better debugging.\n   */\n  normalizeError(error) {\n    const baseError = {\n      code: error.name,\n      message: error.message,\n      name: error.name,\n      statusCode: 500\n    };\n    return {\n      ...baseError,\n      message: `[${this.constructor.name}] ${baseError.message}`\n    };\n  }\n  /**\n   * Gets the storage configuration.\n   * @returns The current storage configuration options.\n   */\n  get config() {\n    return this.genericConfig;\n  }\n  /**\n   * Saves upload metadata to the metadata storage.\n   * @param file File object containing metadata to save.\n   * @returns Promise resolving to the saved file object.\n   * @remarks Updates timestamps and caches the file metadata.\n   */\n  async saveMeta(file) {\n    this.updateTimestamps(file);\n    this.cache.set(file.id, file);\n    return this.meta.save(file.id, file);\n  }\n  /**\n   * Deletes upload metadata from the metadata storage.\n   * @param id File ID whose metadata should be deleted.\n   * @returns Promise resolving when metadata is deleted.\n   * @remarks Also removes the file from the cache.\n   */\n  async deleteMeta(id) {\n    this.cache.delete(id);\n    return this.meta.delete(id);\n  }\n  /**\n   * Retrieves upload metadata by file ID.\n   * @param id File ID to retrieve metadata for.\n   * @returns Promise resolving to the file metadata object.\n   * @throws {UploadError} If the file metadata cannot be found (ERRORS.FILE_NOT_FOUND).\n   * @remarks Caches the retrieved metadata for faster subsequent access.\n   */\n  async getMeta(id) {\n    try {\n      const file = await this.meta.get(id);\n      this.cache.set(file.id, file);\n      return { ...file };\n    } catch {\n      return throwErrorCode(ERRORS.FILE_NOT_FOUND);\n    }\n  }\n  /**\n   * Checks if a file has expired and deletes it if so.\n   * @param file File object to check for expiration.\n   * @returns Promise resolving to the file object if not expired.\n   * @throws {UploadError} If the file has expired (ERRORS.GONE).\n   * @remarks If the file is expired, it is automatically deleted and the metadata is removed.\n   */\n  async checkIfExpired(file) {\n    if (isExpired(file)) {\n      void this.delete(file).catch(() => void 0);\n      void this.deleteMeta(file.id).catch(() => void 0);\n      return throwErrorCode(ERRORS.GONE);\n    }\n    return file;\n  }\n  /**\n   * Searches for and purges expired uploads.\n   * @param maxAge Maximum age of files to keep (files older than this will be purged).\n   * Can be a number (milliseconds) or string (e.g., \"1h\", \"30m\", \"7d\").\n   * If not provided, uses the expiration.maxAge from configuration.\n   * @returns Promise resolving to a list of purged files.\n   * @remarks\n   * Errors during individual file deletions are logged but do not stop the purge process.\n   * Files with corrupted metadata are skipped with a warning.\n   * Uses rolling expiration if configured (based on modifiedAt) or fixed expiration (based on createdAt).\n   */\n  async purge(maxAge) {\n    return this.instrumentOperation(\"purge\", async () => {\n      const maxAgeMs = toMilliseconds(maxAge || this.expiration?.maxAge);\n      const purged = { items: [], maxAgeMs };\n      if (maxAgeMs) {\n        const before = Date.now() - maxAgeMs;\n        const list = await this.list();\n        const expired = list.filter(\n          (item) => Number(new Date(this.expiration?.rolling ? item.modifiedAt || item.createdAt : item.createdAt)) < before\n        );\n        for await (const { id, ...rest } of expired) {\n          try {\n            const deleted = await this.delete({ id });\n            purged.items.push({ ...deleted, ...rest });\n          } catch (error) {\n            this.logger?.warn(`Failed to delete file ${id} during purge: ${error instanceof Error ? error.message : String(error)}`);\n          }\n        }\n        if (purged.items.length > 0) {\n          this.logger?.info(`Purge: removed ${purged.items.length} uploads`);\n          this.metrics.gauge(\"storage.operations.purge.items_count\", purged.items.length, {\n            storage: this.constructor.name.toLowerCase().replace(\"storage\", \"\")\n          });\n        }\n      }\n      return purged;\n    });\n  }\n  /**\n   * Gets an uploaded file as a readable stream for efficient large file handling.\n   * @param query File query containing the file ID to stream.\n   * @param query.id File ID to stream.\n   * @returns Promise resolving to an object containing the stream, headers, and size.\n   * @throws {UploadError} If the file cannot be found (ERRORS.FILE_NOT_FOUND) or has expired (ERRORS.GONE).\n   * @remarks\n   * Default implementation falls back to get() and creates a stream from the buffer.\n   * Storage implementations should override this for better streaming performance.\n   * Headers include Content-Type, Content-Length, ETag, and Last-Modified.\n   */\n  async getStream({ id }) {\n    return this.instrumentOperation(\"getStream\", async () => {\n      const file = await this.get({ id });\n      const stream = Readable.from(file.content);\n      return {\n        headers: {\n          \"Content-Length\": String(file.size),\n          \"Content-Type\": file.contentType,\n          ...file.ETag && { ETag: file.ETag },\n          ...file.modifiedAt && { \"Last-Modified\": file.modifiedAt.toString() }\n        },\n        size: typeof file.size === \"number\" ? file.size : void 0,\n        stream\n      };\n    });\n  }\n  /**\n   * Retrieves a list of uploaded files.\n   * @param _limit Maximum number of files to return (default: 1000).\n   * @returns Promise resolving to an array of file metadata objects.\n   * @throws {Error} If not implemented by the storage backend.\n   * @remarks Storage implementations must override this method.\n   */\n  async list(_limit = 1e3) {\n    return this.instrumentOperation(\"list\", async () => {\n      throw new Error(\"Not implemented\");\n    });\n  }\n  /**\n   * Updates file metadata with user-provided key-value pairs.\n   * @param query File query containing the file ID to update.\n   * @param query.id File ID to update.\n   * @param metadata Partial file object containing fields to update.\n   * @returns Promise resolving to the updated file object.\n   * @throws {UploadError} If the file cannot be found (ERRORS.FILE_NOT_FOUND).\n   * @remarks\n   * Supports TTL (time-to-live) option: if metadata contains a 'ttl' field,\n   * it will be converted to an 'expiredAt' timestamp.\n   * TTL can be a number (milliseconds) or string (e.g., \"1h\", \"30m\", \"7d\").\n   */\n  async update({ id }, metadata) {\n    return this.instrumentOperation(\"update\", async () => {\n      const file = await this.getMeta(id);\n      const processedMetadata = { ...metadata };\n      if (\"ttl\" in processedMetadata && processedMetadata.ttl !== void 0) {\n        const ttlValue = processedMetadata.ttl;\n        const ttlMs = typeof ttlValue === \"string\" ? toMilliseconds(ttlValue) : ttlValue;\n        if (ttlMs !== void 0) {\n          processedMetadata.expiredAt = Date.now() + ttlMs;\n        }\n        delete processedMetadata.ttl;\n      }\n      updateMetadata(file, processedMetadata);\n      await this.saveMeta(file);\n      const updatedFile = { ...file, status: \"updated\" };\n      await this.onUpdate(updatedFile);\n      return updatedFile;\n    });\n  }\n  /**\n   * Deletes multiple files in a single batch operation.\n   * @param ids Array of file IDs to delete.\n   * @returns Promise resolving to batch operation response with successful and failed deletions.\n   * @remarks\n   * Processes all deletions in parallel using Promise.allSettled.\n   * Individual failures do not stop the batch operation.\n   * Each deletion is wrapped in error handling to capture failures.\n   * Metrics are recorded for the batch operation and individual failures.\n   * Returns both successful and failed operations with detailed error information.\n   */\n  async deleteBatch(ids) {\n    const startTime = Date.now();\n    const storageType = this.constructor.name.toLowerCase().replace(\"storage\", \"\");\n    this.metrics.increment(\"storage.operations.batch.delete.count\", 1, {\n      batch_size: ids.length,\n      storage: storageType\n    });\n    const successful = [];\n    const failed = [];\n    const deletePromises = ids.map(async (id) => {\n      try {\n        const file = await this.delete({ id });\n        return { file, id, success: true };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : \"Delete failed\";\n        this.metrics.increment(\"storage.operations.delete.error.count\", 1, {\n          error: errorMessage,\n          storage: storageType\n        });\n        return { error: errorMessage, id, success: false };\n      }\n    });\n    const results = await Promise.allSettled(deletePromises);\n    for (const result of results) {\n      if (result.status === \"fulfilled\") {\n        if (result.value.success) {\n          successful.push(result.value.file);\n        } else {\n          failed.push({ error: result.value.error, id: result.value.id });\n        }\n      } else {\n        failed.push({ error: result.reason?.message || \"Delete failed\", id: \"\" });\n      }\n    }\n    const duration = Date.now() - startTime;\n    this.metrics.timing(\"storage.operations.batch.delete.duration\", duration, {\n      batch_size: ids.length,\n      storage: storageType\n    });\n    this.metrics.gauge(\"storage.operations.batch.delete.success_count\", successful.length, {\n      storage: storageType\n    });\n    this.metrics.gauge(\"storage.operations.batch.delete.failed_count\", failed.length, {\n      storage: storageType\n    });\n    return {\n      failed,\n      failedCount: failed.length,\n      successful,\n      successfulCount: successful.length\n    };\n  }\n  /**\n   * Copies multiple files in a single batch operation.\n   * @param operations Array of copy operations, each containing:\n   * source: Source file ID.\n   * destination: Destination file ID or path.\n   * options: Optional copy options including storage class.\n   * @returns Promise resolving to batch operation response with successful and failed copies.\n   * @remarks\n   * Processes all copies in parallel using Promise.allSettled.\n   * Individual failures do not stop the batch operation.\n   * Each copy operation is wrapped in error handling to capture failures.\n   * Metrics are recorded for the batch operation and individual failures.\n   * Returns both successful and failed operations with detailed error information.\n   */\n  async copyBatch(operations) {\n    const startTime = Date.now();\n    const storageType = this.constructor.name.toLowerCase().replace(\"storage\", \"\");\n    this.metrics.increment(\"storage.operations.batch.copy.count\", 1, {\n      batch_size: operations.length,\n      storage: storageType\n    });\n    const successful = [];\n    const failed = [];\n    const copyPromises = operations.map(async ({ destination, options, source }) => {\n      try {\n        const copiedFile = await this.copy(source, destination, options);\n        return { file: copiedFile, id: destination, success: true };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : \"Copy failed\";\n        this.metrics.increment(\"storage.operations.copy.error.count\", 1, {\n          error: errorMessage,\n          storage: storageType\n        });\n        return { error: errorMessage, id: destination, success: false };\n      }\n    });\n    const results = await Promise.allSettled(copyPromises);\n    for (const result of results) {\n      if (result.status === \"fulfilled\") {\n        if (result.value.success && result.value.file) {\n          successful.push(result.value.file);\n        } else {\n          failed.push({ error: result.value.error || \"Copy failed\", id: result.value.id });\n        }\n      } else {\n        failed.push({ error: result.reason?.message || \"Copy failed\", id: \"\" });\n      }\n    }\n    const duration = Date.now() - startTime;\n    this.metrics.timing(\"storage.operations.batch.copy.duration\", duration, {\n      batch_size: operations.length,\n      storage: storageType\n    });\n    this.metrics.gauge(\"storage.operations.batch.copy.success_count\", successful.length, {\n      storage: storageType\n    });\n    this.metrics.gauge(\"storage.operations.batch.copy.failed_count\", failed.length, {\n      storage: storageType\n    });\n    return {\n      failed,\n      failedCount: failed.length,\n      successful,\n      successfulCount: successful.length\n    };\n  }\n  /**\n   * Moves multiple files in a single batch operation.\n   * @param operations Array of move operations, each containing:\n   * source: Source file ID.\n   * destination: Destination file ID or path.\n   * @returns Promise resolving to batch operation response with successful and failed moves.\n   * @remarks\n   * Processes all moves in parallel using Promise.allSettled.\n   * Individual failures do not stop the batch operation.\n   * Each move operation is wrapped in error handling to capture failures.\n   * Metrics are recorded for the batch operation and individual failures.\n   * Returns both successful and failed operations with detailed error information.\n   */\n  async moveBatch(operations) {\n    const startTime = Date.now();\n    const storageType = this.constructor.name.toLowerCase().replace(\"storage\", \"\");\n    this.metrics.increment(\"storage.operations.batch.move.count\", 1, {\n      batch_size: operations.length,\n      storage: storageType\n    });\n    const successful = [];\n    const failed = [];\n    const movePromises = operations.map(async ({ destination, source }) => {\n      try {\n        const movedFile = await this.move(source, destination);\n        return { file: movedFile, id: destination, success: true };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : \"Move failed\";\n        this.metrics.increment(\"storage.operations.move.error.count\", 1, {\n          error: errorMessage,\n          storage: storageType\n        });\n        return { error: errorMessage, id: destination, success: false };\n      }\n    });\n    const results = await Promise.allSettled(movePromises);\n    for (const result of results) {\n      if (result.status === \"fulfilled\") {\n        if (result.value.success && result.value.file) {\n          successful.push(result.value.file);\n        } else {\n          failed.push({ error: result.value.error || \"Move failed\", id: result.value.id });\n        }\n      } else {\n        failed.push({ error: result.reason?.message || \"Move failed\", id: result.reason?.id || \"\" });\n      }\n    }\n    const duration = Date.now() - startTime;\n    this.metrics.timing(\"storage.operations.batch.move.duration\", duration, {\n      batch_size: operations.length,\n      storage: storageType\n    });\n    this.metrics.gauge(\"storage.operations.batch.move.success_count\", successful.length, {\n      storage: storageType\n    });\n    this.metrics.gauge(\"storage.operations.batch.move.failed_count\", failed.length, {\n      storage: storageType\n    });\n    return {\n      failed,\n      failedCount: failed.length,\n      successful,\n      successfulCount: successful.length\n    };\n  }\n  /**\n   * Prevent upload from being accessed by multiple requests\n   */\n  async lock(key) {\n    const activeUploads = [...this.locker.keys()];\n    if (activeUploads.includes(key)) {\n      return throwErrorCode(ERRORS.FILE_LOCKED);\n    }\n    if (this.config.concurrency && typeof this.config.concurrency === \"number\" && this.config.concurrency < activeUploads.length) {\n      return throwErrorCode(ERRORS.STORAGE_BUSY);\n    }\n    this.locker.set(key, key);\n    return key;\n  }\n  async unlock(key) {\n    this.locker.unlock(key);\n  }\n  isUnsupportedChecksum(algorithm = \"\") {\n    return !!algorithm && !this.checksumTypes.includes(algorithm);\n  }\n  startAutoPurge(purgeInterval) {\n    if (purgeInterval >= 2147483647) {\n      throw new Error(\"purgeInterval must be less than 2147483647 ms\");\n    }\n    setInterval(() => void this.purge().catch((error) => this.logger?.error(error)), purgeInterval);\n  }\n  updateTimestamps(file) {\n    file.createdAt ??= (/* @__PURE__ */ new Date()).toISOString();\n    const maxAgeMs = toMilliseconds(this.expiration?.maxAge);\n    if (maxAgeMs && !file.expiredAt) {\n      file.expiredAt = this.expiration?.rolling ? Date.now() + maxAgeMs : +new Date(file.createdAt) + maxAgeMs;\n    }\n    return file;\n  }\n  /**\n   * Instruments a storage operation with metrics and error tracking.\n   * @param operation Operation name (e.g., \"create\", \"delete\", \"copy\").\n   * @param function_ The operation function to execute.\n   * @param attributes Additional attributes to include in metrics.\n   * @returns Promise resolving to the operation result.\n   * @throws Re-throws any errors from the operation function.\n   * @remarks\n   * Records operation count, duration, and error metrics.\n   * Tracks file sizes for operations returning file objects.\n   * Error metrics include error messages for debugging.\n   * All public methods should use this wrapper for consistent instrumentation.\n   */\n  async instrumentOperation(operation, function_, attributes) {\n    const startTime = Date.now();\n    const storageType = this.constructor.name.toLowerCase().replace(\"storage\", \"\");\n    const baseAttributes = {\n      storage: storageType,\n      ...attributes\n    };\n    try {\n      this.metrics.increment(`storage.operations.${operation}.count`, 1, baseAttributes);\n      const result = await function_();\n      const duration = Date.now() - startTime;\n      this.metrics.timing(`storage.operations.${operation}.duration`, duration, baseAttributes);\n      if (result && typeof result === \"object\" && \"size\" in result && typeof result.size === \"number\") {\n        this.metrics.gauge(\"storage.files.size\", result.size, {\n          ...baseAttributes,\n          operation\n        });\n      }\n      return result;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n      this.metrics.timing(`storage.operations.${operation}.duration`, duration, {\n        ...baseAttributes,\n        error: \"true\"\n      });\n      this.metrics.increment(`storage.operations.${operation}.error.count`, 1, {\n        ...baseAttributes,\n        error: errorMessage\n      });\n      throw error;\n    }\n  }\n}\n\nexport { BaseStorage as B, defaultFilesystemFileNameValidation as a, parseBytes as b, defaultCloudStorageFileNameValidation as d, parseDuration as p, toMilliseconds as t };\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAEA,MAAM,aAAa;IACjB,KAAK;QACH;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;KACD;IACD,WAAW;QACT;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;KACD;IACD,QAAQ;QACN;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;KACD;IACD,cAAc;QACZ;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT;QACA;YACE,MAAM;YACN,OAAO;QACT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"}},
    {"offset": {"line": 7375, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/MetaStorage-pECeFOad.js"],"sourcesContent":["class MetaStorage {\n  prefix = \"\";\n  suffix = \"\";\n  logger;\n  constructor(config) {\n    this.prefix = config?.prefix ?? \"\";\n    this.suffix = config?.suffix ?? \".META\";\n    this.logger = config?.logger;\n  }\n  /**\n   * Saves upload metadata.\n   */\n  // eslint-disable-next-line class-methods-use-this\n  async save(_id, file) {\n    return file;\n  }\n  /**\n   * Deletes an upload metadata.\n   */\n  // eslint-disable-next-line class-methods-use-this\n  async delete(_id) {\n    throw new Error(\"Not implemented\");\n  }\n  /**\n   * Retrieves upload metadata.\n   */\n  // eslint-disable-next-line class-methods-use-this\n  async get(_id) {\n    throw new Error(\"Not implemented\");\n  }\n  /**\n   * Marks upload active.\n   */\n  // eslint-disable-next-line class-methods-use-this\n  async touch(_id, _file) {\n    throw new Error(\"Not implemented\");\n  }\n  getMetaName(id) {\n    return this.prefix + id + this.suffix;\n  }\n  getIdFromMetaName(name) {\n    return name.slice(this.prefix.length, -this.suffix.length);\n  }\n}\n\nexport { MetaStorage as default };\n"],"names":[],"mappings":";;;;AAAA,MAAM;IACJ,SAAS,GAAG;IACZ,SAAS,GAAG;IACZ,OAAO;IACP,YAAY,MAAM,CAAE;QAClB,IAAI,CAAC,MAAM,GAAG,QAAQ,UAAU;QAChC,IAAI,CAAC,MAAM,GAAG,QAAQ,UAAU;QAChC,IAAI,CAAC,MAAM,GAAG,QAAQ;IACxB;IACA;;GAEC,GACD,kDAAkD;IAClD,MAAM,KAAK,GAAG,EAAE,IAAI,EAAE;QACpB,OAAO;IACT;IACA;;GAEC,GACD,kDAAkD;IAClD,MAAM,OAAO,GAAG,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IACA;;GAEC,GACD,kDAAkD;IAClD,MAAM,IAAI,GAAG,EAAE;QACb,MAAM,IAAI,MAAM;IAClB;IACA;;GAEC,GACD,kDAAkD;IAClD,MAAM,MAAM,GAAG,EAAE,KAAK,EAAE;QACtB,MAAM,IAAI,MAAM;IAClB;IACA,YAAY,EAAE,EAAE;QACd,OAAO,IAAI,CAAC,MAAM,GAAG,KAAK,IAAI,CAAC,MAAM;IACvC;IACA,kBAAkB,IAAI,EAAE;QACtB,OAAO,KAAK,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM;IAC3D;AACF"}},
    {"offset": {"line": 7430, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/local-meta-storage-CsuVst9V.js"],"sourcesContent":["import { utimes } from 'node:fs/promises';\nimport { tmpdir } from 'node:os';\nimport { throwErrorCode, ERRORS } from './ERRORS-DKaR93nv.js';\nimport MetaStorage from './MetaStorage-pECeFOad.js';\nimport { stringifyMetadata, parseMetadata } from './Metadata-v9haqHC6.js';\nimport { a as normalizeWindowsPath, d as dirname, n as normalize, j as join } from './path-CR6YkPXX-7R1-9CMk.js';\nimport { createRequire } from 'node:module';\n\nconst F_OK = 0;\nconst R_OK = 4;\n\nconst assertValidFileOrDirectoryPath = (fileOrDirectoryPath) => {\n  if (!fileOrDirectoryPath || !(fileOrDirectoryPath instanceof URL) && typeof fileOrDirectoryPath !== \"string\") {\n    throw new TypeError(\"Path must be a non-empty string or URL.\");\n  }\n};\n\nconst getFileInfoType = (fileInfo) => {\n  if (fileInfo.isFile()) {\n    return \"file\";\n  }\n  if (fileInfo.isDirectory()) {\n    return \"dir\";\n  }\n  if (fileInfo.isSymbolicLink()) {\n    return \"symlink\";\n  }\n  return void 0;\n};\n\nconst __cjs_require$5 = createRequire(import.meta.url);\nconst __cjs_getProcess$5 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$5 = (module) => {\n  if (typeof __cjs_getProcess$5 !== \"undefined\" && __cjs_getProcess$5.versions && __cjs_getProcess$5.versions.node) {\n    const [major, minor] = __cjs_getProcess$5.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$5.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$5(module);\n};\nconst {\n  lstat,\n  mkdir: mkdir$1\n} = __cjs_getBuiltinModule$5(\"node:fs/promises\");\nconst ensureDir = async (directory) => {\n  assertValidFileOrDirectoryPath(directory);\n  try {\n    const fileInfo = await lstat(directory);\n    if (!fileInfo.isDirectory()) {\n      throw new Error(`Ensure path exists, expected 'dir', got '${getFileInfoType(fileInfo)}'`);\n    }\n    return;\n  } catch (error) {\n    if (error.code !== \"ENOENT\") {\n      throw error;\n    }\n  }\n  try {\n    await mkdir$1(directory, { recursive: true });\n  } catch (error) {\n    if (error.code !== \"EEXIST\") {\n      throw error;\n    }\n    const fileInfo = await lstat(directory);\n    if (!fileInfo.isDirectory()) {\n      throw new Error(`Ensure path exists, expected 'dir', got '${getFileInfoType(fileInfo)}'`);\n    }\n  }\n};\n\nconst __cjs_require$4 = createRequire(import.meta.url);\nconst __cjs_getProcess$4 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$4 = (module) => {\n  if (typeof __cjs_getProcess$4 !== \"undefined\" && __cjs_getProcess$4.versions && __cjs_getProcess$4.versions.node) {\n    const [major, minor] = __cjs_getProcess$4.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$4.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$4(module);\n};\nconst {\n  fileURLToPath\n} = __cjs_getBuiltinModule$4(\"node:url\");\nfunction getDefaultExportFromCjs(x) {\n  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, \"default\") ? x[\"default\"] : x;\n}\nvar binaryExtensions$1;\nvar hasRequiredBinaryExtensions;\nfunction requireBinaryExtensions() {\n  if (hasRequiredBinaryExtensions) return binaryExtensions$1;\n  hasRequiredBinaryExtensions = 1;\n  binaryExtensions$1 = [\n    \"3dm\",\n    \"3ds\",\n    \"3g2\",\n    \"3gp\",\n    \"7z\",\n    \"a\",\n    \"aac\",\n    \"adp\",\n    \"afdesign\",\n    \"afphoto\",\n    \"afpub\",\n    \"ai\",\n    \"aif\",\n    \"aiff\",\n    \"alz\",\n    \"ape\",\n    \"apk\",\n    \"appimage\",\n    \"ar\",\n    \"arj\",\n    \"asf\",\n    \"au\",\n    \"avi\",\n    \"bak\",\n    \"baml\",\n    \"bh\",\n    \"bin\",\n    \"bk\",\n    \"bmp\",\n    \"btif\",\n    \"bz2\",\n    \"bzip2\",\n    \"cab\",\n    \"caf\",\n    \"cgm\",\n    \"class\",\n    \"cmx\",\n    \"cpio\",\n    \"cr2\",\n    \"cr3\",\n    \"cur\",\n    \"dat\",\n    \"dcm\",\n    \"deb\",\n    \"dex\",\n    \"djvu\",\n    \"dll\",\n    \"dmg\",\n    \"dng\",\n    \"doc\",\n    \"docm\",\n    \"docx\",\n    \"dot\",\n    \"dotm\",\n    \"dra\",\n    \"DS_Store\",\n    \"dsk\",\n    \"dts\",\n    \"dtshd\",\n    \"dvb\",\n    \"dwg\",\n    \"dxf\",\n    \"ecelp4800\",\n    \"ecelp7470\",\n    \"ecelp9600\",\n    \"egg\",\n    \"eol\",\n    \"eot\",\n    \"epub\",\n    \"exe\",\n    \"f4v\",\n    \"fbs\",\n    \"fh\",\n    \"fla\",\n    \"flac\",\n    \"flatpak\",\n    \"fli\",\n    \"flv\",\n    \"fpx\",\n    \"fst\",\n    \"fvt\",\n    \"g3\",\n    \"gh\",\n    \"gif\",\n    \"graffle\",\n    \"gz\",\n    \"gzip\",\n    \"h261\",\n    \"h263\",\n    \"h264\",\n    \"icns\",\n    \"ico\",\n    \"ief\",\n    \"img\",\n    \"ipa\",\n    \"iso\",\n    \"jar\",\n    \"jpeg\",\n    \"jpg\",\n    \"jpgv\",\n    \"jpm\",\n    \"jxr\",\n    \"key\",\n    \"ktx\",\n    \"lha\",\n    \"lib\",\n    \"lvp\",\n    \"lz\",\n    \"lzh\",\n    \"lzma\",\n    \"lzo\",\n    \"m3u\",\n    \"m4a\",\n    \"m4v\",\n    \"mar\",\n    \"mdi\",\n    \"mht\",\n    \"mid\",\n    \"midi\",\n    \"mj2\",\n    \"mka\",\n    \"mkv\",\n    \"mmr\",\n    \"mng\",\n    \"mobi\",\n    \"mov\",\n    \"movie\",\n    \"mp3\",\n    \"mp4\",\n    \"mp4a\",\n    \"mpeg\",\n    \"mpg\",\n    \"mpga\",\n    \"mxu\",\n    \"nef\",\n    \"npx\",\n    \"numbers\",\n    \"nupkg\",\n    \"o\",\n    \"odp\",\n    \"ods\",\n    \"odt\",\n    \"oga\",\n    \"ogg\",\n    \"ogv\",\n    \"otf\",\n    \"ott\",\n    \"pages\",\n    \"pbm\",\n    \"pcx\",\n    \"pdb\",\n    \"pdf\",\n    \"pea\",\n    \"pgm\",\n    \"pic\",\n    \"png\",\n    \"pnm\",\n    \"pot\",\n    \"potm\",\n    \"potx\",\n    \"ppa\",\n    \"ppam\",\n    \"ppm\",\n    \"pps\",\n    \"ppsm\",\n    \"ppsx\",\n    \"ppt\",\n    \"pptm\",\n    \"pptx\",\n    \"psd\",\n    \"pya\",\n    \"pyc\",\n    \"pyo\",\n    \"pyv\",\n    \"qt\",\n    \"rar\",\n    \"ras\",\n    \"raw\",\n    \"resources\",\n    \"rgb\",\n    \"rip\",\n    \"rlc\",\n    \"rmf\",\n    \"rmvb\",\n    \"rpm\",\n    \"rtf\",\n    \"rz\",\n    \"s3m\",\n    \"s7z\",\n    \"scpt\",\n    \"sgi\",\n    \"shar\",\n    \"snap\",\n    \"sil\",\n    \"sketch\",\n    \"slk\",\n    \"smv\",\n    \"snk\",\n    \"so\",\n    \"stl\",\n    \"suo\",\n    \"sub\",\n    \"swf\",\n    \"tar\",\n    \"tbz\",\n    \"tbz2\",\n    \"tga\",\n    \"tgz\",\n    \"thmx\",\n    \"tif\",\n    \"tiff\",\n    \"tlz\",\n    \"ttc\",\n    \"ttf\",\n    \"txz\",\n    \"udf\",\n    \"uvh\",\n    \"uvi\",\n    \"uvm\",\n    \"uvp\",\n    \"uvs\",\n    \"uvu\",\n    \"viv\",\n    \"vob\",\n    \"war\",\n    \"wav\",\n    \"wax\",\n    \"wbmp\",\n    \"wdp\",\n    \"weba\",\n    \"webm\",\n    \"webp\",\n    \"whl\",\n    \"wim\",\n    \"wm\",\n    \"wma\",\n    \"wmv\",\n    \"wmx\",\n    \"woff\",\n    \"woff2\",\n    \"wrm\",\n    \"wvx\",\n    \"xbm\",\n    \"xif\",\n    \"xla\",\n    \"xlam\",\n    \"xls\",\n    \"xlsb\",\n    \"xlsm\",\n    \"xlsx\",\n    \"xlt\",\n    \"xltm\",\n    \"xltx\",\n    \"xm\",\n    \"xmind\",\n    \"xpi\",\n    \"xpm\",\n    \"xwd\",\n    \"xz\",\n    \"z\",\n    \"zip\",\n    \"zipx\"\n  ];\n  return binaryExtensions$1;\n}\nvar binaryExtensionsExports = /* @__PURE__ */ requireBinaryExtensions();\nconst binaryExtensions = /* @__PURE__ */ getDefaultExportFromCjs(binaryExtensionsExports);\nnew Set(binaryExtensions);\nconst toPath = (urlOrPath) => normalizeWindowsPath(urlOrPath instanceof URL ? fileURLToPath(urlOrPath) : urlOrPath);\n\nconst __cjs_require$3 = createRequire(import.meta.url);\nconst __cjs_getProcess$3 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$3 = (module) => {\n  if (typeof __cjs_getProcess$3 !== \"undefined\" && __cjs_getProcess$3.versions && __cjs_getProcess$3.versions.node) {\n    const [major, minor] = __cjs_getProcess$3.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$3.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$3(module);\n};\nconst {\n  access\n} = __cjs_getBuiltinModule$3(\"node:fs/promises\");\nasync function isAccessible(path, mode = F_OK) {\n  assertValidFileOrDirectoryPath(path);\n  path = toPath(path);\n  try {\n    await access(path, mode);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nclass PermissionError extends Error {\n  /**\n   * Creates a new instance.\n   * @param message\n   */\n  constructor(message) {\n    super(`EPERM: Operation not permitted, ${message}`);\n  }\n  // eslint-disable-next-line class-methods-use-this\n  get code() {\n    return \"EPERM\";\n  }\n  // eslint-disable-next-line class-methods-use-this,@typescript-eslint/explicit-module-boundary-types\n  set code(_name) {\n    throw new Error(\"Cannot overwrite code EPERM\");\n  }\n  // eslint-disable-next-line class-methods-use-this\n  get name() {\n    return \"PermissionError\";\n  }\n  // eslint-disable-next-line class-methods-use-this,@typescript-eslint/explicit-module-boundary-types\n  set name(_name) {\n    throw new Error(\"Cannot overwrite name of PermissionError\");\n  }\n}\n\nconst __cjs_require$2 = createRequire(import.meta.url);\nconst __cjs_getProcess$2 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$2 = (module) => {\n  if (typeof __cjs_getProcess$2 !== \"undefined\" && __cjs_getProcess$2.versions && __cjs_getProcess$2.versions.node) {\n    const [major, minor] = __cjs_getProcess$2.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$2.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$2(module);\n};\nconst {\n  readFile: readFile$1\n} = __cjs_getBuiltinModule$2(\"node:fs/promises\");\nconst {\n  unzip,\n  brotliDecompress\n} = __cjs_getBuiltinModule$2(\"node:zlib\");\nconst decompressionMethods = {\n  brotli: brotliDecompress,\n  gzip: unzip,\n  none: (buffer, callback) => {\n    callback(null, buffer);\n  }\n};\nconst readFile = async (path, options) => {\n  assertValidFileOrDirectoryPath(path);\n  path = toPath(path);\n  if (!await isAccessible(path)) {\n    throw new PermissionError(`unable to read the non-accessible file: ${path}`);\n  }\n  if (!await isAccessible(path, R_OK)) {\n    throw new Error(`Unable to read the non-readable file: ${path}`);\n  }\n  const { buffer, compression, encoding, flag } = options ?? {};\n  return await readFile$1(path, flag ? { encoding, flag } : { encoding }).then(\n    async (content) => await new Promise((resolve, reject) => {\n      decompressionMethods[compression ?? \"none\"](content, (error, result) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve(buffer ? result : result.toString());\n        }\n      });\n    })\n  ).catch((error) => {\n    throw error;\n  });\n};\n\nconst __cjs_require$1 = createRequire(import.meta.url);\nconst __cjs_getProcess$1 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$1 = (module) => {\n  if (typeof __cjs_getProcess$1 !== \"undefined\" && __cjs_getProcess$1.versions && __cjs_getProcess$1.versions.node) {\n    const [major, minor] = __cjs_getProcess$1.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$1.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$1(module);\n};\nconst {\n  unlink: unlink$1,\n  rm\n} = __cjs_getBuiltinModule$1(\"node:fs/promises\");\nconst remove = async (path, options = {}) => {\n  assertValidFileOrDirectoryPath(path);\n  try {\n    await unlink$1(path);\n  } catch {\n  }\n  try {\n    await rm(path, { force: true, maxRetries: options?.maxRetries, recursive: true, retryDelay: options?.retryDelay });\n  } catch {\n  }\n};\n\nconst assertValidFileContents = (contents) => {\n  if (typeof contents !== \"string\" && !(contents instanceof ArrayBuffer) && !ArrayBuffer.isView(contents)) {\n    throw new TypeError(\"File contents must be a string, ArrayBuffer, or ArrayBuffer view.\");\n  }\n};\n\nconst encoder = new TextEncoder();\nconst toUint8Array = (contents) => {\n  if (contents instanceof Uint8Array) {\n    return contents;\n  }\n  if (typeof contents === \"string\") {\n    return encoder.encode(contents);\n  }\n  if (contents instanceof ArrayBuffer) {\n    return new Uint8Array(contents);\n  }\n  if (ArrayBuffer.isView(contents)) {\n    const bytes = contents.buffer.slice(contents.byteOffset, contents.byteOffset + contents.byteLength);\n    return new Uint8Array(bytes);\n  }\n  throw new TypeError(\"Invalid contents type. Expected string or ArrayBuffer.\");\n};\n\nconst __cjs_require = createRequire(import.meta.url);\nconst __cjs_getProcess = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule = (module) => {\n  if (typeof __cjs_getProcess !== \"undefined\" && __cjs_getProcess.versions && __cjs_getProcess.versions.node) {\n    const [major, minor] = __cjs_getProcess.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require(module);\n};\nconst {\n  mkdir,\n  writeFile: writeFile$1,\n  stat,\n  rename,\n  chown,\n  chmod,\n  unlink\n} = __cjs_getBuiltinModule(\"node:fs/promises\");\nconst writeFile = async (path, content, options) => {\n  options = {\n    encoding: \"utf8\",\n    flag: \"w\",\n    overwrite: true,\n    recursive: true,\n    ...options\n  };\n  assertValidFileOrDirectoryPath(path);\n  assertValidFileContents(content);\n  path = toPath(path);\n  const temporaryPath = `${path}.tmp`;\n  try {\n    const pathExists = await isAccessible(path, F_OK);\n    if (!pathExists && options.recursive) {\n      const directory = dirname(path);\n      if (!await isAccessible(directory, F_OK)) {\n        await mkdir(directory, { recursive: true });\n      }\n    }\n    let stat$1;\n    await writeFile$1(temporaryPath, toUint8Array(content), { encoding: options.encoding, flag: options.flag });\n    if (pathExists && !options.overwrite) {\n      stat$1 = await stat(path);\n      if (options.chown === void 0) {\n        options.chown = { gid: stat$1.gid, uid: stat$1.uid };\n      }\n      await rename(path, `${path}.bak`);\n    }\n    if (options.chown) {\n      try {\n        await chown(temporaryPath, options.chown.uid, options.chown.gid);\n      } catch {\n      }\n    }\n    await chmod(temporaryPath, stat$1 && !options.mode ? stat$1.mode : options.mode ?? 438);\n    await rename(temporaryPath, path);\n  } catch (error) {\n    throw new Error(`Failed to write file at: ${path} - ${error.message}`, { cause: error });\n  } finally {\n    if (await isAccessible(temporaryPath)) {\n      await unlink(`${path}.tmp`);\n    }\n  }\n};\n\nclass LocalMetaStorage extends MetaStorage {\n  directory;\n  constructor(config) {\n    super(config);\n    this.directory = normalize(config?.directory || join(tmpdir(), \"Upload_meta\"));\n    this.accessCheck().catch((error) => {\n      this.logger?.error(\"Metadata storage access check failed: %O\", error);\n    });\n  }\n  /**\n   * Returns metafile path.\n   * @param id upload id\n   */\n  getMetaPath = (id) => normalize(`${this.directory}/${this.prefix}${id}${this.suffix}`);\n  /**\n   * Returns upload id from metafile path.\n   * @internal\n   */\n  getIdFromPath = (metaFilePath) => metaFilePath.slice(`${this.directory}/${this.prefix}`.length, -this.suffix.length);\n  async save(id, file) {\n    await this.accessCheck();\n    const transformedMetadata = { ...file };\n    if (transformedMetadata.metadata) {\n      transformedMetadata.metadata = stringifyMetadata(file.metadata);\n    }\n    await writeFile(this.getMetaPath(id), JSON.stringify(transformedMetadata), {\n      recursive: true\n    });\n    return file;\n  }\n  async touch(id, file) {\n    const time = /* @__PURE__ */ new Date();\n    await utimes(this.getMetaPath(id), time, time);\n    return file;\n  }\n  async get(id) {\n    try {\n      const json = await readFile(this.getMetaPath(id));\n      if (json === void 0) {\n        throw new TypeError(\"Invalid metafile\");\n      }\n      const file = JSON.parse(json);\n      if (file.metadata && typeof file.metadata === \"string\") {\n        file.metadata = parseMetadata(file.metadata);\n      }\n      return file;\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"ENOENT\")) {\n        throw throwErrorCode(ERRORS.FILE_NOT_FOUND);\n      }\n      throw error;\n    }\n  }\n  async delete(id) {\n    await remove(this.getMetaPath(id));\n  }\n  async accessCheck() {\n    await ensureDir(this.directory);\n  }\n}\n\nexport { LocalMetaStorage as L, assertValidFileOrDirectoryPath as a, readFile as b, ensureDir as e, getFileInfoType as g, isAccessible as i, remove as r, toPath as t };\n"],"names":[],"mappings":"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ACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IACD,OAAO;AACT;AACA,IAAI,0BAA0B,aAAa,GAAG;AAC9C,MAAM,mBAAmB,aAAa,GAAG,wBAAwB;AACjE,IAAI,IAAI;AACR,MAAM,SAAS,CAAC,YAAc,IAAA,sLAAoB,EAAC,qBAAqB,MAAM,cAAc,aAAa;AAEzG,MAAM,kBAAkB,IAAA,sIAAa,EAAC,8BAAY,GAAG;AACrD,MAAM,qBAAqB,OAAO,eAAe,eAAe,OAAO,WAAW,OAAO,KAAK,cAAc,WAAW,OAAO,GAAG;AACjI,MAAM,2BAA2B,CAAC;IAC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"}},
    {"offset": {"line": 8111, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/File-Bb3P23dr.js"],"sourcesContent":["import fnv1a from '@sindresorhus/fnv1a';\nimport { nanoid } from 'nanoid';\n\nconst hash = (value) => fnv1a(value, { size: 64 }).toString(16);\nconst extractMimeType = (meta) => {\n  if (typeof meta.mimeType === \"string\") {\n    return meta.mimeType;\n  }\n  if (typeof meta.type === \"string\") {\n    return meta.type;\n  }\n  if (typeof meta.filetype === \"string\") {\n    return meta.filetype;\n  }\n  return void 0;\n};\nconst extractOriginalName = (meta) => {\n  if (typeof meta.name === \"string\") {\n    return meta.name;\n  }\n  if (typeof meta.title === \"string\") {\n    return meta.title;\n  }\n  if (typeof meta.originalName === \"string\") {\n    return meta.originalName;\n  }\n  if (typeof meta.filename === \"string\") {\n    return meta.filename;\n  }\n  return void 0;\n};\nconst generateFileId = (file) => {\n  const { metadata, originalName, size } = file;\n  const mtime = String(metadata.lastModified ?? Date.now());\n  return [originalName, size, mtime].filter(Boolean).map(String).map((value) => hash(value)).join(\"-\");\n};\nclass File {\n  bytesWritten = Number.NaN;\n  contentType;\n  originalName;\n  id;\n  metadata;\n  name = \"\";\n  size;\n  status;\n  expiredAt;\n  createdAt;\n  modifiedAt;\n  hash;\n  content;\n  ETag;\n  constructor({ contentType, expiredAt, metadata = {}, originalName, size }) {\n    this.metadata = metadata;\n    this.originalName = originalName || extractOriginalName(metadata) || (this.id = nanoid());\n    this.contentType = contentType || extractMimeType(metadata) || \"application/octet-stream\";\n    this.expiredAt = expiredAt;\n    if (typeof size === \"string\" || typeof size === \"number\") {\n      this.size = Number(size);\n    } else if (typeof metadata.size === \"string\" || typeof metadata.size === \"number\") {\n      this.size = Number(metadata.size);\n    }\n    if (typeof this.size === \"number\" && this.size <= 0) {\n      this.size = void 0;\n    }\n    this.id ||= generateFileId(this);\n  }\n}\n\nexport { File as default };\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,OAAO,CAAC,QAAU,IAAA,iOAAK,EAAC,OAAO;QAAE,MAAM;IAAG,GAAG,QAAQ,CAAC;AAC5D,MAAM,kBAAkB,CAAC;IACvB,IAAI,OAAO,KAAK,QAAQ,KAAK,UAAU;QACrC,OAAO,KAAK,QAAQ;IACtB;IACA,IAAI,OAAO,KAAK,IAAI,KAAK,UAAU;QACjC,OAAO,KAAK,IAAI;IAClB;IACA,IAAI,OAAO,KAAK,QAAQ,KAAK,UAAU;QACrC,OAAO,KAAK,QAAQ;IACtB;IACA,OAAO,KAAK;AACd;AACA,MAAM,sBAAsB,CAAC;IAC3B,IAAI,OAAO,KAAK,IAAI,KAAK,UAAU;QACjC,OAAO,KAAK,IAAI;IAClB;IACA,IAAI,OAAO,KAAK,KAAK,KAAK,UAAU;QAClC,OAAO,KAAK,KAAK;IACnB;IACA,IAAI,OAAO,KAAK,YAAY,KAAK,UAAU;QACzC,OAAO,KAAK,YAAY;IAC1B;IACA,IAAI,OAAO,KAAK,QAAQ,KAAK,UAAU;QACrC,OAAO,KAAK,QAAQ;IACtB;IACA,OAAO,KAAK;AACd;AACA,MAAM,iBAAiB,CAAC;IACtB,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,IAAI,EAAE,GAAG;IACzC,MAAM,QAAQ,OAAO,SAAS,YAAY,IAAI,KAAK,GAAG;IACtD,OAAO;QAAC;QAAc;QAAM;KAAM,CAAC,MAAM,CAAC,SAAS,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAU,KAAK,QAAQ,IAAI,CAAC;AAClG;AACA,MAAM;IACJ,eAAe,OAAO,GAAG,CAAC;IAC1B,YAAY;IACZ,aAAa;IACb,GAAG;IACH,SAAS;IACT,OAAO,GAAG;IACV,KAAK;IACL,OAAO;IACP,UAAU;IACV,UAAU;IACV,WAAW;IACX,KAAK;IACL,QAAQ;IACR,KAAK;IACL,YAAY,EAAE,WAAW,EAAE,SAAS,EAAE,WAAW,CAAC,CAAC,EAAE,YAAY,EAAE,IAAI,EAAE,CAAE;QACzE,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,CAAC,YAAY,GAAG,gBAAgB,oBAAoB,aAAa,CAAC,IAAI,CAAC,EAAE,GAAG,IAAA,8MAAM,GAAE;QACxF,IAAI,CAAC,WAAW,GAAG,eAAe,gBAAgB,aAAa;QAC/D,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,OAAO,SAAS,YAAY,OAAO,SAAS,UAAU;YACxD,IAAI,CAAC,IAAI,GAAG,OAAO;QACrB,OAAO,IAAI,OAAO,SAAS,IAAI,KAAK,YAAY,OAAO,SAAS,IAAI,KAAK,UAAU;YACjF,IAAI,CAAC,IAAI,GAAG,OAAO,SAAS,IAAI;QAClC;QACA,IAAI,OAAO,IAAI,CAAC,IAAI,KAAK,YAAY,IAAI,CAAC,IAAI,IAAI,GAAG;YACnD,IAAI,CAAC,IAAI,GAAG,KAAK;QACnB;QACA,IAAI,CAAC,EAAE,KAAK,eAAe,IAAI;IACjC;AACF"}},
    {"offset": {"line": 8194, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/update-size-CCGm6i1J.js"],"sourcesContent":["const updateSize = (file, size) => {\n  if (size < file.size) {\n    file.size = size;\n  }\n  return file;\n};\n\nexport { updateSize as u };\n"],"names":[],"mappings":";;;;AAAA,MAAM,aAAa,CAAC,MAAM;IACxB,IAAI,OAAO,KAAK,IAAI,EAAE;QACpB,KAAK,IAAI,GAAG;IACd;IACA,OAAO;AACT"}},
    {"offset": {"line": 8209, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/has-content-CY66ehMK.js"],"sourcesContent":["const hasContent = (part) => typeof part.start === \"number\" && part.start >= 0 && !!part.body;\n\nexport { hasContent as h };\n"],"names":[],"mappings":";;;;AAAA,MAAM,aAAa,CAAC,OAAS,OAAO,KAAK,KAAK,KAAK,YAAY,KAAK,KAAK,IAAI,KAAK,CAAC,CAAC,KAAK,IAAI"}},
    {"offset": {"line": 8219, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage/dist/packem_shared/disk-storage-Bnldtwqx.js"],"sourcesContent":["import { createReadStream, createWriteStream } from 'node:fs';\nimport { truncate, copyFile as copyFile$1, stat as stat$1 } from 'node:fs/promises';\nimport { PassThrough, Transform, pipeline } from 'node:stream';\nimport { g as getDefaultExportFromCjs } from './_commonjsHelpers-B85MJLTf.js';\nimport require$$0 from 'crypto';\nimport require$$1 from 'fs';\nimport { g as getFileStatus, p as partMatch, d as detectFileTypeFromStream } from './part-match-CW8Z1naC.js';\nimport { throwErrorCode, ERRORS } from './ERRORS-DKaR93nv.js';\nimport { createHash } from 'node:crypto';\nimport { B as BaseStorage, a as defaultFilesystemFileNameValidation, t as toMilliseconds } from './storage-qBIeShej.js';\nimport { a as assertValidFileOrDirectoryPath, g as getFileInfoType, e as ensureDir, t as toPath, i as isAccessible, L as LocalMetaStorage, b as readFile, r as remove } from './local-meta-storage-CsuVst9V.js';\nimport File from './File-Bb3P23dr.js';\nimport { createRequire } from 'node:module';\nimport { d as dirname, r as resolve, j as join, n as normalize, b as basename, i as isAbsolute } from './path-CR6YkPXX-7R1-9CMk.js';\nimport { u as updateSize } from './update-size-CCGm6i1J.js';\nimport { h as hasContent } from './has-content-CY66ehMK.js';\n\nconst __cjs_require$2 = createRequire(import.meta.url);\nconst __cjs_getProcess$2 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$2 = (module) => {\n  if (typeof __cjs_getProcess$2 !== \"undefined\" && __cjs_getProcess$2.versions && __cjs_getProcess$2.versions.node) {\n    const [major, minor] = __cjs_getProcess$2.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$2.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$2(module);\n};\nconst {\n  lstat,\n  writeFile\n} = __cjs_getBuiltinModule$2(\"node:fs/promises\");\nconst ensureFile = async (filePath) => {\n  assertValidFileOrDirectoryPath(filePath);\n  try {\n    const stat = await lstat(filePath);\n    if (!stat.isFile()) {\n      throw new Error(`Ensure path exists, expected 'file', got '${getFileInfoType(stat)}'`);\n    }\n  } catch (error) {\n    if (error.code === \"ENOENT\") {\n      await ensureDir(dirname(toPath(filePath)));\n      await writeFile(filePath, new Uint8Array());\n      return;\n    }\n    throw error;\n  }\n};\n\nclass WalkError extends Error {\n  /** File path of the root that's being walked. */\n  root;\n  /**\n   * Constructs a new instance.\n   * @param cause The underlying error or reason for the walk failure.\n   * @param root The root directory path where the walk operation started or encountered the error.\n   */\n  constructor(cause, root) {\n    super(`${cause instanceof Error ? cause.message : cause} for path \"${root}\"`);\n    this.cause = cause;\n    this.root = root;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  get name() {\n    return \"WalkError\";\n  }\n  // eslint-disable-next-line class-methods-use-this,@typescript-eslint/explicit-module-boundary-types\n  set name(_name) {\n    throw new Error(\"Cannot overwrite name of WalkError\");\n  }\n}\n\nconst globToRegExp = (glob) => {\n  const reString = glob.replace(/\\.\\*/g, \".([^/]*)\").replace(/\\*\\*/g, \"(.*)\").replace(/(?<!\\.)\\*(?!\\*)/g, \"([^/]*)\").replace(/\\?/g, \"[^/]\").replace(/\\.(?!\\*)/g, String.raw`\\.`).replace(/\\{/g, \"(\").replace(/\\}/g, \")\").replace(/,/g, \"|\").replace(/\\[!(.*?)\\]/g, \"[^$1]\");\n  return new RegExp(`^${reString}$`);\n};\nconst walkInclude = (path, extensions, match, skip) => {\n  if (Array.isArray(extensions) && extensions.length > 0 && !extensions.some((extension) => path.endsWith(extension))) {\n    return false;\n  }\n  if (match && !match.some((pattern) => pattern.test(path))) {\n    return false;\n  }\n  return !skip?.some((pattern) => pattern.test(path));\n};\n\nconst __cjs_require$1 = createRequire(import.meta.url);\nconst __cjs_getProcess$1 = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule$1 = (module) => {\n  if (typeof __cjs_getProcess$1 !== \"undefined\" && __cjs_getProcess$1.versions && __cjs_getProcess$1.versions.node) {\n    const [major, minor] = __cjs_getProcess$1.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess$1.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require$1(module);\n};\nconst {\n  readdir,\n  realpath,\n  stat\n} = __cjs_getBuiltinModule$1(\"node:fs/promises\");\nconst _createWalkEntry = async (path) => {\n  const normalizePath = normalize(path);\n  const name = basename(normalizePath);\n  const info = await stat(normalizePath);\n  return {\n    isDirectory: () => info.isDirectory(),\n    isFile: () => info.isFile(),\n    isSymbolicLink: () => info.isSymbolicLink(),\n    name,\n    path: normalizePath\n  };\n};\nasync function* walk(directory, {\n  extensions,\n  followSymlinks = false,\n  includeDirs: includeDirectories = true,\n  includeFiles = true,\n  includeSymlinks = true,\n  match,\n  maxDepth = Number.POSITIVE_INFINITY,\n  skip\n} = {}) {\n  assertValidFileOrDirectoryPath(directory);\n  if (maxDepth < 0) {\n    return;\n  }\n  const mappedMatch = match ? match.map((pattern) => typeof pattern === \"string\" ? globToRegExp(pattern) : pattern) : void 0;\n  const mappedSkip = skip ? skip.map((pattern) => typeof pattern === \"string\" ? globToRegExp(pattern) : pattern) : void 0;\n  directory = resolve(toPath(directory));\n  if (includeDirectories && walkInclude(directory, extensions, mappedMatch, mappedSkip)) {\n    yield await _createWalkEntry(directory);\n  }\n  if (maxDepth < 1 || !walkInclude(directory, void 0, void 0, mappedSkip)) {\n    return;\n  }\n  try {\n    for await (const entry of await readdir(directory, {\n      withFileTypes: true\n    })) {\n      let path = join(directory, entry.name);\n      if (entry.isSymbolicLink()) {\n        if (followSymlinks) {\n          path = await realpath(path);\n        } else if (includeSymlinks && walkInclude(path, extensions, mappedMatch, mappedSkip)) {\n          yield {\n            isDirectory: entry.isDirectory,\n            isFile: entry.isFile,\n            isSymbolicLink: entry.isSymbolicLink,\n            name: entry.name,\n            path\n          };\n        } else {\n          continue;\n        }\n      }\n      if (entry.isSymbolicLink() || entry.isDirectory()) {\n        yield* walk(path, {\n          extensions,\n          followSymlinks,\n          includeDirs: includeDirectories,\n          includeFiles,\n          includeSymlinks,\n          match: mappedMatch,\n          maxDepth: maxDepth - 1,\n          skip: mappedSkip\n        });\n      } else if (entry.isFile() && includeFiles && walkInclude(path, extensions, mappedMatch, mappedSkip)) {\n        yield {\n          isDirectory: () => entry.isDirectory(),\n          isFile: () => entry.isFile(),\n          isSymbolicLink: () => entry.isSymbolicLink(),\n          name: entry.name,\n          path\n        };\n      }\n    }\n  } catch (error) {\n    if (error instanceof WalkError) {\n      throw error;\n    }\n    throw new WalkError(error, directory);\n  }\n}\n\nconst __cjs_require = createRequire(import.meta.url);\nconst __cjs_getProcess = typeof globalThis !== \"undefined\" && typeof globalThis.process !== \"undefined\" ? globalThis.process : process;\nconst __cjs_getBuiltinModule = (module) => {\n  if (typeof __cjs_getProcess !== \"undefined\" && __cjs_getProcess.versions && __cjs_getProcess.versions.node) {\n    const [major, minor] = __cjs_getProcess.versions.node.split(\".\").map(Number);\n    if (major > 22 || major === 22 && minor >= 3 || major === 20 && minor >= 16) {\n      return __cjs_getProcess.getBuiltinModule(module);\n    }\n  }\n  return __cjs_require(module);\n};\nconst {\n  cwd\n} = __cjs_getProcess;\nconst {\n  mkdir,\n  rename: rename$1,\n  copyFile,\n  unlink\n} = __cjs_getBuiltinModule(\"node:fs/promises\");\n__cjs_getBuiltinModule(\"node:fs\");\nclass SameDirectoryError extends Error {\n  constructor(source, destination) {\n    super(`Source directory \"${dirname(source)}\" does not match destination directory \"${dirname(destination)}\"`);\n    this.name = \"SameDirectoryError\";\n  }\n}\nconst validateSameDirectory = (source, destination) => {\n  if (!source || !destination) {\n    throw new Error(\"Source and destination paths must not be empty\");\n  }\n  if (dirname(source) !== dirname(destination)) {\n    throw new SameDirectoryError(source, destination);\n  }\n};\nconst internalMoveFile = async (sourcePath, destinationPath, { cwd: cwd2, directoryMode, overwrite, validateDirectory }) => {\n  if (cwd2) {\n    sourcePath = resolve(cwd2, sourcePath);\n    destinationPath = resolve(cwd2, destinationPath);\n  }\n  if (validateDirectory) {\n    validateSameDirectory(sourcePath, destinationPath);\n  }\n  if (!overwrite && await isAccessible(destinationPath)) {\n    throw new Error(`The destination file exists: ${destinationPath}`);\n  }\n  await mkdir(dirname(destinationPath), {\n    mode: directoryMode,\n    recursive: true\n  });\n  try {\n    await rename$1(sourcePath, destinationPath);\n  } catch (error) {\n    if (error.code === \"EXDEV\") {\n      await copyFile(sourcePath, destinationPath);\n      await unlink(sourcePath);\n    } else {\n      throw error;\n    }\n  }\n};\nconst move = async (sourcePath, destinationPath, options = {}) => {\n  const internalOptions = {\n    overwrite: true,\n    validateDirectory: false,\n    ...options,\n    cwd: options.cwd ? toPath(options.cwd) : cwd()\n  };\n  await internalMoveFile(sourcePath, destinationPath, internalOptions);\n};\n\nvar etag_1;\nvar hasRequiredEtag;\n\nfunction requireEtag () {\n\tif (hasRequiredEtag) return etag_1;\n\thasRequiredEtag = 1;\n\t/*!\n\t * etag\n\t * Copyright(c) 2014-2016 Douglas Christopher Wilson\n\t * MIT Licensed\n\t */\n\tetag_1 = etag;\n\tvar crypto = require$$0;\n\tvar Stats = require$$1.Stats;\n\tvar toString = Object.prototype.toString;\n\tfunction entitytag(entity) {\n\t  if (entity.length === 0) {\n\t    return '\"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk\"';\n\t  }\n\t  var hash = crypto.createHash(\"sha1\").update(entity, \"utf8\").digest(\"base64\").substring(0, 27);\n\t  var len = typeof entity === \"string\" ? Buffer.byteLength(entity, \"utf8\") : entity.length;\n\t  return '\"' + len.toString(16) + \"-\" + hash + '\"';\n\t}\n\tfunction etag(entity, options) {\n\t  if (entity == null) {\n\t    throw new TypeError(\"argument entity is required\");\n\t  }\n\t  var isStats = isstats(entity);\n\t  var weak = options && typeof options.weak === \"boolean\" ? options.weak : isStats;\n\t  if (!isStats && typeof entity !== \"string\" && !Buffer.isBuffer(entity)) {\n\t    throw new TypeError(\"argument entity must be string, Buffer, or fs.Stats\");\n\t  }\n\t  var tag = isStats ? stattag(entity) : entitytag(entity);\n\t  return weak ? \"W/\" + tag : tag;\n\t}\n\tfunction isstats(obj) {\n\t  if (typeof Stats === \"function\" && obj instanceof Stats) {\n\t    return true;\n\t  }\n\t  return obj && typeof obj === \"object\" && \"ctime\" in obj && toString.call(obj.ctime) === \"[object Date]\" && \"mtime\" in obj && toString.call(obj.mtime) === \"[object Date]\" && \"ino\" in obj && typeof obj.ino === \"number\" && \"size\" in obj && typeof obj.size === \"number\";\n\t}\n\tfunction stattag(stat) {\n\t  var mtime = stat.mtime.getTime().toString(16);\n\t  var size = stat.size.toString(16);\n\t  return '\"' + size + \"-\" + mtime + '\"';\n\t}\n\treturn etag_1;\n}\n\nvar etagExports = requireEtag();\nconst etag = /*@__PURE__*/getDefaultExportFromCjs(etagExports);\n\nclass StreamChecksum extends Transform {\n  /**\n   * Creates a new StreamChecksum transform stream.\n   * @param checksum Expected checksum value to validate against\n   * @param algorithm Hash algorithm to use (e.g., 'md5', 'sha256')\n   * @param encoding Encoding for the checksum comparison (defaults to 'base64')\n   */\n  constructor(checksum, algorithm, encoding = \"base64\") {\n    super();\n    this.checksum = checksum;\n    this.algorithm = algorithm;\n    this.encoding = encoding;\n    this.hash = createHash(algorithm);\n  }\n  length = 0;\n  digest = \"\";\n  hash;\n  /**\n   * Gets the calculated digest value after the stream has finished processing.\n   * @returns The digest value in the configured encoding, or empty string if not yet calculated\n   */\n  get calculatedDigest() {\n    return this.digest;\n  }\n  /**\n   * Transform method that updates the hash with incoming data.\n   * @param chunk Buffer chunk to process\n   * @param _encoding Unused encoding parameter\n   * @param done Callback to signal completion\n   */\n  // eslint-disable-next-line no-underscore-dangle\n  _transform(chunk, _encoding, done) {\n    this.push(chunk);\n    this.hash.update(chunk);\n    this.length += chunk.length;\n    done();\n  }\n  /**\n   * Finalization method that validates the checksum.\n   * @param callback Callback called with error if checksum validation fails\n   */\n  // eslint-disable-next-line no-underscore-dangle\n  _flush(callback) {\n    this.digest = this.hash.digest(this.encoding);\n    if (this.checksum && this.checksum !== this.digest) {\n      callback(new Error(\"Checksum mismatch\"));\n    } else {\n      callback();\n    }\n  }\n}\nconst streamChecksum = (checksum, algorithm, encoding = \"base64\") => algorithm ? new StreamChecksum(checksum, algorithm, encoding) : new PassThrough();\n\nclass StreamLength extends Transform {\n  /**\n   * Creates a new StreamLength transform stream.\n   * @param limit Maximum number of bytes allowed (defaults to infinity)\n   */\n  constructor(limit = Number.POSITIVE_INFINITY) {\n    super();\n    this.limit = limit;\n  }\n  length = 0;\n  /**\n   * Transform method that counts bytes and enforces size limits.\n   * @param chunk Buffer chunk to process\n   * @param _encoding Unused encoding parameter\n   * @param callback Callback called with error if limit exceeded\n   */\n  // eslint-disable-next-line no-underscore-dangle\n  _transform(chunk, _encoding, callback) {\n    const expected = this.length + chunk.length;\n    if (this.limit >= expected) {\n      this.push(chunk);\n      this.length = expected;\n      callback();\n    } else {\n      callback(new Error(\"Stream length limit exceeded\"));\n    }\n  }\n}\n\nclass DiskStorage extends BaseStorage {\n  static name = \"disk\";\n  checksumTypes = [\"md5\", \"sha1\"];\n  directory;\n  meta;\n  constructor(config) {\n    super(config);\n    this.directory = config.directory;\n    if (config.metaStorage) {\n      this.meta = config.metaStorage;\n    } else {\n      const metaConfig = { ...config, ...config.metaStorageConfig, logger: this.logger };\n      this.meta = new LocalMetaStorage(metaConfig);\n    }\n    if (!config.fileNameValidation) {\n      config.fileNameValidation = defaultFilesystemFileNameValidation;\n    }\n    this.isReady = false;\n    this.accessCheck().then(() => {\n      this.isReady = true;\n    }).catch((error) => {\n      this.logger?.error(\"Storage access check failed: %O\", error);\n    });\n  }\n  /**\n   * Normalizes errors with disk storage context.\n   * @param error The error to normalize.\n   * @returns Normalized HTTP error.\n   */\n  normalizeError(error) {\n    return super.normalizeError(error);\n  }\n  /**\n   * Creates a new file upload and saves its metadata.\n   * @param fileInit File initialization configuration.\n   * @returns Promise resolving to the created file object.\n   * @throws {Error} If validation fails or file already exists and is completed.\n   * @remarks\n   * Supports TTL (time-to-live) option in fileInit.\n   * Creates the file on disk if it doesn't exist.\n   * Returns existing file if it's already completed.\n   */\n  async create(fileInit) {\n    return this.instrumentOperation(\"create\", async () => {\n      const processedConfig = { ...fileInit };\n      if (fileInit.ttl) {\n        const ttlMs = typeof fileInit.ttl === \"string\" ? toMilliseconds(fileInit.ttl) : fileInit.ttl;\n        if (ttlMs !== void 0) {\n          processedConfig.expiredAt = Date.now() + ttlMs;\n        }\n      }\n      if (processedConfig.size !== void 0 && Number(processedConfig.size) < 0) {\n        throwErrorCode(ERRORS.REQUEST_ENTITY_TOO_LARGE, \"Request entity too large\");\n      }\n      const file = new File(processedConfig);\n      try {\n        const existing = await this.getMeta(file.id);\n        if (existing.status === \"completed\") {\n          return existing;\n        }\n      } catch {\n      }\n      file.name = this.namingFunction(file);\n      if (file.size === void 0 || Number.isNaN(file.size)) {\n        if (file.size === void 0) ; else {\n          file.size = this.maxUploadSize;\n        }\n      }\n      await this.validate(file);\n      const path = this.getFilePath(file.name);\n      try {\n        await ensureFile(path);\n        file.bytesWritten = 0;\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        throwErrorCode(ERRORS.FILE_ERROR, message);\n      }\n      file.status = getFileStatus(file);\n      await this.saveMeta(file);\n      await this.onCreate(file);\n      return file;\n    });\n  }\n  /**\n   * Writes data to a file upload.\n   * @param part File part containing data to write, file query, or full file object.\n   * @returns Promise resolving to the updated file object.\n   * @throws {Error} If file is expired (ERRORS.GONE), locked (ERRORS.FILE_LOCKED), or conflicts occur (ERRORS.FILE_CONFLICT).\n   * @remarks\n   * Supports chunked uploads with start position.\n   * Automatically detects file type from stream on first chunk if contentType is not set.\n   * Validates checksum algorithms if provided.\n   * Uses file locking to prevent concurrent writes.\n   * Updates file status to \"completed\" when all bytes are written.\n   */\n  async write(part) {\n    return this.instrumentOperation(\"write\", async () => {\n      let file;\n      const isFullFile = \"contentType\" in part && \"metadata\" in part && !(\"body\" in part) && !(\"start\" in part);\n      if (isFullFile) {\n        file = part;\n      } else {\n        file = await this.getMeta(part.id);\n        await this.checkIfExpired(file);\n      }\n      if (file.status === \"completed\") {\n        return file;\n      }\n      if (part.size !== void 0) {\n        updateSize(file, part.size);\n      }\n      if (!partMatch(part, file)) {\n        return throwErrorCode(ERRORS.FILE_CONFLICT);\n      }\n      const path = this.getFilePath(file.name);\n      await this.lock(path);\n      try {\n        const startPosition = part.start || 0;\n        await ensureFile(path);\n        if (file.bytesWritten === 0) {\n          file.bytesWritten = startPosition;\n        }\n        if (hasContent(part)) {\n          if (this.isUnsupportedChecksum(part.checksumAlgorithm)) {\n            return throwErrorCode(ERRORS.UNSUPPORTED_CHECKSUM_ALGORITHM);\n          }\n          const isFirstChunk = part.start === 0 || part.start === void 0;\n          if (isFirstChunk && (file.bytesWritten === 0 || Number.isNaN(file.bytesWritten)) && (!file.contentType || file.contentType === \"application/octet-stream\")) {\n            try {\n              const { fileType, stream: detectedStream } = await detectFileTypeFromStream(part.body);\n              if (fileType?.mime) {\n                file.contentType = fileType.mime;\n              }\n              part.body = detectedStream;\n            } catch {\n            }\n          }\n          const signalFromPart = part.signal;\n          const lazyWritePart = { ...file, ...part, body: part.body };\n          if (signalFromPart) {\n            lazyWritePart.signal = signalFromPart;\n          }\n          const [bytesWritten, errorCode] = await this.lazyWrite(lazyWritePart);\n          if (errorCode) {\n            await truncate(path, file.bytesWritten);\n            return throwErrorCode(errorCode);\n          }\n          const expectedBytesWritten = startPosition + (part.contentLength || 0);\n          file.bytesWritten = Math.max(file.bytesWritten || 0, expectedBytesWritten);\n          file.bytesWritten = Math.max(file.bytesWritten || 0, bytesWritten);\n          file.status = getFileStatus(file);\n          await this.saveMeta(file);\n        } else {\n          await ensureFile(path);\n          file.bytesWritten = 0;\n        }\n        return file;\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        return throwErrorCode(ERRORS.FILE_ERROR, message);\n      } finally {\n        await this.unlock(path);\n      }\n    });\n  }\n  /**\n   * Gets an uploaded file by ID.\n   * @param query File query containing the file ID to retrieve.\n   * @param query.id File ID to retrieve.\n   * @returns Promise resolving to the file data including content buffer.\n   * @throws {Error} If the file cannot be found (ERRORS.FILE_NOT_FOUND) or has expired (ERRORS.GONE).\n   * @remarks\n   * Loads the entire file content into memory as a Buffer.\n   * For large files, consider using getStream() instead.\n   * Includes ETag (MD5 hash) for content verification.\n   */\n  async get({ id }) {\n    return this.instrumentOperation(\"get\", async () => {\n      const file = await this.checkIfExpired(await this.meta.get(id));\n      const { bytesWritten, contentType, expiredAt, metadata, modifiedAt, name, originalName, size } = file;\n      let content;\n      try {\n        content = await readFile(this.getFilePath(name), { buffer: true });\n      } catch (error) {\n        const errorWithCode = error;\n        if (errorWithCode.code === \"ENOENT\" || errorWithCode.code === \"EPERM\") {\n          const message = error instanceof Error ? error.message : errorWithCode.message || String(error);\n          return throwErrorCode(ERRORS.FILE_NOT_FOUND, message);\n        }\n        throw error;\n      }\n      return {\n        content,\n        contentType,\n        ETag: etag(content),\n        expiredAt,\n        id,\n        metadata,\n        modifiedAt,\n        name,\n        originalName,\n        size: size || bytesWritten\n      };\n    });\n  }\n  /**\n   * Gets an uploaded file as a readable stream for efficient large file handling.\n   * @param query File query containing the file ID to stream.\n   * @param query.id File ID to stream.\n   * @returns Promise resolving to an object containing the stream, headers, and size.\n   * @throws {UploadError} If the file cannot be found (ERRORS.FILE_NOT_FOUND) or has expired (ERRORS.GONE).\n   * @remarks Creates a readable stream directly from the file system for efficient memory usage.\n   */\n  async getStream({ id }) {\n    return this.instrumentOperation(\"getStream\", async () => {\n      try {\n        const file = await this.checkIfExpired(await this.meta.get(id));\n        const { bytesWritten, contentType, expiredAt, modifiedAt, name, size } = file;\n        const stream = createReadStream(this.getFilePath(name));\n        return {\n          headers: {\n            \"Content-Length\": String(size || bytesWritten),\n            \"Content-Type\": contentType,\n            ...expiredAt && { \"X-Upload-Expires\": expiredAt.toString() },\n            ...modifiedAt && { \"Last-Modified\": modifiedAt.toString() }\n            // Note: ETag requires reading the file content, so we don't include it for streaming\n            // Clients can use HEAD requests to get ETag if needed\n          },\n          size: size || bytesWritten,\n          stream\n        };\n      } catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        throw throwErrorCode(ERRORS.FILE_NOT_FOUND, message);\n      }\n    });\n  }\n  /**\n   * Deletes an upload and its metadata.\n   * @param query File query containing the file ID to delete.\n   * @param query.id File ID to delete.\n   * @returns Promise resolving to the deleted file object with status: \"deleted\".\n   * @throws {UploadError} If the file metadata cannot be found.\n   */\n  async delete({ id }) {\n    return this.instrumentOperation(\"delete\", async () => {\n      const file = await this.getMeta(id);\n      await remove(this.getFilePath(file.name));\n      await this.deleteMeta(id);\n      const deletedFile = { ...file, status: \"deleted\" };\n      await this.onDelete(deletedFile);\n      return deletedFile;\n    });\n  }\n  /**\n   * Copies an upload file to a new location.\n   * @param name Source file name/ID.\n   * @param destination Destination file name/ID.\n   * @returns Promise resolving to the copied file object.\n   * @throws {UploadError} If the source file cannot be found.\n   */\n  async copy(name, destination) {\n    return this.instrumentOperation(\"copy\", async () => {\n      const sourceFile = await this.getMeta(name);\n      await copyFile$1(this.getFilePath(sourceFile.name), this.getFilePath(destination));\n      return { ...sourceFile, name: destination };\n    });\n  }\n  /**\n   * Moves an upload file to a new location.\n   * @param name Source file name/ID.\n   * @param destination Destination file name/ID.\n   * @returns Promise resolving to the moved file object.\n   * @throws {Error} If the source file cannot be found.\n   */\n  async move(name, destination) {\n    return this.instrumentOperation(\"move\", async () => {\n      const sourceFile = await this.getMeta(name);\n      const source = this.getFilePath(sourceFile.name);\n      const destinationPath = this.getFilePath(destination);\n      try {\n        await move(source, destinationPath);\n      } catch (error) {\n        const errorWithCode = error;\n        if (errorWithCode?.code === \"EXDEV\") {\n          await copyFile$1(source, destinationPath);\n          await remove(source);\n        } else {\n          throw error;\n        }\n      }\n      return { ...sourceFile, id: sourceFile.id, name: destination };\n    });\n  }\n  /**\n   * Retrieves a list of uploaded files.\n   * @returns Promise resolving to an array of file metadata objects.\n   * @remarks Walks the storage directory and returns all files, excluding metadata files.\n   */\n  async list() {\n    return this.instrumentOperation(\"list\", async () => {\n      const config = {\n        followSymlinks: false,\n        includeDirs: false,\n        includeFiles: true,\n        skip: [\"*.META$\"]\n      };\n      const uploads = [];\n      const { directory } = this;\n      for await (const founding of walk(directory, config)) {\n        const { suffix } = this.meta;\n        const { path } = founding;\n        if (!path.includes(suffix)) {\n          const { birthtime, ctime, mtime } = await stat$1(path);\n          uploads.push({ createdAt: birthtime || ctime, id: path.replace(directory, \"\"), modifiedAt: mtime });\n        }\n      }\n      return uploads;\n    });\n  }\n  /**\n   * Returns path for the uploaded file\n   * If filename is already an absolute path, returns it as-is.\n   * Otherwise, joins it with the storage directory.\n   */\n  getFilePath(filename) {\n    if (isAbsolute(filename)) {\n      return filename;\n    }\n    return join(this.directory, filename);\n  }\n  lazyWrite(part) {\n    return new Promise((resolve, reject) => {\n      const destination = createWriteStream(this.getFilePath(part.name), { flags: \"r+\", start: part.start });\n      const lengthChecker = new StreamLength(part.contentLength || part.size - part.start);\n      const checksumChecker = streamChecksum(part.checksum, part.checksumAlgorithm);\n      const keepPartial = !part.checksum;\n      const { signal } = part;\n      const cleanupStreams = () => {\n        destination.close();\n        lengthChecker.destroy();\n        checksumChecker.destroy();\n      };\n      const failWithCode = (code) => {\n        cleanupStreams();\n        resolve([Number.NaN, code]);\n      };\n      lengthChecker.on(\"error\", () => failWithCode(ERRORS.FILE_CONFLICT));\n      checksumChecker.on(\"error\", () => failWithCode(ERRORS.CHECKSUM_MISMATCH));\n      part.body.on(\"aborted\", () => failWithCode(keepPartial ? void 0 : ERRORS.REQUEST_ABORTED));\n      part.body.on(\"error\", (error) => {\n        cleanupStreams();\n        reject(error);\n      });\n      if (signal?.aborted) {\n        return failWithCode(keepPartial ? void 0 : ERRORS.REQUEST_ABORTED);\n      }\n      if (signal) {\n        signal.addEventListener(\"abort\", () => {\n          cleanupStreams();\n          destination.destroy();\n          lengthChecker.destroy();\n          checksumChecker.destroy();\n          part.body.destroy();\n          resolve([Number.NaN, keepPartial ? void 0 : ERRORS.REQUEST_ABORTED]);\n        });\n      }\n      pipeline(part.body, lengthChecker, checksumChecker, destination, (error) => {\n        if (error) {\n          cleanupStreams();\n          if (signal && signal.aborted) {\n            return resolve([Number.NaN, keepPartial ? void 0 : ERRORS.REQUEST_ABORTED]);\n          }\n          return resolve([Number.NaN, ERRORS.FILE_ERROR]);\n        }\n        return resolve([part.start + destination.bytesWritten]);\n      });\n    });\n  }\n  async accessCheck() {\n    await ensureDir(this.directory);\n  }\n}\n\nexport { DiskStorage as D, StreamLength as S, ensureFile as e, streamChecksum as s };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9052, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage-client/examples/nextjs/lib/storage.ts"],"sourcesContent":["import { DiskStorage } from \"@visulima/storage\";\nimport { mkdir } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport { tmpdir } from \"node:os\";\n\n/**\n * Shared storage instance for file uploads.\n * Uses local disk storage for development.\n */\nconst uploadDirectory = join(tmpdir(), \"uploads\");\n\n// Ensure upload directory exists\nmkdir(uploadDirectory, { recursive: true }).catch((error) => {\n    console.error(\"Failed to create upload directory:\", error);\n});\n\nexport const storage = new DiskStorage({\n    directory: uploadDirectory,\n    maxUploadSize: \"100MB\",\n    logger: console,\n});\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA;;;CAGC,GACD,MAAM,kBAAkB,IAAA,yHAAI,EAAC,IAAA,uHAAM,KAAI;AAEvC,iCAAiC;AACjC,IAAA,8IAAK,EAAC,iBAAiB;IAAE,WAAW;AAAK,GAAG,KAAK,CAAC,CAAC;IAC/C,QAAQ,KAAK,CAAC,sCAAsC;AACxD;AAEO,MAAM,UAAU,IAAI,gOAAW,CAAC;IACnC,WAAW;IACX,eAAe;IACf,QAAQ;AACZ"}},
    {"offset": {"line": 9083, "column": 0}, "map": {"version":3,"sources":["file:///home/prisis/WebstormProjects/visulima/visulima/packages/storage-client/examples/nextjs/app/api/upload/multipart/route.ts"],"sourcesContent":["import { createNextjsHandler } from \"@visulima/storage/handler/http/nextjs\";\nimport { storage } from \"../../../../lib/storage\";\n\nconst handler = createNextjsHandler({ storage, type: \"multipart\" });\n\nexport const POST = handler;\nexport const DELETE = handler;\nexport const GET = handler;\nexport const OPTIONS = handler;\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,UAAU,IAAA,0LAAmB,EAAC;IAAE,SAAA,kLAAO;IAAE,MAAM;AAAY;AAE1D,MAAM,OAAO;AACb,MAAM,SAAS;AACf,MAAM,MAAM;AACZ,MAAM,UAAU"}}]
}